System.register(["./core-legacy-DbRSgJay.js","./ui-legacy-CZ8U0kkw.js"],function(n,e){"use strict";var t,i,a,s,o,r,c,l,d,p,m,g;return{setters:[n=>{t=n.e,i=n.E,a=n.m,s=n.g,o=n.p,r=n.b,c=n.c,l=n.d},n=>{d=n.B,p=n.C,m=n.D,g=n.E}],execute:function(){var n=document.createElement("style");n.textContent='*{margin:0;padding:0;box-sizing:border-box}:root{--primary-color: #1a202c;--primary-light: #2d3748;--secondary-color: #3182ce;--secondary-light: #4299e1;--accent-color: #e53e3e;--success-color: #38a169;--warning-color: #d69e2e;--info-color: #0bc5ea;--background-color: #f7fafc;--background-alt: #edf2f7;--surface-color: #ffffff;--surface-elevated: #ffffff;--text-color: #1a202c;--text-light: #718096;--text-muted: #a0aec0;--border-color: #e2e8f0;--border-light: #f7fafc;--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--border-radius-sm: 4px;--border-radius: 8px;--border-radius-lg: 12px;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: 1rem;--spacing-lg: 1.5rem;--spacing-xl: 2rem;--spacing-2xl: 3rem;--transition-fast: .15s ease-in-out;--transition-base: .2s ease-in-out;--transition-slow: .3s ease-in-out}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;color:var(--text-color);background-color:var(--background-color);font-size:14px}#app{min-height:100vh;display:flex;flex-direction:column}.header{background:linear-gradient(135deg,var(--primary-color) 0%,var(--primary-light) 100%);color:#fff;padding:var(--spacing-md) var(--spacing-lg);display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow-lg);position:relative}.header:after{content:"";position:absolute;bottom:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--secondary-color),var(--info-color),var(--success-color))}.header__title{font-size:1.75rem;font-weight:700;background:linear-gradient(45deg,#fff,#e2e8f0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 2px 4px rgba(0,0,0,.1)}.header__info{display:flex;gap:var(--spacing-md);font-size:.875rem;font-weight:500}.header__info span{padding:var(--spacing-sm) var(--spacing-md);background:rgba(255,255,255,.15);border-radius:var(--border-radius-lg);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);transition:all var(--transition-base)}.header__info span:hover{background:rgba(255,255,255,.2);transform:translateY(-1px)}.main-content{flex:1;padding:var(--spacing-lg);max-width:1400px;margin:0 auto;width:100%}.dashboard{display:grid;gap:var(--spacing-lg);grid-template-rows:auto 1fr}.dashboard__panels{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-lg)}.panel{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);overflow:hidden;transition:all var(--transition-base);border:1px solid var(--border-color)}.panel:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.panel__title{background:linear-gradient(135deg,var(--secondary-color) 0%,var(--secondary-light) 100%);color:#fff;padding:var(--spacing-md) var(--spacing-lg);font-size:1.1rem;font-weight:600;position:relative}.panel__title:after{content:"";position:absolute;bottom:0;left:0;right:0;height:2px;background:rgba(255,255,255,.3)}.panel__content{padding:var(--spacing-lg)}.panel.economic-panel .panel__title{background:linear-gradient(135deg,var(--success-color) 0%,#48bb78 100%)}.panel.political-panel .panel__title{background:linear-gradient(135deg,var(--info-color) 0%,#4299e1 100%)}.panel.global-panel .panel__title{background:linear-gradient(135deg,var(--warning-color) 0%,#ed8936 100%)}.panel.events-panel .panel__title{background:linear-gradient(135deg,var(--accent-color) 0%,#f56565 100%)}.panel.decisions-panel .panel__title{background:linear-gradient(135deg,#805ad5,#9f7aea)}.metric{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) 0;border-bottom:1px solid var(--border-light);transition:all var(--transition-fast)}.metric:last-child{border-bottom:none}.metric:hover{background:var(--background-alt);margin:0 calc(-1 * var(--spacing-lg));padding-left:var(--spacing-lg);padding-right:var(--spacing-lg);border-radius:var(--border-radius)}.metric label{font-weight:600;color:var(--text-light);font-size:.875rem;text-transform:uppercase;letter-spacing:.025em}.metric span{font-weight:700;font-size:1.1rem;color:var(--text-color)}.metric span[id*=gdp]{color:var(--success-color)}.metric span[id*=unemployment]{color:var(--accent-color)}.metric span[id*=approval]{color:var(--secondary-color)}.metric span[id*=debt]{color:var(--warning-color)}.events-section{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-lg)}.events-list,.decisions-list{list-style:none}.events-list li,.decisions-list li{padding:var(--spacing-md);border-bottom:1px solid var(--border-light);font-size:.875rem;line-height:1.5;transition:all var(--transition-fast)}.events-list li:last-child,.decisions-list li:last-child{border-bottom:none}.events-list li:hover,.decisions-list li:hover{background:var(--background-alt);transform:translate(4px);border-left:3px solid var(--secondary-color);padding-left:calc(var(--spacing-md) - 3px)}.decisions-list li{cursor:pointer;border-radius:var(--border-radius);margin-bottom:var(--spacing-xs);border:1px solid transparent}.decisions-list li:hover{background:linear-gradient(135deg,var(--background-alt) 0%,var(--surface-color) 100%);border-color:var(--border-color);box-shadow:var(--shadow-sm);transform:translateY(-1px)}.footer{background:linear-gradient(135deg,var(--surface-color) 0%,var(--background-alt) 100%);border-top:2px solid var(--border-color);padding:var(--spacing-md);box-shadow:0 -4px 6px rgba(0,0,0,.05)}@media (max-width: 768px){.footer{padding:var(--spacing-sm)}}.game-controls{display:flex;justify-content:center;align-items:center;gap:var(--spacing-md);flex-wrap:wrap}@media (max-width: 768px){.game-controls{gap:var(--spacing-sm)}.game-controls .btn{flex:1;min-width:0;max-width:calc(50% - var(--spacing-xs))}}@media (max-width: 480px){.game-controls .btn{max-width:100%;margin-bottom:var(--spacing-xs)}}.btn{padding:var(--spacing-md) var(--spacing-lg);border:none;border-radius:var(--border-radius-lg);font-size:.875rem;font-weight:600;cursor:pointer;transition:all var(--transition-base);position:relative;overflow:hidden;text-transform:uppercase;letter-spacing:.025em;min-width:120px;display:inline-flex;align-items:center;justify-content:center}.btn:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left var(--transition-slow)}.btn:hover:before{left:100%}.btn--primary{background:linear-gradient(135deg,var(--secondary-color) 0%,var(--secondary-light) 100%);color:#fff;box-shadow:var(--shadow-md)}.btn--primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);background:linear-gradient(135deg,var(--secondary-light) 0%,var(--secondary-color) 100%)}.btn--primary:active{transform:translateY(0)}.btn--secondary{background:linear-gradient(135deg,var(--surface-color) 0%,var(--background-alt) 100%);color:var(--text-color);border:2px solid var(--border-color);box-shadow:var(--shadow-sm)}.btn--secondary:hover{background:linear-gradient(135deg,var(--background-alt) 0%,var(--surface-color) 100%);border-color:var(--secondary-color);transform:translateY(-1px);box-shadow:var(--shadow-md)}.btn--secondary:active{transform:translateY(0)}.btn:disabled{opacity:.5;cursor:not-allowed;transform:none!important;box-shadow:none!important}.btn:disabled:hover:before{left:-100%}.btn:focus{outline:none;box-shadow:0 0 0 3px rgba(49,130,206,.3)}@media (max-width: 768px){.header{flex-direction:column;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md)}.header__title{font-size:1.5rem;text-align:center}.header__info{flex-wrap:wrap;justify-content:center;gap:var(--spacing-xs)}.header__info span{font-size:.75rem;padding:var(--spacing-xs) var(--spacing-sm);min-width:auto}.dashboard__panels{grid-template-columns:1fr;gap:var(--spacing-md)}.events-section{grid-template-columns:1fr}.game-controls{display:flex;flex-wrap:wrap;gap:var(--spacing-sm);padding:var(--spacing-sm)}.game-controls .btn{min-width:auto;flex:1;font-size:.8rem;padding:var(--spacing-sm)}.main-content{padding:var(--spacing-md)}.panel__title{font-size:1rem;padding:var(--spacing-sm) var(--spacing-md)}.panel__content{padding:var(--spacing-md)}.metric{padding:var(--spacing-sm) 0}.metric label{font-size:.8rem}.metric span{font-size:1rem}}.navigation{width:100%;margin-top:var(--spacing-sm)}.navigation__menu{display:flex;list-style:none;gap:var(--spacing-xs);margin:0;padding:0;flex-wrap:wrap;justify-content:center}.navigation__item{position:relative;flex:0 0 auto}.navigation__link{display:block;padding:var(--spacing-sm) var(--spacing-md);color:rgba(255,255,255,.8);text-decoration:none;border-radius:var(--border-radius);transition:all .2s;font-size:.85rem;white-space:nowrap;text-align:center}.navigation__link:hover{background:rgba(255,255,255,.1);color:#fff}.navigation__link--active{background:rgba(255,255,255,.2);color:#fff;font-weight:500}.navigation__badge{position:absolute;top:-5px;right:-5px;background:var(--accent-color);color:#fff;border-radius:50%;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}@media (max-width: 768px){.navigation__menu{overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;padding:0 var(--spacing-sm)}.navigation__menu::-webkit-scrollbar{display:none}.navigation__item{flex:0 0 auto}.navigation__link{font-size:.75rem;padding:var(--spacing-xs) var(--spacing-sm);min-width:auto}}@media (max-width: 480px){.navigation__link{font-size:.7rem;padding:var(--spacing-xs)}}.modal-backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .3s ease}.modal-backdrop--visible{opacity:1;visibility:visible}.modal{background:var(--surface-color);border-radius:var(--border-radius);box-shadow:0 10px 30px rgba(0,0,0,.3);min-width:300px;max-width:90vw;max-height:90vh;transform:scale(.8) translateY(-50px);transition:all .3s ease;overflow:hidden}.modal--visible{transform:scale(1) translateY(0)}.modal__content{display:flex;flex-direction:column;max-height:90vh}.modal__header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-lg);border-bottom:1px solid var(--border-color);background:var(--background-color)}.modal__title{margin:0;font-size:1.2rem;color:var(--text-color)}.modal__close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light);padding:var(--spacing-xs);width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background-color .2s}.modal__close:hover{background:var(--border-color)}.modal__body{padding:var(--spacing-lg);overflow-y:auto;flex:1}.modal__footer{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-lg);border-top:1px solid var(--border-color);background:var(--background-color)}.form-input,.form-textarea,.form-select{width:100%;padding:var(--spacing-sm);border:1px solid var(--border-color);border-radius:var(--border-radius);font-size:.9rem;transition:border-color .2s}.form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--secondary-color);box-shadow:0 0 0 2px rgba(52,152,219,.2)}.form-group{margin-bottom:var(--spacing-md)}.form-group label{display:block;margin-bottom:var(--spacing-xs);font-weight:500;color:var(--text-color)}.screen{display:none}.screen--active{display:block}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-fade-in{animation:fadeIn .3s ease}.animate-slide-up{animation:slideUp .3s ease}.economics-screen{padding:var(--spacing-lg)}.economics-header{margin-bottom:var(--spacing-xl);text-align:center}.economics-header h1{color:var(--primary-color);margin-bottom:var(--spacing-sm)}.economic-phase{display:flex;justify-content:center;gap:var(--spacing-lg);font-size:.9rem}.economic-phase .phase-indicator,.economic-phase .phase-duration{color:var(--text-light)}.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--spacing-md);margin-bottom:var(--spacing-xl)}.metric-card{background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-lg);box-shadow:var(--shadow-light);text-align:center}.metric-card h3{margin:0 0 var(--spacing-sm) 0;color:var(--text-light);font-size:.9rem;text-transform:uppercase;letter-spacing:.5px}.metric-card .metric-value{font-size:2rem;font-weight:700;color:var(--primary-color);margin-bottom:var(--spacing-xs)}.metric-card .metric-trend{font-size:.8rem;color:var(--success-color)}.gdp-card .metric-value{color:var(--secondary-color)}.unemployment-card .metric-value{color:var(--accent-color)}.inflation-card .metric-value{color:var(--warning-color)}.confidence-card .metric-value{color:var(--success-color)}.charts-section{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-lg);margin-bottom:var(--spacing-xl)}.chart-container{background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-md);box-shadow:var(--shadow-light)}.chart-container h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color);font-size:1rem}.chart-container .chart{width:100%;min-height:200px}.forecast-section{background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-lg);box-shadow:var(--shadow-light);margin-bottom:var(--spacing-xl)}.forecast-section h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color)}.forecast-section .forecast-summary{margin-top:var(--spacing-md);padding:var(--spacing-md);background:var(--background-color);border-radius:var(--border-radius)}.forecast-section .forecast-summary p{margin:0;color:var(--text-color);font-style:italic}.sectors-section{background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-lg);box-shadow:var(--shadow-light);margin-bottom:var(--spacing-xl)}.sectors-section h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color)}.sectors-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:var(--spacing-md)}.sector-card{background:var(--background-color);border-radius:var(--border-radius);padding:var(--spacing-md);text-align:center}.sector-card h4{margin:0 0 var(--spacing-sm) 0;color:var(--text-color);font-size:.9rem}.sector-card .sector-share{font-size:1.5rem;font-weight:700;color:var(--secondary-color);margin-bottom:var(--spacing-xs)}.sector-card .sector-growth{font-size:.9rem;color:var(--success-color)}.agriculture-sector .sector-share{color:var(--success-color)}.manufacturing-sector .sector-share{color:var(--secondary-color)}.services-sector .sector-share{color:var(--warning-color)}.policy-section{background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-lg);box-shadow:var(--shadow-light);margin-bottom:var(--spacing-xl)}.policy-section h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color)}.policy-section .policy-categories{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-xl)}.policy-section .policy-category{background:var(--background-color);border-radius:var(--border-radius);padding:var(--spacing-md);border:1px solid var(--border-color)}.policy-section .policy-category h4{margin:0 0 var(--spacing-sm) 0;color:var(--primary-color);font-size:.95rem;font-weight:600}.policy-section .policy-buttons{display:flex;flex-wrap:wrap;gap:var(--spacing-sm);margin-bottom:var(--spacing-lg)}.policy-section .active-policies h4{margin:0 0 var(--spacing-sm) 0;color:var(--text-color);font-size:.9rem}.policy-section .active-policies ul{list-style:none;margin:0;padding:0}.policy-section .active-policies ul li{padding:var(--spacing-xs) 0;color:var(--text-light);font-size:.9rem}.event-info{color:var(--secondary-color)}.event-warning{color:var(--warning-color)}.event-danger{color:var(--accent-color)}.event-success{color:var(--success-color)}@media (max-width: 768px){.metrics-grid{grid-template-columns:repeat(2,1fr)}.charts-section,.sectors-grid{grid-template-columns:1fr}.economic-phase{flex-direction:column;gap:var(--spacing-sm)}.policy-buttons{flex-direction:column}.policy-buttons .btn{width:100%}}.text-center{text-align:center}.text-success{color:var(--success-color)}.text-warning{color:var(--warning-color)}.text-danger{color:var(--accent-color)}.hidden{display:none}.loading{opacity:.6;pointer-events:none}.flex{display:flex}.flex-column{flex-direction:column}.flex-center{align-items:center;justify-content:center}.gap-sm{gap:var(--spacing-sm)}.gap-md{gap:var(--spacing-md)}.gap-lg{gap:var(--spacing-lg)}.mt-sm{margin-top:var(--spacing-sm)}.mt-md{margin-top:var(--spacing-md)}.mb-sm{margin-bottom:var(--spacing-sm)}.mb-md{margin-bottom:var(--spacing-md)}.loading-overlay{position:relative}.loading-overlay:after{content:"";position:absolute;top:50%;left:50%;width:24px;height:24px;margin:-12px 0 0 -12px;border:3px solid var(--border-color);border-top-color:var(--secondary-color);border-radius:50%;animation:spin 1s linear infinite;z-index:10}@keyframes spin{to{transform:rotate(360deg)}}@keyframes fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInLeft{0%{transform:translate(-30px);opacity:0}to{transform:translate(0);opacity:1}}@keyframes pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes glow{0%,to{box-shadow:var(--shadow-md)}50%{box-shadow:var(--shadow-lg),0 0 20px rgba(49,130,206,.3)}}.animate-fadeInUp{animation:fadeInUp .6s ease-out}.animate-slideInLeft{animation:slideInLeft .4s ease-out}.animate-pulse{animation:pulse 2s infinite}.animate-glow{animation:glow 3s infinite}.status-indicator{display:inline-flex;align-items:center;gap:var(--spacing-xs);font-size:.875rem;font-weight:500}.status-indicator:before{content:"";width:8px;height:8px;border-radius:50%;flex-shrink:0}.status-indicator--positive:before{background:var(--success-color);box-shadow:0 0 6px rgba(56,161,105,.6)}.status-indicator--negative:before{background:var(--accent-color);box-shadow:0 0 6px rgba(229,62,62,.6)}.status-indicator--neutral:before{background:var(--warning-color);box-shadow:0 0 6px rgba(214,158,46,.6)}.status-indicator--stable:before{background:var(--info-color);box-shadow:0 0 6px rgba(11,197,234,.6)}.progress-bar{width:100%;height:8px;background:var(--border-light);border-radius:var(--border-radius);overflow:hidden;margin-top:var(--spacing-xs);box-shadow:inset 0 1px 3px rgba(0,0,0,.1)}.progress-bar__fill{height:100%;background:linear-gradient(90deg,var(--secondary-color),var(--secondary-light));border-radius:var(--border-radius);transition:width .8s ease-out;position:relative}.progress-bar__fill:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.4) 50%,transparent 100%);animation:shimmer 2.5s infinite}.progress-bar--success .progress-bar__fill{background:linear-gradient(90deg,var(--success-color),#48bb78)}.progress-bar--warning .progress-bar__fill{background:linear-gradient(90deg,var(--warning-color),#ed8936)}.progress-bar--danger .progress-bar__fill{background:linear-gradient(90deg,var(--accent-color),#f56565)}@keyframes shimmer{0%{transform:translate(-100%)}to{transform:translate(100%)}}.tooltip{position:relative;cursor:help;border-bottom:1px dotted var(--text-light)}.tooltip:after{content:attr(data-tooltip);position:absolute;bottom:125%;left:50%;transform:translate(-50%);background:var(--primary-color);color:#fff;padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--border-radius);font-size:.75rem;white-space:nowrap;opacity:0;pointer-events:none;transition:all var(--transition-base);z-index:1000;box-shadow:var(--shadow-lg)}.tooltip:before{content:"";position:absolute;bottom:125%;left:50%;transform:translate(-50%) translateY(2px);border:5px solid transparent;border-top-color:var(--primary-color);opacity:0;pointer-events:none;transition:all var(--transition-base);z-index:1000}.tooltip:hover:after,.tooltip:hover:before{opacity:1;transform:translate(-50%) translateY(-5px)}.notification{position:fixed;top:var(--spacing-lg);right:var(--spacing-lg);min-width:300px;padding:var(--spacing-md) var(--spacing-lg);border-radius:var(--border-radius-lg);color:#fff;font-weight:500;box-shadow:var(--shadow-xl);z-index:10000;animation:slideInRight .3s ease-out}.notification--success{background:linear-gradient(135deg,var(--success-color),#48bb78)}.notification--warning{background:linear-gradient(135deg,var(--warning-color),#ed8936)}.notification--error{background:linear-gradient(135deg,var(--accent-color),#f56565)}.notification--info{background:linear-gradient(135deg,var(--info-color),#4299e1)}.screen{opacity:0;transform:translateY(20px);transition:all var(--transition-base);display:none}.screen--active{opacity:1;transform:translateY(0);display:block;animation:fadeInUp .4s ease-out}@media (prefers-color-scheme: dark){:root{--primary-color: #2d3748;--primary-light: #4a5568;--background-color: #1a202c;--background-alt: #2d3748;--surface-color: #2d3748;--text-color: #f7fafc;--text-light: #a0aec0;--border-color: #4a5568;--border-light: #4a5568}}.dark-theme{--primary-color: #2d3748;--primary-light: #4a5568;--background-color: #1a202c;--background-alt: #2d3748;--surface-color: #2d3748;--surface-elevated: #4a5568;--text-color: #f7fafc;--text-light: #a0aec0;--text-muted: #718096;--border-color: #4a5568;--border-light: #4a5568}.light-theme{--primary-color: #1a202c;--primary-light: #2d3748;--background-color: #f7fafc;--background-alt: #edf2f7;--surface-color: #ffffff;--surface-elevated: #ffffff;--text-color: #1a202c;--text-light: #718096;--text-muted: #a0aec0;--border-color: #e2e8f0;--border-light: #f7fafc}.timeline-container{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);margin:var(--spacing-lg) 0;overflow:hidden;transition:all var(--transition-base)}.timeline-container.timeline-expanded{box-shadow:var(--shadow-lg)}.timeline-header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) var(--spacing-lg);background:linear-gradient(135deg,var(--secondary-color) 0%,var(--secondary-light) 100%);color:#fff;cursor:pointer}.timeline-header .timeline-title{display:flex;align-items:center;gap:var(--spacing-sm);margin:0;font-size:1.1rem;font-weight:600}.timeline-header .timeline-title .timeline-icon{font-size:1.2rem}.timeline-header .timeline-toggle{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);color:#fff;padding:var(--spacing-xs) var(--spacing-sm);font-size:.875rem;min-width:auto;display:flex;align-items:center;gap:var(--spacing-xs)}.timeline-header .timeline-toggle:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5)}.timeline-header .timeline-toggle .toggle-icon{transition:transform var(--transition-base)}.timeline-content{max-height:0;overflow:hidden;transition:max-height var(--transition-slow)}.timeline-controls{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-light);background:var(--background-alt)}.timeline-controls .timeline-info{display:flex;flex-direction:column;gap:var(--spacing-xs)}.timeline-controls .timeline-info .current-time{font-weight:600;color:var(--text-color);font-size:1rem}.timeline-controls .timeline-info .playtime{font-size:.875rem;color:var(--text-light)}.timeline-controls .timeline-zoom{display:flex;gap:var(--spacing-xs)}.timeline-controls .timeline-zoom .zoom-btn{padding:var(--spacing-xs) var(--spacing-sm);border:1px solid var(--border-color);background:var(--surface-color);color:var(--text-color);border-radius:var(--border-radius);cursor:pointer;transition:all var(--transition-fast);font-size:.8rem}.timeline-controls .timeline-zoom .zoom-btn:hover{background:var(--secondary-color);color:#fff;border-color:var(--secondary-color)}.timeline-controls .timeline-zoom .zoom-btn.active{background:var(--secondary-color);color:#fff;border-color:var(--secondary-color);font-weight:600}.timeline-track{padding:var(--spacing-lg);position:relative;min-height:80px}.timeline-progress{position:relative;height:40px;margin-bottom:var(--spacing-lg)}.timeline-progress .timeline-line{position:absolute;top:50%;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--border-light) 0%,var(--secondary-color) 100%);border-radius:var(--border-radius);transform:translateY(-50%)}.timeline-progress .timeline-current-marker{position:absolute;top:50%;left:0;width:12px;height:12px;background:var(--secondary-color);border:3px solid white;border-radius:50%;transform:translate(-50%,-50%);box-shadow:var(--shadow-md);z-index:10;transition:left var(--transition-base)}.timeline-progress .timeline-current-marker:after{content:"";position:absolute;top:50%;left:50%;width:4px;height:4px;background:#fff;border-radius:50%;transform:translate(-50%,-50%)}.timeline-progress .timeline-markers{position:absolute;top:0;left:0;right:0;height:100%}.timeline-progress .timeline-markers .timeline-marker{position:absolute;top:0;height:100%;display:flex;flex-direction:column;align-items:center}.timeline-progress .timeline-markers .timeline-marker:before{content:"";width:1px;height:20px;background:var(--border-color);margin-top:10px}.timeline-progress .timeline-markers .timeline-marker .marker-label{font-size:.75rem;color:var(--text-light);margin-top:var(--spacing-xs);white-space:nowrap}.timeline-events{position:absolute;top:0;left:0;right:0;height:100%;pointer-events:none}.timeline-events .timeline-event{position:absolute;top:15px;pointer-events:all;cursor:pointer;transform:translate(-50%)}.timeline-events .timeline-event .event-dot{width:8px;height:8px;border-radius:50%;transition:all var(--transition-fast);box-shadow:var(--shadow-sm)}.timeline-events .timeline-event:hover .event-dot{transform:scale(1.3);box-shadow:var(--shadow-md)}.timeline-events .timeline-event .event-tooltip{position:absolute;bottom:100%;left:50%;transform:translate(-50%);background:var(--primary-color);color:#fff;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius);font-size:.75rem;white-space:nowrap;opacity:0;visibility:hidden;transition:all var(--transition-base);z-index:100;margin-bottom:var(--spacing-xs)}.timeline-events .timeline-event .event-tooltip:after{content:"";position:absolute;top:100%;left:50%;transform:translate(-50%);border:4px solid transparent;border-top-color:var(--primary-color)}.timeline-events .timeline-event .event-tooltip.visible{opacity:1;visibility:visible;transform:translate(-50%) translateY(-5px)}.timeline-events .timeline-event.event-economic .event-dot{background:var(--success-color)}.timeline-events .timeline-event.event-political .event-dot{background:var(--info-color)}.timeline-events .timeline-event.event-save .event-dot{background:var(--warning-color)}.timeline-events .timeline-event.event-milestone .event-dot{background:var(--accent-color)}.timeline-events .timeline-event.event-general .event-dot{background:var(--text-light)}.timeline-legend{display:flex;flex-wrap:wrap;gap:var(--spacing-md);padding:var(--spacing-md) var(--spacing-lg);border-top:1px solid var(--border-light);background:var(--background-alt)}.timeline-legend .legend-item{display:flex;align-items:center;gap:var(--spacing-xs);font-size:.875rem;color:var(--text-light)}.timeline-legend .legend-item .legend-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.timeline-legend .legend-item .legend-dot.event-economic{background:var(--success-color)}.timeline-legend .legend-item .legend-dot.event-political{background:var(--info-color)}.timeline-legend .legend-item .legend-dot.event-save{background:var(--warning-color)}.timeline-legend .legend-item .legend-dot.event-milestone{background:var(--accent-color)}@media (max-width: 768px){.timeline-controls{flex-direction:column;gap:var(--spacing-md);align-items:stretch}.timeline-controls .timeline-info{text-align:center}.timeline-controls .timeline-zoom,.timeline-legend{justify-content:center}.timeline-legend .legend-item{font-size:.8rem}.timeline-events .timeline-event .event-tooltip{font-size:.7rem;max-width:150px;white-space:normal}}.player-guide{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-lg);overflow:hidden;max-width:1200px;margin:0 auto}.player-guide.guide-visible{animation:fadeInUp .4s ease-out}.guide-header{background:linear-gradient(135deg,var(--primary-color) 0%,var(--primary-light) 100%);color:#fff;padding:var(--spacing-lg);display:flex;justify-content:space-between;align-items:center}.guide-header .guide-title h2{margin:0 0 var(--spacing-xs) 0;font-size:1.5rem;font-weight:700}.guide-header .guide-title p{margin:0;opacity:.9;font-size:.9rem}.guide-header .guide-mode-switch{display:flex;gap:var(--spacing-xs)}.guide-header .guide-mode-switch .mode-btn{padding:var(--spacing-sm) var(--spacing-md);border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#fff;border-radius:var(--border-radius);cursor:pointer;transition:all var(--transition-base);font-size:.875rem}.guide-header .guide-mode-switch .mode-btn:hover{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.5)}.guide-header .guide-mode-switch .mode-btn.active{background:#fff;color:var(--primary-color);border-color:#fff;font-weight:600}.guide-content{display:flex;min-height:500px;max-height:70vh}.guide-sidebar{width:280px;background:var(--background-alt);border-right:1px solid var(--border-color);overflow-y:auto;flex-shrink:0}.guide-sidebar .guide-nav{padding:var(--spacing-md)}.guide-sidebar .guide-nav.hidden{display:none}.guide-sidebar .guide-nav .guide-nav-item{display:flex;align-items:center;gap:var(--spacing-sm);width:100%;padding:var(--spacing-sm) var(--spacing-md);margin-bottom:var(--spacing-xs);border:none;background:none;color:var(--text-color);text-align:left;border-radius:var(--border-radius);cursor:pointer;transition:all var(--transition-base)}.guide-sidebar .guide-nav .guide-nav-item:hover{background:var(--surface-color);transform:translate(2px)}.guide-sidebar .guide-nav .guide-nav-item.active{background:var(--secondary-color);color:#fff;box-shadow:var(--shadow-sm)}.guide-sidebar .guide-nav .guide-nav-item.active .nav-icon{transform:scale(1.1)}.guide-sidebar .guide-nav .guide-nav-item .nav-icon{font-size:1.2rem;transition:transform var(--transition-base)}.guide-sidebar .guide-nav .guide-nav-item .nav-title{font-weight:500;font-size:.9rem}.guide-main{flex:1;overflow-y:auto;padding:var(--spacing-lg)}.guide-main .guide-section-content{line-height:1.6}.guide-main .guide-section-content h2{color:var(--primary-color);margin:0 0 var(--spacing-lg) 0;font-size:1.5rem}.guide-main .guide-section-content h3{color:var(--secondary-color);margin:var(--spacing-lg) 0 var(--spacing-md) 0;font-size:1.2rem}.guide-main .guide-section-content h4{color:var(--text-color);margin:var(--spacing-md) 0 var(--spacing-sm) 0;font-size:1rem}.guide-main .guide-section-content h5{color:var(--text-light);margin:var(--spacing-sm) 0;font-size:.9rem}.guide-main .guide-section-content p{margin:0 0 var(--spacing-md) 0;color:var(--text-color)}.guide-main .guide-section-content ul,.guide-main .guide-section-content ol{margin:0 0 var(--spacing-md) 0;padding-left:var(--spacing-lg)}.guide-main .guide-section-content ul li,.guide-main .guide-section-content ol li{margin-bottom:var(--spacing-xs);color:var(--text-color)}.guide-main .guide-section-content .guide-welcome{text-align:center;margin-bottom:var(--spacing-xl)}.guide-main .guide-section-content .guide-welcome h2{color:var(--secondary-color);margin-bottom:var(--spacing-md)}.guide-main .guide-section-content .key-objectives,.guide-main .guide-section-content .getting-started{background:var(--background-alt);padding:var(--spacing-md);border-radius:var(--border-radius);margin:var(--spacing-lg) 0}.guide-main .guide-section-content .key-objectives h3,.guide-main .guide-section-content .getting-started h3{margin-top:0;color:var(--primary-color)}.guide-main .guide-section-content .control-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-md);margin:var(--spacing-md) 0}.guide-main .guide-section-content .control-grid .control-item{padding:var(--spacing-sm);background:var(--surface-color);border-radius:var(--border-radius);border-left:3px solid var(--secondary-color)}.guide-main .guide-section-content .control-grid .control-item strong{color:var(--secondary-color)}.guide-main .guide-section-content .shortcut-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--spacing-sm);margin:var(--spacing-md) 0}.guide-main .guide-section-content .shortcut-list .shortcut-item{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-sm);background:var(--background-alt);border-radius:var(--border-radius)}.guide-main .guide-section-content .shortcut-list .shortcut-item kbd{background:var(--primary-color);color:#fff;padding:2px 6px;border-radius:3px;font-size:.8rem;font-family:monospace}.guide-main .guide-section-content .indicator-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--spacing-lg);margin:var(--spacing-lg) 0}.guide-main .guide-section-content .indicator-grid .indicator-item{background:var(--surface-color);padding:var(--spacing-md);border-radius:var(--border-radius);border:1px solid var(--border-color)}.guide-main .guide-section-content .indicator-grid .indicator-item h4{color:var(--secondary-color);margin-top:0}.guide-main .guide-section-content .indicator-grid .indicator-item .indicator-ranges{display:flex;flex-direction:column;gap:var(--spacing-xs);margin-top:var(--spacing-sm)}.guide-main .guide-section-content .indicator-grid .indicator-item .indicator-ranges .range-good{color:var(--success-color);font-weight:500}.guide-main .guide-section-content .indicator-grid .indicator-item .indicator-ranges .range-caution{color:var(--warning-color);font-weight:500}.guide-main .guide-section-content .indicator-grid .indicator-item .indicator-ranges .range-danger{color:var(--accent-color);font-weight:500}.guide-main .guide-section-content .approval-ranges{margin:var(--spacing-md) 0}.guide-main .guide-section-content .approval-ranges .approval-range{margin:var(--spacing-xs) 0;padding:var(--spacing-sm);border-radius:var(--border-radius)}.guide-main .guide-section-content .approval-ranges .approval-range .range-excellent{color:var(--success-color);font-weight:600}.guide-main .guide-section-content .approval-ranges .approval-range .range-good{color:var(--success-color);font-weight:500}.guide-main .guide-section-content .approval-ranges .approval-range .range-caution{color:var(--warning-color);font-weight:500}.guide-main .guide-section-content .approval-ranges .approval-range .range-danger{color:var(--accent-color);font-weight:500}.guide-main .guide-section-content .save-type{background:var(--background-alt);padding:var(--spacing-md);border-radius:var(--border-radius);margin:var(--spacing-md) 0}.guide-main .guide-section-content .save-type h4{margin-top:0;color:var(--secondary-color)}.guide-main .guide-section-content .system-interaction,.guide-main .guide-section-content .mechanic-detail,.guide-main .guide-section-content .crisis-type,.guide-main .guide-section-content .tool-category,.guide-main .guide-section-content .theory-approach,.guide-main .guide-section-content .scenario{background:var(--surface-color);padding:var(--spacing-md);border-radius:var(--border-radius);margin:var(--spacing-md) 0;border-left:3px solid var(--secondary-color)}.guide-main .guide-section-content .system-interaction h4,.guide-main .guide-section-content .system-interaction h5,.guide-main .guide-section-content .mechanic-detail h4,.guide-main .guide-section-content .mechanic-detail h5,.guide-main .guide-section-content .crisis-type h4,.guide-main .guide-section-content .crisis-type h5,.guide-main .guide-section-content .tool-category h4,.guide-main .guide-section-content .tool-category h5,.guide-main .guide-section-content .theory-approach h4,.guide-main .guide-section-content .theory-approach h5,.guide-main .guide-section-content .scenario h4,.guide-main .guide-section-content .scenario h5{margin-top:0;color:var(--primary-color)}.guide-main .guide-section-content .theory-comparison{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-lg);margin:var(--spacing-md) 0}.guide-main .guide-section-content .cycle-breakdown{margin:var(--spacing-md) 0}.guide-main .guide-section-content .cycle-breakdown .cycle-phase{background:var(--background-alt);padding:var(--spacing-md);border-radius:var(--border-radius);margin:var(--spacing-sm) 0}.guide-main .guide-section-content .cycle-breakdown .cycle-phase h5{margin-top:0;color:var(--secondary-color)}.guide-main .guide-section-content .indicator-analysis{margin:var(--spacing-md) 0}.guide-main .guide-section-content .indicator-analysis h4{color:var(--secondary-color)}.guide-footer{background:var(--background-alt);border-top:1px solid var(--border-color);padding:var(--spacing-md) var(--spacing-lg);display:flex;justify-content:space-between;align-items:center}.guide-footer .guide-progress{flex:1}.guide-footer .guide-progress .progress-text{display:block;font-size:.875rem;color:var(--text-light);margin-bottom:var(--spacing-xs)}.guide-footer .guide-progress .progress-bar{width:100%;height:6px;background:var(--border-light);border-radius:var(--border-radius);overflow:hidden}.guide-footer .guide-progress .progress-bar .progress-fill{height:100%;background:linear-gradient(90deg,var(--secondary-color),var(--secondary-light));border-radius:var(--border-radius);transition:width var(--transition-base)}.guide-footer .guide-actions{display:flex;gap:var(--spacing-sm);margin-left:var(--spacing-lg)}.guide-footer .guide-actions .guide-btn{padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--border-color);background:var(--surface-color);color:var(--text-color);border-radius:var(--border-radius);cursor:pointer;transition:all var(--transition-base);font-size:.875rem}.guide-footer .guide-actions .guide-btn:hover:not(:disabled){background:var(--secondary-color);color:#fff;border-color:var(--secondary-color)}.guide-footer .guide-actions .guide-btn:disabled{opacity:.5;cursor:not-allowed}.guide-footer .guide-actions .guide-btn.guide-close{background:var(--accent-color);color:#fff;border-color:var(--accent-color)}.guide-footer .guide-actions .guide-btn.guide-close:hover{background:#f56565;border-color:#f56565}@media (max-width: 768px){.guide-header{flex-direction:column;gap:var(--spacing-md)}.guide-header .guide-mode-switch{width:100%;justify-content:center}.guide-content{flex-direction:column;max-height:60vh}.guide-sidebar{width:100%;max-height:150px;border-right:none;border-bottom:1px solid var(--border-color)}.guide-sidebar .guide-nav{display:flex;gap:var(--spacing-xs);overflow-x:auto;padding:var(--spacing-sm)}.guide-sidebar .guide-nav .guide-nav-item{flex-shrink:0;margin-bottom:0;white-space:nowrap}.guide-sidebar .guide-nav .guide-nav-item .nav-title{display:none}.guide-main{padding:var(--spacing-md)}.guide-main .guide-section-content .control-grid,.guide-main .guide-section-content .indicator-grid,.guide-main .guide-section-content .theory-comparison,.guide-main .guide-section-content .shortcut-list{grid-template-columns:1fr}.guide-footer{flex-direction:column;gap:var(--spacing-md)}.guide-footer .guide-actions{margin-left:0;width:100%;justify-content:center}.guide-footer .guide-actions .guide-btn{flex:1;max-width:120px}}.political-events-list{list-style:none;padding:0;margin:0}.political-events-list .political-event-item{padding:var(--spacing-sm);border:1px solid var(--border-color);border-radius:var(--border-radius);margin-bottom:var(--spacing-sm);cursor:pointer;transition:all var(--transition-base);background:var(--surface-color)}.political-events-list .political-event-item:hover{background:var(--background-alt);border-color:var(--secondary-color);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.political-events-list .political-event-item .event-summary{display:flex;align-items:center;gap:var(--spacing-sm)}.political-events-list .political-event-item .event-summary .event-icon{font-size:1.2rem}.political-events-list .political-event-item .event-summary .event-title{flex:1;font-weight:500;color:var(--text-color)}.political-events-list .political-event-item .event-summary .event-deadline{font-size:.8rem;color:var(--text-light);background:rgba(0,0,0,.05);padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm)}.status-value{font-weight:600}.status-value.status-high{color:var(--success-color)}.status-value.status-medium{color:var(--warning-color)}.status-value.status-low{color:var(--accent-color)}.status-value.status-critical{color:var(--accent-color);animation:pulse 2s infinite}.pressure-value{font-weight:600}.pressure-value.pressure-low{color:var(--success-color)}.pressure-value.pressure-medium{color:var(--warning-color)}.pressure-value.pressure-high{color:var(--accent-color)}.pressure-value.pressure-critical{color:var(--accent-color);animation:pulse 2s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.7}}@keyframes slideInRight{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes slideOutRight{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}.political-event-notification .notification-header{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm);background:var(--primary-color);color:#fff;border-radius:var(--border-radius) var(--border-radius) 0 0}.political-event-notification .notification-header .notification-icon{font-size:1.2rem}.political-event-notification .notification-header .notification-title{font-weight:600}.political-event-notification .notification-content{padding:var(--spacing-md)}.political-event-notification .notification-content h4{margin-bottom:var(--spacing-sm);color:var(--text-color)}.political-event-notification .notification-content p{margin-bottom:var(--spacing-md);color:var(--text-light);line-height:1.5}.political-event-notification .notification-content .btn{padding:var(--spacing-xs) var(--spacing-sm);border:none;border-radius:var(--border-radius);background:var(--secondary-color);color:#fff;font-size:.875rem;cursor:pointer;transition:background var(--transition-base)}.political-event-notification .notification-content .btn:hover{background:var(--secondary-light)}.analytics-screen{padding:var(--spacing-lg);background:var(--background-color);min-height:100vh}.analytics-screen .analytics-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-xl)}.analytics-screen .analytics-header h1{margin:0;color:var(--primary-color);font-size:2rem}.analytics-screen .analytics-header .analytics-controls{display:flex;gap:var(--spacing-sm)}.analytics-screen .analytics-overview{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-xl)}.analytics-screen .analytics-overview .metric-card{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg);display:flex;align-items:center;gap:var(--spacing-md);transition:all var(--transition-base)}.analytics-screen .analytics-overview .metric-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.analytics-screen .analytics-overview .metric-card .metric-icon{font-size:2.5rem;opacity:.8}.analytics-screen .analytics-overview .metric-card .metric-content{flex:1}.analytics-screen .analytics-overview .metric-card .metric-content .metric-value{font-size:2rem;font-weight:700;color:var(--primary-color);margin-bottom:var(--spacing-xs)}.analytics-screen .analytics-overview .metric-card .metric-content .metric-label{font-size:.875rem;color:var(--text-light);margin-bottom:var(--spacing-xs)}.analytics-screen .analytics-overview .metric-card .metric-content .metric-grade,.analytics-screen .analytics-overview .metric-card .metric-content .metric-trend,.analytics-screen .analytics-overview .metric-card .metric-content .metric-sub,.analytics-screen .analytics-overview .metric-card .metric-content .metric-risk{font-size:.8rem;font-weight:500;padding:2px 6px;border-radius:var(--border-radius-sm)}.analytics-screen .analytics-overview .metric-card .metric-content .metric-grade{background:var(--success-color);color:#fff}.analytics-screen .analytics-overview .metric-card .metric-content .metric-trend{color:var(--success-color)}.analytics-screen .analytics-overview .metric-card .metric-content .metric-sub{color:var(--text-light)}.analytics-screen .analytics-overview .metric-card .metric-content .metric-risk[id*=low]{background:var(--success-color);color:#fff}.analytics-screen .analytics-overview .metric-card .metric-content .metric-risk[id*=medium]{background:var(--warning-color);color:#fff}.analytics-screen .analytics-overview .metric-card .metric-content .metric-risk[id*=high]{background:var(--accent-color);color:#fff}.analytics-screen .analytics-tabs{display:flex;gap:0;margin-bottom:var(--spacing-xl);background:var(--surface-color);border-radius:var(--border-radius);padding:var(--spacing-xs);box-shadow:var(--shadow-sm)}.analytics-screen .analytics-tabs .tab-btn{flex:1;padding:var(--spacing-md) var(--spacing-lg);border:none;background:none;color:var(--text-light);font-weight:500;border-radius:var(--border-radius);cursor:pointer;transition:all var(--transition-base)}.analytics-screen .analytics-tabs .tab-btn:hover{background:var(--background-alt);color:var(--text-color)}.analytics-screen .analytics-tabs .tab-btn.active{background:var(--secondary-color);color:#fff;box-shadow:var(--shadow-sm)}.analytics-screen .analytics-content .tab-content{display:none}.analytics-screen .analytics-content .tab-content.active{display:block;animation:fadeInUp .3s ease-out}.analytics-screen .analytics-content .analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:var(--spacing-lg)}.analytics-screen .analytics-content .chart-container{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg)}.analytics-screen .analytics-content .chart-container h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color);font-size:1.2rem}.analytics-screen .analytics-content .chart-container canvas{width:100%!important;height:auto!important}.analytics-screen .analytics-content .stats-panel{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg)}.analytics-screen .analytics-content .stats-panel h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color);font-size:1.2rem}.analytics-screen .analytics-content .stats-panel .stat-list{display:flex;flex-direction:column;gap:var(--spacing-md)}.analytics-screen .analytics-content .stats-panel .stat-list .stat-item{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm);background:var(--background-alt);border-radius:var(--border-radius)}.analytics-screen .analytics-content .stats-panel .stat-list .stat-item .stat-label{color:var(--text-light);font-weight:500}.analytics-screen .analytics-content .stats-panel .stat-list .stat-item .stat-value{font-weight:600;color:var(--primary-color)}.analytics-screen .analytics-content .retention-metrics{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg)}.analytics-screen .analytics-content .retention-metrics h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color);font-size:1.2rem}.analytics-screen .analytics-content .retention-metrics .retention-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:var(--spacing-md)}.analytics-screen .analytics-content .retention-metrics .retention-grid .retention-card{text-align:center;padding:var(--spacing-md);background:var(--background-alt);border-radius:var(--border-radius)}.analytics-screen .analytics-content .retention-metrics .retention-grid .retention-card .retention-value{font-size:1.5rem;font-weight:700;color:var(--secondary-color);margin-bottom:var(--spacing-xs)}.analytics-screen .analytics-content .retention-metrics .retention-grid .retention-card .retention-label{font-size:.875rem;color:var(--text-light)}.analytics-screen .analytics-content .feature-usage{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg)}.analytics-screen .analytics-content .feature-usage h3{margin:0 0 var(--spacing-md) 0;color:var(--primary-color);font-size:1.2rem}.analytics-screen .analytics-content .feature-usage .usage-list{display:flex;flex-direction:column;gap:var(--spacing-sm)}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item{display:flex;align-items:center;gap:var(--spacing-md)}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item .usage-bar{flex:1;height:8px;background:var(--border-light);border-radius:var(--border-radius);overflow:hidden}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item .usage-bar .usage-fill{height:100%;background:linear-gradient(90deg,var(--secondary-color),var(--secondary-light));transition:width .6s ease-out}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item .usage-info{min-width:120px;text-align:right}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item .usage-info .usage-feature{display:block;font-weight:500;color:var(--text-color)}.analytics-screen .analytics-content .feature-usage .usage-list .usage-item .usage-info .usage-count{display:block;font-size:.8rem;color:var(--text-light)}.analytics-screen .analytics-content .insights-container{display:flex;flex-direction:column;gap:var(--spacing-lg)}.analytics-screen .analytics-content .insights-container .insights-list{display:flex;flex-direction:column;gap:var(--spacing-md)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg);display:flex;align-items:flex-start;gap:var(--spacing-md);border-left:4px solid var(--info-color)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card.high{border-left-color:var(--accent-color)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card.medium{border-left-color:var(--warning-color)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card.low{border-left-color:var(--success-color)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-icon{font-size:2rem;opacity:.8}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-content{flex:1}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-content h4{margin:0 0 var(--spacing-xs) 0;color:var(--primary-color)}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-content p{margin:0;color:var(--text-light);line-height:1.5}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-priority{font-size:.8rem;font-weight:600;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);text-transform:uppercase}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-priority.high{background:var(--accent-color);color:#fff}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-priority.medium{background:var(--warning-color);color:#fff}.analytics-screen .analytics-content .insights-container .insights-list .insight-card .insight-priority.low{background:var(--success-color);color:#fff}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-lg)}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg);display:flex;align-items:flex-start;gap:var(--spacing-md);border:1px solid var(--border-color)}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card .rec-icon{font-size:2rem;opacity:.8}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card .rec-content{flex:1}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card .rec-content h4{margin:0 0 var(--spacing-sm) 0;color:var(--primary-color)}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card .rec-content p{margin:0 0 var(--spacing-md) 0;color:var(--text-light);line-height:1.5}.analytics-screen .analytics-content .insights-container .recommendations .recommendation-cards .recommendation-card .rec-content .btn{font-size:.875rem;padding:var(--spacing-xs) var(--spacing-md)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-lg)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card{background:var(--surface-color);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-lg);display:flex;align-items:center;gap:var(--spacing-md);border:2px solid var(--border-color);transition:all var(--transition-base)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card.unlocked{border-color:var(--success-color);background:linear-gradient(135deg,var(--surface-color) 0%,rgba(56,161,105,.05) 100%)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card.unlocked .achievement-icon{filter:grayscale(0)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card.locked{opacity:.6}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card.locked .achievement-icon{filter:grayscale(1)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card .achievement-icon{font-size:2.5rem;transition:filter var(--transition-base)}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card .achievement-info{flex:1}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card .achievement-info h4{margin:0 0 var(--spacing-xs) 0;color:var(--primary-color);font-size:1rem}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card .achievement-info p{margin:0 0 var(--spacing-sm) 0;color:var(--text-light);font-size:.875rem;line-height:1.4}.analytics-screen .analytics-content .insights-container .achievements .achievement-grid .achievement-card .achievement-info .achievement-progress{font-size:.8rem;font-weight:600;color:var(--secondary-color)}@media (max-width: 768px){.analytics-screen{padding:var(--spacing-md)}.analytics-screen .analytics-header{flex-direction:column;gap:var(--spacing-md);text-align:center}.analytics-screen .analytics-header h1{font-size:1.5rem}.analytics-screen .analytics-header .analytics-controls{width:100%;justify-content:center}.analytics-screen .analytics-overview{grid-template-columns:1fr}.analytics-screen .analytics-tabs{flex-direction:column}.analytics-screen .analytics-tabs .tab-btn{padding:var(--spacing-sm) var(--spacing-md)}.analytics-screen .analytics-content .analytics-grid{grid-template-columns:1fr}.analytics-screen .analytics-content .retention-metrics .retention-grid{grid-template-columns:repeat(2,1fr)}.analytics-screen .analytics-content .recommendations .recommendation-cards,.analytics-screen .analytics-content .achievements .achievement-grid{grid-template-columns:1fr}}\n/*$vite$:1*/',document.head.appendChild(n);const e=new class{constructor(){this.sessionData=this.initializeSession(),this.playerMetrics=this.loadPlayerMetrics(),this.retentionData=this.loadRetentionData(),this.performanceData=this.loadPerformanceData(),this.initializeEventListeners(),this.startSessionTracking()}initializeSession(){return{sessionId:this.generateSessionId(),startTime:Date.now(),endTime:null,duration:0,decisions:[],policies:[],turnsPlayed:0,approvalChanges:[],economicEvents:[],crisisesHandled:[],gameEnded:!1,endCondition:null,difficulty:"normal",tutorialCompleted:!1}}loadPlayerMetrics(){const n=localStorage.getItem("sp_sim_player_metrics");return n?JSON.parse(n):{totalSessions:0,totalPlaytime:0,averageSessionLength:0,gamesCompleted:0,gamesAbandoned:0,retentionRate:0,decisionSpeed:[],decisionTypes:{},policyPreferences:{},averageApproval:[],economicPerformance:[],crisisManagementScore:0,learningProgression:0,sessionTimes:[],preferredDifficulty:"normal",featureUsage:{},lastUpdated:Date.now()}}loadRetentionData(){const n=localStorage.getItem("sp_sim_retention_data");return n?JSON.parse(n):{firstSession:Date.now(),lastSession:Date.now(),sessionsPerDay:[],weeklyRetention:[],monthlyRetention:[],returningPlayer:!1,churnRisk:"low",engagementScore:0}}loadPerformanceData(){const n=localStorage.getItem("sp_sim_performance_data");return n?JSON.parse(n):{loadTimes:[],memoryUsage:[],fps:[],turnProcessingTime:[],uiResponseTime:[],errorRate:0,performanceScore:100}}startSessionTracking(){this.updateRetentionMetrics(),this.trackSessionStart(),this.activityInterval=setInterval(()=>{this.trackActivity()},3e4),this.saveInterval=setInterval(()=>{this.saveAnalytics()},12e4)}endSession(){this.sessionData.endTime=Date.now(),this.sessionData.duration=this.sessionData.endTime-this.sessionData.startTime,this.updatePlayerMetrics(),this.saveAnalytics(),this.activityInterval&&clearInterval(this.activityInterval),this.saveInterval&&clearInterval(this.saveInterval)}trackDecision(n){const e={timestamp:Date.now(),type:n.type||"general",description:n.description||n.message,timeTaken:n.timeTaken||0,context:{turn:n.turn,approval:n.approval,economicState:n.economicState}};this.sessionData.decisions.push(e),this.playerMetrics.decisionTypes[e.type]||(this.playerMetrics.decisionTypes[e.type]=0),this.playerMetrics.decisionTypes[e.type]+=1,e.timeTaken>0&&this.playerMetrics.decisionSpeed.push(e.timeTaken),t.emit("analytics:decision_tracked",{decision:e})}trackPolicy(n){const e={timestamp:Date.now(),type:n.type,name:n.name,effectiveness:n.effectiveness||0,cost:n.cost||0,duration:n.duration||0,approvalImpact:n.approvalImpact||0};this.sessionData.policies.push(e),this.playerMetrics.policyPreferences[e.type]||(this.playerMetrics.policyPreferences[e.type]=0),this.playerMetrics.policyPreferences[e.type]+=1,t.emit("analytics:policy_tracked",{policy:e})}trackApprovalChange(n,e,i){const a={timestamp:Date.now(),from:n,to:e,delta:e-n,reason:i||"unknown"};this.sessionData.approvalChanges.push(a),this.playerMetrics.averageApproval.push(e),t.emit("analytics:approval_tracked",{change:a})}trackCrisisHandled(n,e){const i={timestamp:Date.now(),type:n.type,severity:n.severity,outcome:e.success?"success":"failure",score:e.score||0,responseTime:e.responseTime||0};this.sessionData.crisisesHandled.push(i);const a=this.sessionData.crisisesHandled.slice(-10),s=a.filter(n=>"success"===n.outcome).length/a.length;this.playerMetrics.crisisManagementScore=Math.round(100*s),t.emit("analytics:crisis_tracked",{crisis:i})}trackFeatureUsage(n){this.playerMetrics.featureUsage[n]||(this.playerMetrics.featureUsage[n]=0),this.playerMetrics.featureUsage[n]+=1,t.emit("analytics:feature_tracked",{feature:n})}trackPerformance(n){n.loadTime&&this.performanceData.loadTimes.push({timestamp:Date.now(),value:n.loadTime}),n.memoryUsage&&this.performanceData.memoryUsage.push({timestamp:Date.now(),value:n.memoryUsage}),n.fps&&this.performanceData.fps.push({timestamp:Date.now(),value:n.fps}),this.updatePerformanceScore()}getAnalytics(){return{session:this.sessionData,player:this.playerMetrics,retention:this.retentionData,performance:this.performanceData,insights:this.generateInsights()}}getPlayerPerformance(){const n=this.playerMetrics.averageApproval.length>0?this.playerMetrics.averageApproval.reduce((n,e)=>n+e,0)/this.playerMetrics.averageApproval.length:0,e=this.playerMetrics.totalPlaytime/Math.max(1,this.playerMetrics.totalSessions),t=this.playerMetrics.gamesCompleted/Math.max(1,this.playerMetrics.gamesCompleted+this.playerMetrics.gamesAbandoned),i=Math.round(.3*n+.2*this.playerMetrics.crisisManagementScore+.2*this.playerMetrics.learningProgression+100*t*.3);return{overallScore:i,averageApproval:Math.round(n),sessionLength:Math.round(e),completionRate:Math.round(100*t),crisisManagement:this.playerMetrics.crisisManagementScore,learningProgression:this.playerMetrics.learningProgression,performanceGrade:this.getPerformanceGradeFromScore(i)}}getRetentionMetrics(){const n=(Date.now()-this.retentionData.firstSession)/864e5,e=(Date.now()-this.retentionData.lastSession)/864e5;return{daysSinceFirstPlay:Math.floor(n),daysSinceLastPlay:Math.floor(e),totalSessions:this.playerMetrics.totalSessions,engagementScore:this.retentionData.engagementScore,churnRisk:this.retentionData.churnRisk,returningPlayer:this.retentionData.returningPlayer,weeklyRetention:this.calculateWeeklyRetention()}}generateInsights(){const n=[],e=this.getPlayerPerformance(),t=this.getRetentionMetrics();e.averageApproval<40&&n.push({type:"improvement",title:"Approval Rating Challenge",message:"Consider focusing on popular policies and crisis management to improve public approval.",priority:"high"}),e.sessionLength<15&&n.push({type:"engagement",title:"Short Sessions Detected",message:"Try exploring different game features to increase engagement.",priority:"medium"}),"high"===t.churnRisk&&n.push({type:"retention",title:"Churn Risk Alert",message:"Consider trying tutorial mode or easier difficulty to improve experience.",priority:"high"});const i=Object.keys(this.playerMetrics.featureUsage).reduce((n,e)=>this.playerMetrics.featureUsage[n]>this.playerMetrics.featureUsage[e]?n:e,"dashboard");return i&&n.push({type:"strength",title:"Feature Mastery",message:`You're excelling at using the ${i} feature!`,priority:"low"}),n}initializeEventListeners(){t.on(i.TURN_END,n=>{this.sessionData.turnsPlayed+=1}),t.on(i.APPROVAL_CHANGE,n=>{this.trackApprovalChange(n.data.oldApproval,n.data.newApproval,n.data.reason)}),t.on(i.POLICY_PROPOSED,n=>{this.trackPolicy(n.data)}),t.on("ui:decision_dialog",n=>{this.trackDecision(n.data.decision)}),t.on("game:end",n=>{this.sessionData.gameEnded=!0,this.sessionData.endCondition=n.data.endCondition,this.playerMetrics.gamesCompleted+=1}),t.on("ui:navigation",n=>{this.trackFeatureUsage(n.data.screen)}),t.on("performance:metrics",n=>{this.trackPerformance(n.data)})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}trackSessionStart(){this.playerMetrics.totalSessions+=1,this.retentionData.lastSession=Date.now(),this.playerMetrics.totalSessions>1&&(this.retentionData.returningPlayer=!0)}trackActivity(){this.sessionData.duration=Date.now()-this.sessionData.startTime;const n=Math.min(100,5*this.sessionData.decisions.length+2*this.sessionData.turnsPlayed);this.retentionData.engagementScore=n}updateRetentionMetrics(){const n=(Date.now()-this.retentionData.lastSession)/864e5;this.retentionData.churnRisk=n>7?"high":n>3?"medium":"low"}updatePlayerMetrics(){const n=this.sessionData.duration/6e4;this.playerMetrics.totalPlaytime+=n,this.playerMetrics.averageSessionLength=this.playerMetrics.totalPlaytime/this.playerMetrics.totalSessions,this.updateLearningProgression()}updateLearningProgression(){const n=this.playerMetrics.averageApproval.slice(-10);if(n.length>=5){const e=n.slice(0,n.length/2),t=n.slice(n.length/2),i=e.reduce((n,e)=>n+e,0)/e.length,a=t.reduce((n,e)=>n+e,0)/t.length;this.playerMetrics.learningProgression=Math.max(0,Math.min(100,a-i+50))}}calculateOverallScore(){const n=this.playerMetrics.averageApproval.length>0?this.playerMetrics.averageApproval.reduce((n,e)=>n+e,0)/this.playerMetrics.averageApproval.length:0,e=this.playerMetrics.gamesCompleted/Math.max(1,this.playerMetrics.gamesCompleted+this.playerMetrics.gamesAbandoned);return Math.round(.3*n+.2*this.playerMetrics.crisisManagementScore+.2*this.playerMetrics.learningProgression+100*e*.3)}getPerformanceGrade(){const n=this.calculateOverallScore();return this.getPerformanceGradeFromScore(n)}getPerformanceGradeFromScore(n){return n>=90?"A+":n>=80?"A":n>=70?"B":n>=60?"C":n>=50?"D":"F"}calculateWeeklyRetention(){const n=(Date.now()-this.retentionData.firstSession)/6048e5;return Math.max(0,Math.min(100,this.playerMetrics.totalSessions/Math.max(1,n)*100))}updatePerformanceScore(){let n=100;this.performanceData.loadTimes.slice(-10).reduce((n,e)=>n+e.value,0)/10>3e3&&(n-=20),this.performanceData.memoryUsage.slice(-10).reduce((n,e)=>n+e.value,0)/10>100&&(n-=15),this.performanceData.fps.slice(-10).reduce((n,e)=>n+e.value,0)/10<30&&(n-=25),this.performanceData.performanceScore=Math.max(0,n)}saveAnalytics(){try{localStorage.setItem("sp_sim_player_metrics",JSON.stringify(this.playerMetrics)),localStorage.setItem("sp_sim_retention_data",JSON.stringify(this.retentionData)),localStorage.setItem("sp_sim_performance_data",JSON.stringify(this.performanceData))}catch(n){console.error("Failed to save analytics:",n)}}clearAnalytics(){localStorage.removeItem("sp_sim_player_metrics"),localStorage.removeItem("sp_sim_retention_data"),localStorage.removeItem("sp_sim_performance_data"),this.playerMetrics=this.loadPlayerMetrics(),this.retentionData=this.loadRetentionData(),this.performanceData=this.loadPerformanceData()}};document.addEventListener("visibilitychange",()=>{document.hidden?e.endSession():e.startSessionTracking()}),window.addEventListener("beforeunload",()=>{e.endSession()});class v extends d{constructor(){super(),this.currentScreen="dashboard",this.screens={dashboard:"Dashboard",economy:"Economy",politics:"Politics",global:"Global Relations",policies:"Policies",crisis:"Crisis Management",analytics:"Analytics",settings:"Settings",help:"Help Guide"},this.initializeNavigation(),this.setupEventListeners()}initializeNavigation(){let n=document.querySelector(".navigation");if(!n){n=this.createElement("nav","navigation");const e=document.querySelector(".header");e&&e.appendChild(n)}this.element=n,this.renderNavigationMenu()}renderNavigationMenu(){const n=this.createElement("ul","navigation__menu");Object.entries(this.screens).forEach(([e,t])=>{const i=this.createElement("li","navigation__item"),a=this.createElement("a","navigation__link",t);a.setAttribute("href",`#${e}`),a.setAttribute("data-screen",e),e===this.currentScreen&&a.classList.add("navigation__link--active"),i.appendChild(a),n.appendChild(i)}),this.element.innerHTML="",this.element.appendChild(n)}setupEventListeners(){this.addEventListener(this.element,"click",n=>{n.preventDefault();const e=n.target.closest(".navigation__link");if(e){const n=e.getAttribute("data-screen");this.navigateToScreen(n)}}),t.on("navigation:goto",n=>{this.navigateToScreen(n.data.screen)})}navigateToScreen(n){if(!this.screens[n]||n===this.currentScreen)return;const e=this.element.querySelector(".navigation__link--active");e&&e.classList.remove("navigation__link--active");const a=this.element.querySelector(`[data-screen="${n}"]`);a&&a.classList.add("navigation__link--active");const s=this.currentScreen;this.currentScreen=n,t.emit(i.UI_UPDATE,{type:"navigation",from:s,to:n,screenTitle:this.screens[n]}),window.history&&window.history.pushState({screen:n},this.screens[n],`#${n}`),console.log(`Navigated to ${this.screens[n]}`)}getCurrentScreen(){return this.currentScreen}update(n){this.updateScreenBadges(n)}updateScreenBadges(n){this.element.querySelectorAll(".navigation__badge").forEach(n=>{n.remove()}),n.events.pending.length>0&&this.addScreenBadge("policies",n.events.pending.length),n.scandals.active.length>0&&this.addScreenBadge("crisis",n.scandals.active.length),(n.economy.gdpGrowth<0||n.economy.unemployment>8)&&this.addScreenBadge("economy","!")}addScreenBadge(n,e){const t=this.element.querySelector(`[data-screen="${n}"]`);if(t){const n=this.createElement("span","navigation__badge",e);t.appendChild(n)}}}class u extends d{constructor(n={}){super(),this.options={title:"Dialog",content:"",type:"info",confirmText:"OK",cancelText:"Cancel",showCancel:!1,onConfirm:null,onCancel:null,backdrop:!0,closeable:!0,...n},this.isOpen=!1,this.createModal()}createModal(){this.backdrop=this.createElement("div","modal-backdrop"),this.options.backdrop||(this.backdrop.style.background="transparent",this.backdrop.style.pointerEvents="none"),this.element=this.createElement("div","modal"),this.modalContent=this.createElement("div","modal__content"),this.modalHeader=this.createElement("div","modal__header"),this.modalTitle=this.createElement("h3","modal__title",this.options.title),this.modalHeader.appendChild(this.modalTitle),this.options.closeable&&(this.closeButton=this.createElement("button","modal__close","×"),this.modalHeader.appendChild(this.closeButton)),this.modalBody=this.createElement("div","modal__body"),this.setContent(this.options.content),this.modalFooter=this.createElement("div","modal__footer"),this.createFooterButtons(),this.modalContent.appendChild(this.modalHeader),this.modalContent.appendChild(this.modalBody),this.modalContent.appendChild(this.modalFooter),this.element.appendChild(this.modalContent),this.backdrop.appendChild(this.element),this.setupEventListeners(),this.hide()}createFooterButtons(){this.modalFooter.innerHTML="",(this.options.showCancel||"confirm"===this.options.type)&&(this.cancelButton=this.createElement("button","btn btn--secondary",this.options.cancelText),this.modalFooter.appendChild(this.cancelButton)),this.confirmButton=this.createElement("button","btn btn--primary",this.options.confirmText),this.modalFooter.appendChild(this.confirmButton)}setupEventListeners(){this.closeButton&&this.addEventListener(this.closeButton,"click",()=>{this.close()}),this.cancelButton&&this.addEventListener(this.cancelButton,"click",()=>{this.cancel()}),this.confirmButton&&this.addEventListener(this.confirmButton,"click",()=>{this.confirm()}),this.options.backdrop&&this.options.closeable&&this.addEventListener(this.backdrop,"click",n=>{n.target===this.backdrop&&this.close()}),this.addEventListener(document,"keydown",n=>{"Escape"===n.key&&this.isOpen&&this.options.closeable&&this.close()})}setContent(n){"string"==typeof n?this.modalBody.innerHTML=n:n instanceof HTMLElement&&(this.modalBody.innerHTML="",this.modalBody.appendChild(n))}setTitle(n){this.options.title=n,this.modalTitle.textContent=n}show(){if(!this.isOpen){if(document.body.appendChild(this.backdrop),requestAnimationFrame(()=>{this.backdrop.classList.add("modal-backdrop--visible"),this.element.classList.add("modal--visible")}),this.isOpen=!0,"form"===this.options.type){const n=this.modalBody.querySelector("input, textarea, select");n&&n.focus()}t.emit("modal:show",{modal:this})}}hide(){this.isOpen&&(this.backdrop.classList.remove("modal-backdrop--visible"),this.element.classList.remove("modal--visible"),setTimeout(()=>{this.backdrop.parentNode&&document.body.removeChild(this.backdrop)},300),this.isOpen=!1,t.emit("modal:hide",{modal:this}))}close(){this.hide()}confirm(){let n=!0;if("form"===this.options.type){const e=this.collectFormData();this.options.onConfirm&&(n=this.options.onConfirm(e))}else this.options.onConfirm&&(n=this.options.onConfirm());!1!==n&&this.hide()}cancel(){this.options.onCancel&&this.options.onCancel(),this.hide()}collectFormData(){const n={};return this.modalBody.querySelectorAll("input, textarea, select").forEach(e=>{const t=e.name||e.id;t&&("checkbox"===e.type?n[t]=e.checked:"radio"===e.type?e.checked&&(n[t]=e.value):n[t]=e.value)}),n}static confirm(n,e,t,i){return new u({title:n,content:`<p>${e}</p>`,type:"confirm",confirmText:"Yes",cancelText:"No",showCancel:!0,onConfirm:t,onCancel:i}).show()}static alert(n,e,t){return new u({title:n,content:`<p>${e}</p>`,type:"info",confirmText:"OK",onConfirm:t}).show()}static prompt(n,e,t,i=""){return new u({title:n,content:`\n      <p>${e}</p>\n      <input type="text" name="value" value="${i}" class="form-input" style="width: 100%; margin-top: 10px;">\n    `,type:"form",confirmText:"OK",cancelText:"Cancel",showCancel:!0,onConfirm:n=>(t&&t(n.value),!0)}).show()}destroy(){this.hide(),this.removeAllEventListeners()}}class h extends d{constructor(){super(),this.setupEventListeners()}setupEventListeners(){t.on("monetization:feature_blocked",n=>{this.showUpgradeModal(n.data)}),t.on("monetization:save_limit_reached",n=>{this.showSaveLimitModal(n.data)}),t.on("policy:rejected",n=>{"monetization_limit"===n.data.reason&&n.data.upgradePrompt&&this.showPolicyUpgradeModal(n.data)})}showUpgradeModal(n){const{feature:e,upgradePrompt:t}=n;new u({title:t.title||`Premium Feature: ${e}`,content:this.renderUpgradeContent(t),confirmText:"Upgrade Now",cancelText:"Maybe Later",showCancel:!0,onConfirm:()=>(this.handleUpgradeAction(e),!0)}).show()}showSaveLimitModal(n){const{limit:e,current:t}=n;new u({title:"Save Limit Reached",content:`\n        <div class="save-limit-modal">\n          <div class="limit-info">\n            <p>You've reached your save limit (${t}/${e}).</p>\n            <p>Upgrade to premium for unlimited saves and cloud sync!</p>\n          </div>\n          \n          <div class="premium-benefits">\n            <h4>Premium Benefits:</h4>\n            <ul>\n              <li>✅ Unlimited saves</li>\n              <li>✅ Cloud synchronization</li>\n              <li>✅ Save organization</li>\n              <li>✅ Backup & restore</li>\n              <li>✅ Advanced analytics</li>\n              <li>✅ Premium scenarios</li>\n            </ul>\n          </div>\n\n          <div class="trial-option">\n            <p><strong>Try Premium FREE for 7 days!</strong></p>\n          </div>\n        </div>\n      `,confirmText:"Start Free Trial",cancelText:"Continue with Free",showCancel:!0,onConfirm:()=>(this.startTrial(),!0)}).show()}showPolicyUpgradeModal(n){const{policy:e,upgradePrompt:t}=n;new u({title:"Policy Requires Premium",content:`\n        <div class="policy-upgrade-modal">\n          <div class="policy-info">\n            <h4>${e.name}</h4>\n            <p>This advanced policy requires a premium subscription.</p>\n          </div>\n          \n          ${this.renderUpgradeContent(t)}\n          \n          <div class="alternative-suggestion">\n            <h4>Free Alternative:</h4>\n            <p>Try a similar but simpler policy from the basic templates.</p>\n          </div>\n        </div>\n      `,confirmText:"Upgrade to Premium",cancelText:"Use Basic Policy",showCancel:!0,onConfirm:()=>(this.handleUpgradeAction("advanced_policies"),!0),onCancel:()=>{this.suggestAlternativePolicy(e)}}).show()}renderUpgradeContent(n){return`\n      <div class="upgrade-content">\n        <div class="feature-description">\n          <p>${n.description}</p>\n        </div>\n        \n        <div class="benefits-list">\n          <h4>What you'll get:</h4>\n          <ul>\n            ${n.benefits?.map(n=>`<li>✅ ${n}</li>`).join("")||""}\n          </ul>\n        </div>\n        \n        <div class="pricing-info">\n          ${this.renderPricingTiers()}\n        </div>\n        \n        <div class="trial-highlight">\n          <p><strong>🎁 Start with a FREE 7-day trial!</strong></p>\n          <p><small>Cancel anytime, no commitment required.</small></p>\n        </div>\n      </div>\n      \n      <style>\n        .upgrade-content {\n          max-width: 500px;\n          text-align: left;\n        }\n        \n        .feature-description {\n          margin-bottom: var(--spacing-md);\n          padding: var(--spacing-md);\n          background: rgba(59, 130, 246, 0.1);\n          border-radius: var(--border-radius);\n        }\n        \n        .benefits-list ul {\n          list-style: none;\n          padding: 0;\n        }\n        \n        .benefits-list li {\n          padding: var(--spacing-xs) 0;\n          border-bottom: 1px solid var(--border-light);\n        }\n        \n        .benefits-list li:last-child {\n          border-bottom: none;\n        }\n        \n        .pricing-tiers {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: var(--spacing-md);\n          margin: var(--spacing-md) 0;\n        }\n        \n        .pricing-tier {\n          border: 1px solid var(--border-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-md);\n          text-align: center;\n          transition: all var(--transition-base);\n        }\n        \n        .pricing-tier:hover {\n          border-color: var(--secondary-color);\n          box-shadow: var(--shadow-sm);\n        }\n        \n        .tier-recommended {\n          border-color: var(--secondary-color);\n          background: rgba(59, 130, 246, 0.05);\n          position: relative;\n        }\n        \n        .tier-recommended::before {\n          content: "Most Popular";\n          position: absolute;\n          top: -10px;\n          left: 50%;\n          transform: translateX(-50%);\n          background: var(--secondary-color);\n          color: white;\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius);\n          font-size: 0.8rem;\n          font-weight: 500;\n        }\n        \n        .tier-name {\n          font-weight: 600;\n          color: var(--primary-color);\n          margin-bottom: var(--spacing-xs);\n        }\n        \n        .tier-price {\n          font-size: 1.5rem;\n          font-weight: 700;\n          color: var(--secondary-color);\n          margin-bottom: var(--spacing-xs);\n        }\n        \n        .tier-period {\n          font-size: 0.9rem;\n          color: var(--text-light);\n          margin-bottom: var(--spacing-sm);\n        }\n        \n        .tier-features {\n          list-style: none;\n          padding: 0;\n          font-size: 0.9rem;\n        }\n        \n        .tier-features li {\n          padding: var(--spacing-xs) 0;\n        }\n        \n        .trial-highlight {\n          text-align: center;\n          background: linear-gradient(135deg, #10b981, #34d399);\n          color: white;\n          padding: var(--spacing-md);\n          border-radius: var(--border-radius);\n          margin-top: var(--spacing-md);\n        }\n        \n        .trial-highlight p {\n          margin: 0;\n        }\n        \n        .trial-highlight small {\n          opacity: 0.9;\n        }\n        \n        @media (max-width: 768px) {\n          .pricing-tiers {\n            grid-template-columns: 1fr;\n          }\n        }\n      </style>\n    `}renderPricingTiers(){return'\n      <div class="pricing-tiers">\n        <div class="pricing-tier">\n          <div class="tier-name">Premium</div>\n          <div class="tier-price">$9.99</div>\n          <div class="tier-period">per month</div>\n          <ul class="tier-features">\n            <li>Unlimited saves</li>\n            <li>Advanced analytics</li>\n            <li>Premium scenarios</li>\n            <li>Export data</li>\n          </ul>\n        </div>\n        \n        <div class="pricing-tier tier-recommended">\n          <div class="tier-name">Educational</div>\n          <div class="tier-price">$29.99</div>\n          <div class="tier-period">per month</div>\n          <ul class="tier-features">\n            <li>All Premium features</li>\n            <li>Classroom management</li>\n            <li>Student tracking</li>\n            <li>Curriculum alignment</li>\n          </ul>\n        </div>\n      </div>\n    '}handleUpgradeAction(n){a.trials.premiumTrialUsed?this.showPurchaseOptions(n):this.startTrial()}startTrial(){const n=a.startTrial("premium");n.success?(new u({title:"🎉 Premium Trial Started!",content:`\n          <div class="trial-success">\n            <p>Welcome to SP_Sim Premium!</p>\n            <p>Your 7-day free trial has started. You now have access to:</p>\n            <ul>\n              <li>✅ Unlimited saves with cloud sync</li>\n              <li>✅ Advanced analytics and reporting</li>\n              <li>✅ Premium policy scenarios</li>\n              <li>✅ Data export capabilities</li>\n              <li>✅ Priority customer support</li>\n            </ul>\n            <p><strong>Trial ends:</strong> ${new Date(n.endDate).toLocaleDateString()}</p>\n            <p><small>You can cancel anytime before the trial ends.</small></p>\n          </div>\n        `,confirmText:"Start Playing!",showCancel:!1}).show(),t.emit("ui:refresh_screen")):this.showTrialError(n.reason)}showTrialError(n){let e="Unable to start trial. Please try again.";"trial_already_used"===n&&(e="You have already used your free trial. Consider upgrading to premium!"),new u({title:"Trial Not Available",content:`<p>${e}</p>`,confirmText:"OK",showCancel:!1}).show()}showPurchaseOptions(n){new u({title:"Upgrade to Premium",content:'\n        <div class="purchase-options">\n          <p>In a real app, this would redirect to payment processing.</p>\n          <p>For this demo, you can simulate the upgrade process.</p>\n          <div class="demo-notice">\n            <p><strong>Demo Mode:</strong> Click "Simulate Upgrade" to test premium features.</p>\n          </div>\n        </div>\n      ',confirmText:"Simulate Upgrade",cancelText:"Cancel",showCancel:!0,onConfirm:()=>(this.simulateUpgrade(),!0)}).show()}simulateUpgrade(){a.upgrade("premium",{type:"demo",validUntil:new Date(Date.now()+31536e6).toISOString()}),new u({title:"🎉 Upgrade Successful!",content:'\n        <div class="upgrade-success">\n          <p>Welcome to SP_Sim Premium!</p>\n          <p>You now have access to all premium features:</p>\n          <ul>\n            <li>✅ Unlimited saves and cloud sync</li>\n            <li>✅ Advanced analytics dashboard</li>\n            <li>✅ Premium policy scenarios</li>\n            <li>✅ Data export and sharing</li>\n            <li>✅ Priority support</li>\n            <li>✅ Scenario editor</li>\n          </ul>\n          <p><strong>Thank you for supporting SP_Sim!</strong></p>\n        </div>\n      ',confirmText:"Explore Premium Features",showCancel:!1,onConfirm:()=>(t.emit("ui:refresh_screen"),t.emit("navigation:goto",{screen:"analytics"}),!0)}).show()}suggestAlternativePolicy(n){t.emit("policy:suggest_alternative",{originalPolicy:n,category:n.category})}showSubscriptionStatus(){const n=a.getDashboardData();new u({title:"Subscription Status",content:`\n        <div class="subscription-status">\n          <div class="current-tier">\n            <h4>Current Plan: ${n.tier.charAt(0).toUpperCase()+n.tier.slice(1)}</h4>\n          </div>\n          \n          <div class="features-list">\n            <h4>Available Features:</h4>\n            <ul>\n              ${n.features.map(n=>`<li>✅ ${n.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}</li>`).join("")}\n            </ul>\n          </div>\n          \n          <div class="usage-stats">\n            <h4>Usage Statistics:</h4>\n            <ul>\n              <li>Sessions: ${n.usage.sessionsCount}</li>\n              <li>Features Used: ${n.usage.featuresUsed.length}</li>\n              <li>Scenarios Completed: ${n.usage.scenariosCompleted}</li>\n              <li>Achievements: ${n.usage.achievementsUnlocked}</li>\n            </ul>\n          </div>\n          \n          ${n.trial.active?`\n            <div class="trial-info">\n              <h4>🎁 Trial Active</h4>\n              <p>Trial ends: ${new Date(n.trial.endDate).toLocaleDateString()}</p>\n            </div>\n          `:""}\n        </div>\n      `,confirmText:"free"===n.tier?"Upgrade Now":"Close",showCancel:!1,onConfirm:()=>"free"!==n.tier||(this.showUpgradeModal({feature:"premium_upgrade",upgradePrompt:{title:"Upgrade to Premium",description:"Unlock all premium features and enhance your political simulation experience.",benefits:["Unlimited saves","Advanced analytics","Premium scenarios","Data export","Priority support"]}}),!1)}).show()}}class b extends d{constructor(){super(),this.activePolicies=[],this.draftPolicies=[],this.policyTemplates=this.initializePolicyTemplates(),this.selectedCategory="economic",this.currentDraft=null,this.gameState=null,this.monetizationModal=new h,this.setupEventListeners()}setupEventListeners(){t.on("game:state_updated",n=>{this.updatePolicyStatus(n.data)}),t.on("policy:implemented",n=>{this.handlePolicyImplemented(n.data)}),t.on("policy:rejected",n=>{this.handlePolicyRejected(n.data)})}initializePolicyTemplates(){return{economic:[{id:"tax_reform",name:"Tax Reform Package",description:"Comprehensive reform of the taxation system",category:"economic",baseCost:5e8,duration:12,effects:{gdp:{min:-.5,max:2},approval:{min:-8,max:12},debt:{min:-1,max:.5},unemployment:{min:-.2,max:.3}},requirements:{approval:45,coalitionSupport:60},complexity:"high"},{id:"infrastructure_investment",name:"Infrastructure Investment Program",description:"Major investment in roads, bridges, and digital infrastructure",category:"economic",baseCost:2e9,duration:24,effects:{gdp:{min:.5,max:3},approval:{min:2,max:8},debt:{min:1,max:3},unemployment:{min:-1.5,max:-.5}},requirements:{approval:35,coalitionSupport:55},complexity:"high"},{id:"small_business_support",name:"Small Business Support Package",description:"Tax incentives and grants for small businesses",category:"economic",baseCost:1e8,duration:6,effects:{gdp:{min:.2,max:1},approval:{min:1,max:5},debt:{min:.1,max:.5},unemployment:{min:-.5,max:-.1}},requirements:{approval:30,coalitionSupport:40},complexity:"medium"}],social:[{id:"healthcare_expansion",name:"Healthcare System Expansion",description:"Expand healthcare coverage and improve access",category:"social",baseCost:15e8,duration:18,effects:{approval:{min:5,max:15},debt:{min:1.5,max:2.5},gdp:{min:-.2,max:.8}},requirements:{approval:40,coalitionSupport:65},complexity:"high"},{id:"education_reform",name:"Education System Reform",description:"Modernize education curriculum and infrastructure",category:"social",baseCost:8e8,duration:36,effects:{approval:{min:3,max:10},debt:{min:.8,max:1.5},gdp:{min:.5,max:2}},requirements:{approval:35,coalitionSupport:50},complexity:"high"},{id:"unemployment_benefits",name:"Enhanced Unemployment Benefits",description:"Increase unemployment benefits and extend duration",category:"social",baseCost:3e8,duration:3,effects:{approval:{min:2,max:8},debt:{min:.3,max:.8},unemployment:{min:.1,max:.3}},requirements:{approval:25,coalitionSupport:45},complexity:"low"}],environmental:[{id:"carbon_tax",name:"Carbon Tax Implementation",description:"Implement carbon pricing to reduce emissions",category:"environmental",baseCost:5e7,duration:6,effects:{approval:{min:-5,max:8},gdp:{min:-.8,max:.2},debt:{min:-.5,max:.1}},requirements:{approval:45,coalitionSupport:60},complexity:"medium"},{id:"renewable_energy",name:"Renewable Energy Transition",description:"Massive investment in renewable energy infrastructure",category:"environmental",baseCost:3e9,duration:48,effects:{approval:{min:3,max:12},gdp:{min:.2,max:2.5},debt:{min:2,max:4},unemployment:{min:-2,max:-.5}},requirements:{approval:40,coalitionSupport:55},complexity:"high"}],foreign:[{id:"trade_agreement",name:"New Trade Agreement",description:"Negotiate comprehensive trade agreement with key partners",category:"foreign",baseCost:1e7,duration:12,effects:{gdp:{min:.5,max:2},approval:{min:-3,max:6},unemployment:{min:-.5,max:.2}},requirements:{approval:35,coalitionSupport:50},complexity:"medium"},{id:"defense_spending",name:"Defense Budget Adjustment",description:"Adjust military spending and modernize equipment",category:"foreign",baseCost:1e9,duration:12,effects:{approval:{min:-2,max:8},debt:{min:.5,max:1.5},gdp:{min:.1,max:.8}},requirements:{approval:30,coalitionSupport:45},complexity:"medium"}]}}render(){return`\n      <div class="policy-screen">\n        <div class="policy-header">\n          <h2>📋 Policy Management Center</h2>\n          <div class="policy-stats">\n            <div class="stat-item">\n              <span class="stat-label">Active Policies</span>\n              <span class="stat-value">${this.activePolicies.length}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Draft Policies</span>\n              <span class="stat-value">${this.draftPolicies.length}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Political Capital</span>\n              <span class="stat-value">${this.gameState?this.getPoliticalCapital():"0"}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Implementation Capacity</span>\n              <span class="stat-value">${this.getImplementationCapacity()}%</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Subscription</span>\n              <span class="stat-value subscription-tier tier-${a.subscriptionTier}">\n                ${a.subscriptionTier.charAt(0).toUpperCase()+a.subscriptionTier.slice(1)}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div class="policy-content">\n          <div class="policy-sidebar">\n            <div class="policy-categories">\n              <h3>Policy Categories</h3>\n              <div class="category-list">\n                ${this.renderCategoryTabs()}\n              </div>\n            </div>\n\n            <div class="policy-actions">\n              <button class="btn btn--primary create-policy-btn">\n                ➕ Create New Policy\n              </button>\n              <button class="btn btn--secondary import-template-btn">\n                📥 Use Template\n              </button>\n              ${"free"===a.subscriptionTier?'\n                <button class="btn btn--premium upgrade-btn">\n                  ⭐ Upgrade to Premium\n                </button>\n              ':`\n                <button class="btn btn--success subscription-btn">\n                  👑 ${a.subscriptionTier.charAt(0).toUpperCase()+a.subscriptionTier.slice(1)} Member\n                </button>\n              `}\n            </div>\n\n            <div class="quick-stats">\n              <h4>Implementation Capacity</h4>\n              ${this.renderImplementationCapacity()}\n            </div>\n          </div>\n\n          <div class="policy-main">\n            <div class="policy-tabs">\n              <button class="tab-btn active" data-tab="active">Active Policies</button>\n              <button class="tab-btn" data-tab="drafts">Drafts</button>\n              <button class="tab-btn" data-tab="templates">Templates</button>\n            </div>\n\n            <div class="policy-list-container">\n              <div class="tab-content active" id="active-tab">\n                ${this.renderActivePolicies()}\n              </div>\n              <div class="tab-content" id="drafts-tab">\n                ${this.renderDraftPolicies()}\n              </div>\n              <div class="tab-content" id="templates-tab">\n                ${this.renderPolicyTemplates()}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <style>\n        .policy-screen {\n          padding: var(--spacing-lg);\n          max-width: 1200px;\n          margin: 0 auto;\n        }\n\n        .policy-header {\n          margin-bottom: var(--spacing-lg);\n          padding: var(--spacing-lg);\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          border-radius: var(--border-radius);\n          color: white;\n        }\n\n        .policy-header h2 {\n          margin: 0 0 var(--spacing-md) 0;\n          font-size: 1.8rem;\n        }\n\n        .policy-stats {\n          display: flex;\n          gap: var(--spacing-lg);\n        }\n\n        .stat-item {\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-xs);\n        }\n\n        .stat-label {\n          font-size: 0.875rem;\n          opacity: 0.9;\n        }\n\n        .stat-value {\n          font-size: 1.5rem;\n          font-weight: 600;\n        }\n\n        .policy-content {\n          display: grid;\n          grid-template-columns: 300px 1fr;\n          gap: var(--spacing-lg);\n        }\n\n        .policy-sidebar {\n          background: white;\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          box-shadow: var(--shadow-sm);\n          height: fit-content;\n        }\n\n        .policy-categories h3 {\n          margin: 0 0 var(--spacing-md) 0;\n          color: var(--primary-color);\n        }\n\n        .category-list {\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-xs);\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .category-tab {\n          padding: var(--spacing-sm) var(--spacing-md);\n          border: 1px solid var(--border-color);\n          border-radius: var(--border-radius);\n          background: white;\n          cursor: pointer;\n          transition: all var(--transition-base);\n          text-align: left;\n        }\n\n        .category-tab:hover {\n          background: rgba(102, 126, 234, 0.1);\n          border-color: var(--secondary-color);\n        }\n\n        .category-tab.active {\n          background: var(--secondary-color);\n          color: white;\n          border-color: var(--secondary-color);\n        }\n\n        .policy-actions {\n          margin-bottom: var(--spacing-lg);\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-sm);\n        }\n\n        .quick-stats h4 {\n          margin: 0 0 var(--spacing-sm) 0;\n          color: var(--primary-color);\n          font-size: 0.9rem;\n        }\n\n        .capacity-bar {\n          background: #e2e8f0;\n          border-radius: var(--border-radius);\n          height: 8px;\n          overflow: hidden;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .capacity-fill {\n          height: 100%;\n          background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);\n          transition: width var(--transition-base);\n        }\n\n        .capacity-text {\n          font-size: 0.8rem;\n          color: var(--text-light);\n        }\n\n        .policy-main {\n          background: white;\n          border-radius: var(--border-radius);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .policy-tabs {\n          display: flex;\n          border-bottom: 1px solid var(--border-color);\n        }\n\n        .tab-btn {\n          padding: var(--spacing-md) var(--spacing-lg);\n          border: none;\n          background: none;\n          cursor: pointer;\n          transition: all var(--transition-base);\n          border-bottom: 3px solid transparent;\n        }\n\n        .tab-btn:hover {\n          background: rgba(0, 0, 0, 0.05);\n        }\n\n        .tab-btn.active {\n          border-bottom-color: var(--secondary-color);\n          color: var(--secondary-color);\n          font-weight: 600;\n        }\n\n        .tab-content {\n          display: none;\n          padding: var(--spacing-lg);\n        }\n\n        .tab-content.active {\n          display: block;\n        }\n\n        .policy-card {\n          border: 1px solid var(--border-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-md);\n          margin-bottom: var(--spacing-md);\n          transition: all var(--transition-base);\n        }\n\n        .policy-card:hover {\n          box-shadow: var(--shadow-md);\n          border-color: var(--secondary-color);\n        }\n\n        .policy-card-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: start;\n          margin-bottom: var(--spacing-sm);\n        }\n\n        .policy-title {\n          font-size: 1.1rem;\n          font-weight: 600;\n          color: var(--text-color);\n          margin: 0;\n        }\n\n        .policy-category-badge {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius);\n          font-size: 0.8rem;\n          font-weight: 500;\n        }\n\n        .category-economic { background: rgba(34, 197, 94, 0.2); color: #16a34a; }\n        .category-social { background: rgba(59, 130, 246, 0.2); color: #2563eb; }\n        .category-environmental { background: rgba(34, 197, 94, 0.2); color: #059669; }\n        .category-foreign { background: rgba(168, 85, 247, 0.2); color: #7c3aed; }\n\n        .tier-free { color: #6b7280; }\n        .tier-premium { color: #3b82f6; }\n        .tier-educational { color: #10b981; }\n        .tier-enterprise { color: #8b5cf6; }\n\n        .btn--premium {\n          background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n          color: white;\n          border: none;\n        }\n\n        .btn--premium:hover {\n          background: linear-gradient(135deg, #1d4ed8, #1e40af);\n          transform: translateY(-1px);\n          box-shadow: var(--shadow-md);\n        }\n\n        .btn--success {\n          background: linear-gradient(135deg, #10b981, #059669);\n          color: white;\n          border: none;\n        }\n\n        .active-policy-card {\n          border-left: 4px solid var(--secondary-color);\n        }\n\n        .policy-progress {\n          margin: var(--spacing-sm) 0;\n        }\n\n        .progress-info {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .progress-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n        }\n\n        .progress-percentage {\n          font-weight: 600;\n          color: var(--secondary-color);\n        }\n\n        .progress-bar {\n          width: 100%;\n          height: 8px;\n          background: #e2e8f0;\n          border-radius: var(--border-radius);\n          overflow: hidden;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .progress-fill {\n          height: 100%;\n          background: linear-gradient(90deg, var(--secondary-color), #34d399);\n          transition: width var(--transition-base);\n        }\n\n        .progress-details {\n          display: flex;\n          justify-content: space-between;\n          font-size: 0.8rem;\n          color: var(--text-light);\n        }\n\n        .policy-opposition {\n          margin: var(--spacing-sm) 0;\n          padding: var(--spacing-xs) var(--spacing-sm);\n          background: rgba(0, 0, 0, 0.02);\n          border-radius: var(--border-radius);\n        }\n\n        .opposition-info {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .opposition-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n        }\n\n        .opposition-level {\n          font-weight: 600;\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius);\n          font-size: 0.8rem;\n        }\n\n        .resistance-low {\n          background: rgba(34, 197, 94, 0.2);\n          color: #16a34a;\n        }\n\n        .resistance-medium {\n          background: rgba(245, 158, 11, 0.2);\n          color: #d97706;\n        }\n\n        .resistance-high {\n          background: rgba(239, 68, 68, 0.2);\n          color: #dc2626;\n        }\n\n        .upgrade-hint {\n          margin-top: var(--spacing-md);\n          padding: var(--spacing-md);\n          background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n          border-radius: var(--border-radius);\n          border: 1px solid rgba(59, 130, 246, 0.2);\n        }\n\n        .policy-description {\n          color: var(--text-light);\n          margin: 0 0 var(--spacing-sm) 0;\n          line-height: 1.5;\n        }\n\n        .policy-effects {\n          display: flex;\n          flex-wrap: wrap;\n          gap: var(--spacing-xs);\n          margin-bottom: var(--spacing-sm);\n        }\n\n        .effect-tag {\n          padding: 2px 6px;\n          border-radius: var(--border-radius);\n          font-size: 0.75rem;\n          font-weight: 500;\n        }\n\n        .effect-positive { background: rgba(34, 197, 94, 0.2); color: #16a34a; }\n        .effect-negative { background: rgba(239, 68, 68, 0.2); color: #dc2626; }\n        .effect-neutral { background: rgba(107, 114, 128, 0.2); color: #6b7280; }\n\n        .policy-actions-row {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .policy-status {\n          font-size: 0.875rem;\n          font-weight: 500;\n        }\n\n        .status-active { color: #16a34a; }\n        .status-draft { color: #d97706; }\n        .status-template { color: #6b7280; }\n\n        .empty-state {\n          text-align: center;\n          padding: var(--spacing-xl);\n          color: var(--text-light);\n        }\n\n        .empty-state-icon {\n          font-size: 3rem;\n          margin-bottom: var(--spacing-md);\n        }\n\n        @media (max-width: 768px) {\n          .policy-content {\n            grid-template-columns: 1fr;\n          }\n          \n          .policy-stats {\n            flex-direction: column;\n            gap: var(--spacing-md);\n          }\n        }\n      </style>\n    `}update(n){this.gameState=n,n.policies&&(this.activePolicies=n.policies.active||[])}renderCategoryTabs(){return[{id:"all",name:"📊 All Categories",icon:"📊"},{id:"economic",name:"💰 Economic",icon:"💰"},{id:"social",name:"👥 Social",icon:"👥"},{id:"environmental",name:"🌱 Environmental",icon:"🌱"},{id:"foreign",name:"🌍 Foreign Policy",icon:"🌍"}].map(n=>`\n      <button class="category-tab ${this.selectedCategory===n.id?"active":""}" \n              data-category="${n.id}">\n        ${n.icon} ${n.name.split(" ").slice(1).join(" ")}\n      </button>\n    `).join("")}renderImplementationCapacity(){const n=this.calculateImplementationCapacity();return`\n      <div class="capacity-bar">\n        <div class="capacity-fill" style="width: ${Math.min(100,n)}%"></div>\n      </div>\n      <div class="capacity-text">${n.toFixed(0)}% capacity used</div>\n    `}calculateImplementationCapacity(){return this.activePolicies.reduce((n,e)=>{let t=10;return"high"===e.complexity?t=30:"medium"===e.complexity&&(t=20),n+t},0)}getPoliticalCapital(){return this.gameState?s.calculatePoliticalCapital():0}getImplementationCapacity(){const n=o.getCapacityStatus();return Math.round(n.percentage)}renderActivePolicies(){const n=o.getActivePolicies();return 0===n.length?`\n        <div class="empty-state">\n          <div class="empty-state-icon">📋</div>\n          <h3>No Active Policies</h3>\n          <p>You haven't implemented any policies yet. Start by creating a policy or using a template.</p>\n          ${"free"===a.subscriptionTier?'\n            <div class="upgrade-hint">\n              <p><strong>💡 Tip:</strong> Premium members get access to advanced policy templates and unlimited implementations!</p>\n            </div>\n          ':""}\n        </div>\n      `:n.map(n=>this.renderActivePolicyCard(n)).join("")}renderDraftPolicies(){return 0===this.draftPolicies.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">📝</div>\n          <h3>No Draft Policies</h3>\n          <p>Create a new policy to get started.</p>\n        </div>\n      ':this.draftPolicies.map(n=>this.renderPolicyCard(n,"draft")).join("")}renderPolicyTemplates(){const n="all"===this.selectedCategory?Object.values(this.policyTemplates).flat():this.policyTemplates[this.selectedCategory]||[];return 0===n.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">📚</div>\n          <h3>No Templates Available</h3>\n          <p>No policy templates found for the selected category.</p>\n        </div>\n      ':n.map(n=>this.renderPolicyCard(n,"template")).join("")}renderActivePolicyCard(n){return`\n      <div class="policy-card active-policy-card" data-policy-id="${n.id}" data-type="active">\n        <div class="policy-card-header">\n          <h4 class="policy-title">${n.name}</h4>\n          <span class="policy-category-badge category-${n.category}">\n            ${n.category.charAt(0).toUpperCase()+n.category.slice(1)}\n          </span>\n        </div>\n        \n        <div class="policy-progress">\n          <div class="progress-info">\n            <span class="progress-label">Implementation Progress</span>\n            <span class="progress-percentage">${Math.round(n.progress)}%</span>\n          </div>\n          <div class="progress-bar">\n            <div class="progress-fill" style="width: ${n.progress}%"></div>\n          </div>\n          <div class="progress-details">\n            <span class="current-phase">Phase: ${n.currentPhase.name}</span>\n            <span class="time-remaining">~${Math.round(n.timeRemaining)} weeks remaining</span>\n          </div>\n        </div>\n        \n        <div class="policy-opposition">\n          <div class="opposition-info">\n            <span class="opposition-label">Opposition Resistance</span>\n            <span class="opposition-level resistance-${this.getResistanceLevel(n.opposition)}">\n              ${n.opposition}% ${this.getResistanceText(n.opposition)}\n            </span>\n          </div>\n        </div>\n        \n        <div class="policy-actions-row">\n          <div class="policy-meta">\n            <small>Progress: ${Math.round(n.progress)}% | Phase: ${n.currentPhase.name}</small>\n          </div>\n          <div class="policy-actions">\n            <button class="btn btn--sm btn--secondary" data-action="view-details" data-policy-id="${n.id}">\n              📊 Details\n            </button>\n            ${n.progress<100?`\n              <button class="btn btn--sm btn--danger" data-action="cancel" data-policy-id="${n.id}">\n                ❌ Cancel\n              </button>\n            `:""}\n          </div>\n        </div>\n      </div>\n    `}getResistanceLevel(n){return n<=30?"low":n<=60?"medium":"high"}getResistanceText(n){return n<=30?"Low":n<=60?"Moderate":"High"}renderPolicyCard(n,e){const t=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact"}).format(n.baseCost||n.cost||0);return`\n      <div class="policy-card" data-policy-id="${n.id}" data-type="${e}">\n        <div class="policy-card-header">\n          <h4 class="policy-title">${n.name}</h4>\n          <span class="policy-category-badge category-${n.category}">\n            ${n.category.charAt(0).toUpperCase()+n.category.slice(1)}\n          </span>\n        </div>\n        \n        <p class="policy-description">${n.description}</p>\n        \n        <div class="policy-effects">\n          ${this.renderEffectTags(n.effects)}\n        </div>\n        \n        <div class="policy-actions-row">\n          <div class="policy-meta">\n            <small>Cost: ${t} | Duration: ${n.duration} weeks</small>\n          </div>\n          <div class="policy-actions">\n            ${this.renderPolicyActions(n,e)}\n          </div>\n        </div>\n      </div>\n    `}renderEffectTags(n){return n?Object.entries(n).map(([n,e])=>{let t="effect-neutral",i=n;if("object"==typeof e&&void 0!==e.min){const a=(e.min+e.max)/2;t=a>0?"effect-positive":a<0?"effect-negative":"effect-neutral",i=`${n}: ${e.min>0?"+":""}${e.min}% to ${e.max>0?"+":""}${e.max}%`}else"number"==typeof e&&(t=e>0?"effect-positive":e<0?"effect-negative":"effect-neutral",i=`${n}: ${e>0?"+":""}${e}%`);return`<span class="effect-tag ${t}">${i}</span>`}).join(""):""}renderPolicyActions(n,e){switch(e){case"active":return`\n          <button class="btn btn--sm btn--secondary" data-action="view" data-policy-id="${n.id}">\n            👁️ View Details\n          </button>\n          <button class="btn btn--sm btn--danger" data-action="cancel" data-policy-id="${n.id}">\n            ❌ Cancel\n          </button>\n        `;case"draft":return`\n          <button class="btn btn--sm btn--primary" data-action="implement" data-policy-id="${n.id}">\n            🚀 Implement\n          </button>\n          <button class="btn btn--sm btn--secondary" data-action="edit" data-policy-id="${n.id}">\n            ✏️ Edit\n          </button>\n        `;case"template":return`\n          <button class="btn btn--sm btn--primary" data-action="use-template" data-policy-id="${n.id}">\n            📋 Use Template\n          </button>\n          <button class="btn btn--sm btn--secondary" data-action="preview" data-policy-id="${n.id}">\n            👁️ Preview\n          </button>\n        `;default:return""}}handlePolicyImplemented(n){const{policy:e}=n;this.draftPolicies=this.draftPolicies.filter(n=>n.id!==e.id),this.activePolicies.push({...e,implementedWeek:this.gameState?.time?.week||1,implementedYear:this.gameState?.time?.year||1,status:"implementing"}),this.refresh()}handlePolicyRejected(n){const{policy:e,reason:t}=n;new u({title:"Policy Rejected",content:`\n        <div class="policy-rejection">\n          <h4>${e.name}</h4>\n          <p>Your policy proposal has been rejected.</p>\n          <p><strong>Reason:</strong> ${t}</p>\n          <p>You can modify the policy and try again later.</p>\n        </div>\n      `,confirmText:"Understood",showCancel:!1}).show()}setupInteractivity(){const n=document.querySelector(".policy-screen");n&&(n.querySelectorAll(".category-tab").forEach(e=>{e.addEventListener("click",()=>{const{category:t}=e.dataset;this.selectedCategory=t,n.querySelectorAll(".category-tab").forEach(n=>n.classList.remove("active")),e.classList.add("active"),n.querySelector("#templates-tab.active")&&this.refreshTemplatesTab()})}),n.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;n.querySelectorAll(".tab-btn").forEach(n=>n.classList.remove("active")),e.classList.add("active"),n.querySelectorAll(".tab-content").forEach(n=>{n.classList.remove("active")}),n.querySelector(`#${t}-tab`).classList.add("active")})}),n.addEventListener("click",n=>{const{action:e}=n.target.dataset,{policyId:t}=n.target.dataset;e&&t&&this.handlePolicyAction(e,t)}),n.querySelector(".create-policy-btn")?.addEventListener("click",()=>{this.showCreatePolicyModal()}),n.querySelector(".import-template-btn")?.addEventListener("click",()=>{this.showTemplateSelectionModal()}),n.querySelector(".upgrade-btn")?.addEventListener("click",()=>{this.monetizationModal.showUpgradeModal({feature:"policy_management",upgradePrompt:{title:"Unlock Advanced Policy Features",description:"Get access to advanced policy templates, unlimited implementations, and detailed analytics.",benefits:["Advanced economic policy templates","Unlimited active policies","Policy impact forecasting","Implementation timeline optimization","Opposition response analysis"]}})}),n.querySelector(".subscription-btn")?.addEventListener("click",()=>{this.monetizationModal.showSubscriptionStatus()}))}handlePolicyAction(n,e){switch(n){case"use-template":this.useTemplate(e);break;case"preview":this.previewPolicy(e);break;case"implement":this.implementPolicy(e);break;case"edit":this.editPolicy(e);break;case"view":this.viewPolicyDetails(e);break;case"cancel":this.cancelPolicy(e);break;default:console.warn(`Unknown action: ${n}`)}}useTemplate(n){const e=Object.values(this.policyTemplates).flat().find(e=>e.id===n);if(!e)return;const t={...e,id:`draft_${Date.now()}`,createdAt:(new Date).toISOString(),status:"draft"};this.draftPolicies.push(t),this.refresh(),document.querySelector('[data-tab="drafts"]')?.click()}previewPolicy(n){const e=Object.values(this.policyTemplates).flat().find(e=>e.id===n);e&&this.showPolicyPreviewModal(e)}showPolicyPreviewModal(n){const e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n.baseCost);new u({title:`Policy Preview: ${n.name}`,content:`\n        <div class="policy-preview">\n          <div class="policy-overview">\n            <p><strong>Category:</strong> ${n.category.charAt(0).toUpperCase()+n.category.slice(1)}</p>\n            <p><strong>Cost:</strong> ${e}</p>\n            <p><strong>Duration:</strong> ${n.duration} weeks</p>\n            <p><strong>Complexity:</strong> ${n.complexity.charAt(0).toUpperCase()+n.complexity.slice(1)}</p>\n          </div>\n          \n          <div class="policy-description">\n            <h4>Description</h4>\n            <p>${n.description}</p>\n          </div>\n          \n          <div class="policy-effects">\n            <h4>Expected Effects</h4>\n            ${this.renderDetailedEffects(n.effects)}\n          </div>\n          \n          <div class="policy-requirements">\n            <h4>Requirements</h4>\n            <ul>\n              <li>Minimum Approval: ${n.requirements.approval}%</li>\n              <li>Coalition Support: ${n.requirements.coalitionSupport}%</li>\n            </ul>\n          </div>\n          \n          ${this.gameState?this.renderFeasibilityAssessment(n):""}\n        </div>\n      `,confirmText:"Use This Template",cancelText:"Close",showCancel:!0,onConfirm:()=>(this.useTemplate(n.id),!0)}).show()}renderDetailedEffects(n){return Object.entries(n).map(([n,e])=>{let t="";return"object"==typeof e&&void 0!==e.min&&(t=`${e.min>0?"+":""}${e.min}% to ${e.max>0?"+":""}${e.max}%`),`\n        <div class="effect-detail">\n          <span class="effect-name">${n.charAt(0).toUpperCase()+n.slice(1)}:</span>\n          <span class="effect-range">${t}</span>\n        </div>\n      `}).join("")}renderFeasibilityAssessment(n){const e=this.gameState.politics?.approval||0,t=this.gameState.politics?.coalition?.reduce((n,e)=>n+e.support,0)||0,i=e>=n.requirements.approval,a=t>=n.requirements.coalitionSupport;return`\n      <div class="feasibility-assessment">\n        <h4>Current Feasibility</h4>\n        <div class="requirement-check">\n          <span class="${i?"requirement-met":"requirement-unmet"}">\n            ${i?"✅":"❌"} Approval Rating: ${e.toFixed(1)}% (need ${n.requirements.approval}%)\n          </span>\n        </div>\n        <div class="requirement-check">\n          <span class="${a?"requirement-met":"requirement-unmet"}">\n            ${a?"✅":"❌"} Coalition Support: ${t.toFixed(1)}% (need ${n.requirements.coalitionSupport}%)\n          </span>\n        </div>\n        <div class="feasibility-verdict">\n          <strong>${i&&a?"🟢 Ready to implement":"🟡 Requirements not met"}</strong>\n        </div>\n      </div>\n    `}implementPolicy(n){const e=this.draftPolicies.find(e=>e.id===n);e&&this.checkPolicyRequirements(e)&&t.emit("policy:implement",{policy:e,gameState:this.gameState})}checkPolicyRequirements(n){if(!this.gameState)return!1;const e=this.gameState.politics?.approval||0,t=this.gameState.politics?.coalition?.reduce((n,e)=>n+e.support,0)||0,i=e>=n.requirements.approval,a=t>=n.requirements.coalitionSupport;return!(!i||!a)||(new u({title:"Requirements Not Met",content:`\n          <div class="requirements-warning">\n            <p>Cannot implement this policy. Requirements not met:</p>\n            <ul>\n              ${i?"":`<li>Need ${n.requirements.approval}% approval (currently ${e.toFixed(1)}%)</li>`}\n              ${a?"":`<li>Need ${n.requirements.coalitionSupport}% coalition support (currently ${t.toFixed(1)}%)</li>`}\n            </ul>\n            <p>Work on improving your political position before implementing this policy.</p>\n          </div>\n        `,confirmText:"Understood",showCancel:!1}).show(),!1)}showCreatePolicyModal(){new u({title:"Create New Policy",content:'\n        <div class="create-policy-form">\n          <p>Policy creation is a complex feature that will be implemented in the next update.</p>\n          <p>For now, you can use the available templates to get started with policy implementation.</p>\n          <p>Templates are available in the Templates tab and cover:</p>\n          <ul>\n            <li>Economic policies (tax reform, infrastructure, business support)</li>\n            <li>Social policies (healthcare, education, unemployment benefits)</li>\n            <li>Environmental policies (carbon tax, renewable energy)</li>\n            <li>Foreign policies (trade agreements, defense spending)</li>\n          </ul>\n        </div>\n      ',confirmText:"View Templates",cancelText:"Close",showCancel:!0,onConfirm:()=>(document.querySelector('[data-tab="templates"]')?.click(),!0)}).show()}showTemplateSelectionModal(){document.querySelector('[data-tab="templates"]')?.click()}refreshTemplatesTab(){const n=document.querySelector("#templates-tab");n&&(n.innerHTML=this.renderPolicyTemplates())}updatePolicyStatus(n){this.gameState=n,this.activePolicies.forEach(e=>{if(e.implementedWeek&&n.time){const t=52*(n.time.year-e.implementedYear)+(n.time.week-e.implementedWeek);e.progress=Math.min(100,t/e.duration*100),e.progress>=100&&(e.status="completed")}})}refresh(){const n=document.querySelector(".policy-screen");n&&(n.innerHTML=this.render(),this.setupInteractivity())}}class y extends d{constructor(){super(),this.analyticsData=null,this.refreshInterval=null,this.charts=new Map,this.initializeScreen(),this.setupEventListeners(),this.startDataRefresh()}initializeScreen(){const n=document.getElementById("analytics-screen");n?(n.innerHTML=this.generateAnalyticsHTML(),this.initializeCharts(),this.refreshData()):console.error("Analytics screen container not found")}generateAnalyticsHTML(){return'\n      <div class="analytics-screen">\n        <div class="analytics-header">\n          <h1>📊 Player Analytics Dashboard</h1>\n          <div class="analytics-controls">\n            <button id="refresh-analytics" class="btn btn--primary">🔄 Refresh</button>\n            <button id="export-analytics" class="btn btn--secondary">📥 Export Data</button>\n            <button id="clear-analytics" class="btn btn--danger">🗑️ Clear Data</button>\n          </div>\n        </div>\n\n        <div class="analytics-overview">\n          <div class="metric-card">\n            <div class="metric-icon">🎯</div>\n            <div class="metric-content">\n              <div class="metric-value" id="overall-score">--</div>\n              <div class="metric-label">Overall Score</div>\n              <div class="metric-grade" id="performance-grade">--</div>\n            </div>\n          </div>\n          \n          <div class="metric-card">\n            <div class="metric-icon">👥</div>\n            <div class="metric-content">\n              <div class="metric-value" id="approval-avg">--%</div>\n              <div class="metric-label">Avg Approval</div>\n              <div class="metric-trend" id="approval-trend">--</div>\n            </div>\n          </div>\n          \n          <div class="metric-card">\n            <div class="metric-icon">⏱️</div>\n            <div class="metric-content">\n              <div class="metric-value" id="session-length">--m</div>\n              <div class="metric-label">Avg Session</div>\n              <div class="metric-sub" id="total-playtime">--h total</div>\n            </div>\n          </div>\n          \n          <div class="metric-card">\n            <div class="metric-icon">🔄</div>\n            <div class="metric-content">\n              <div class="metric-value" id="retention-rate">--%</div>\n              <div class="metric-label">Retention Rate</div>\n              <div class="metric-risk" id="churn-risk">--</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="analytics-tabs">\n          <button class="tab-btn active" data-tab="performance">Performance</button>\n          <button class="tab-btn" data-tab="retention">Retention</button>\n          <button class="tab-btn" data-tab="behavior">Behavior</button>\n          <button class="tab-btn" data-tab="insights">Insights</button>\n        </div>\n\n        <div class="analytics-content">\n          \x3c!-- Performance Tab --\x3e\n          <div class="tab-content active" id="performance-tab">\n            <div class="analytics-grid">\n              <div class="chart-container">\n                <h3>📈 Performance Trends</h3>\n                <canvas id="performance-chart" width="400" height="200"></canvas>\n              </div>\n              \n              <div class="chart-container">\n                <h3>🏛️ Approval Rating History</h3>\n                <canvas id="approval-chart" width="400" height="200"></canvas>\n              </div>\n              \n              <div class="stats-panel">\n                <h3>📋 Performance Stats</h3>\n                <div class="stat-list">\n                  <div class="stat-item">\n                    <span class="stat-label">Crisis Management:</span>\n                    <span class="stat-value" id="crisis-score">--%</span>\n                  </div>\n                  <div class="stat-item">\n                    <span class="stat-label">Learning Progress:</span>\n                    <span class="stat-value" id="learning-progress">--%</span>\n                  </div>\n                  <div class="stat-item">\n                    <span class="stat-label">Completion Rate:</span>\n                    <span class="stat-value" id="completion-rate">--%</span>\n                  </div>\n                  <div class="stat-item">\n                    <span class="stat-label">Decision Speed:</span>\n                    <span class="stat-value" id="decision-speed">--s</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Retention Tab --\x3e\n          <div class="tab-content" id="retention-tab">\n            <div class="analytics-grid">\n              <div class="chart-container">\n                <h3>📅 Session Activity</h3>\n                <canvas id="session-chart" width="400" height="200"></canvas>\n              </div>\n              \n              <div class="retention-metrics">\n                <h3>🔄 Retention Metrics</h3>\n                <div class="retention-grid">\n                  <div class="retention-card">\n                    <div class="retention-value" id="days-since-first">--</div>\n                    <div class="retention-label">Days Since First Play</div>\n                  </div>\n                  <div class="retention-card">\n                    <div class="retention-value" id="total-sessions">--</div>\n                    <div class="retention-label">Total Sessions</div>\n                  </div>\n                  <div class="retention-card">\n                    <div class="retention-value" id="engagement-score">--</div>\n                    <div class="retention-label">Engagement Score</div>\n                  </div>\n                  <div class="retention-card">\n                    <div class="retention-value" id="weekly-retention">--%</div>\n                    <div class="retention-label">Weekly Retention</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Behavior Tab --\x3e\n          <div class="tab-content" id="behavior-tab">\n            <div class="analytics-grid">\n              <div class="chart-container">\n                <h3>🎯 Decision Patterns</h3>\n                <canvas id="decisions-chart" width="400" height="200"></canvas>\n              </div>\n              \n              <div class="chart-container">\n                <h3>📜 Policy Preferences</h3>\n                <canvas id="policies-chart" width="400" height="200"></canvas>\n              </div>\n              \n              <div class="feature-usage">\n                <h3>🎮 Feature Usage</h3>\n                <div class="usage-list" id="feature-usage-list">\n                  \x3c!-- Dynamic content --\x3e\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Insights Tab --\x3e\n          <div class="tab-content" id="insights-tab">\n            <div class="insights-container">\n              <h3>💡 Personalized Insights</h3>\n              <div class="insights-list" id="insights-list">\n                \x3c!-- Dynamic content --\x3e\n              </div>\n              \n              <div class="recommendations">\n                <h3>🎯 Recommendations</h3>\n                <div class="recommendation-cards" id="recommendations-list">\n                  \x3c!-- Dynamic content --\x3e\n                </div>\n              </div>\n              \n              <div class="achievements">\n                <h3>🏆 Analytics Achievements</h3>\n                <div class="achievement-grid" id="achievements-grid">\n                  \x3c!-- Dynamic content --\x3e\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}initializeCharts(){this.initPerformanceChart(),this.initApprovalChart(),this.initSessionChart(),this.initDecisionsChart(),this.initPoliciesChart()}initPerformanceChart(){const n=document.getElementById("performance-chart");if(!n)return;const e=new p(n.parentElement,{type:"line",title:"Performance Score Over Time",width:400,height:200,data:[],labels:[],colors:["#4CAF50"]});this.charts.set("performance",e)}initApprovalChart(){const n=document.getElementById("approval-chart");if(!n)return;const e=new p(n.parentElement,{type:"line",title:"Approval Rating History",width:400,height:200,data:[],labels:[],colors:["#2196F3"]});this.charts.set("approval",e)}initSessionChart(){const n=document.getElementById("session-chart");if(!n)return;const e=new p(n.parentElement,{type:"bar",title:"Session Activity",width:400,height:200,data:[],labels:[],colors:["#FF9800"]});this.charts.set("sessions",e)}initDecisionsChart(){const n=document.getElementById("decisions-chart");if(!n)return;const e=new p(n.parentElement,{type:"pie",title:"Decision Types",width:400,height:200,data:[],labels:[],colors:["#4CAF50","#2196F3","#FF9800","#F44336","#9C27B0","#00BCD4"]});this.charts.set("decisions",e)}initPoliciesChart(){const n=document.getElementById("policies-chart");if(!n)return;const e=new p(n.parentElement,{type:"bar",title:"Policy Preferences",width:400,height:200,data:[],labels:[],colors:["#673AB7"]});this.charts.set("policies",e)}setupEventListeners(){document.addEventListener("click",n=>{n.target.classList.contains("tab-btn")&&this.switchTab(n.target.dataset.tab)});const n=document.getElementById("refresh-analytics");n&&this.addEventListener(n,"click",()=>this.refreshData());const e=document.getElementById("export-analytics");e&&this.addEventListener(e,"click",()=>this.exportAnalytics());const i=document.getElementById("clear-analytics");i&&this.addEventListener(i,"click",()=>this.clearAnalytics()),t.on("analytics:decision_tracked",()=>this.scheduleRefresh()),t.on("analytics:policy_tracked",()=>this.scheduleRefresh()),t.on("analytics:approval_tracked",()=>this.scheduleRefresh())}switchTab(n){document.querySelectorAll(".tab-btn").forEach(n=>{n.classList.remove("active")}),document.querySelector(`[data-tab="${n}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(n=>{n.classList.remove("active")}),document.getElementById(`${n}-tab`).classList.add("active"),e.trackFeatureUsage(`analytics-${n}`)}refreshData(){this.analyticsData=e.getAnalytics(),this.updateOverviewMetrics(),this.updateCharts(),this.updateInsights(),console.log("Analytics data refreshed:",this.analyticsData)}updateOverviewMetrics(){const n=e.getPlayerPerformance(),t=e.getRetentionMetrics();this.updateElement("overall-score",n.overallScore),this.updateElement("performance-grade",n.performanceGrade),this.updateElement("approval-avg",n.averageApproval),this.updateElement("session-length",Math.round(n.sessionLength)),this.updateElement("total-playtime",Math.round(this.analyticsData.player.totalPlaytime/60)),this.updateElement("retention-rate",Math.round(t.weeklyRetention)),this.updateElement("churn-risk",t.churnRisk),this.updateElement("crisis-score",n.crisisManagement),this.updateElement("learning-progress",n.learningProgression),this.updateElement("completion-rate",n.completionRate),this.updateElement("days-since-first",t.daysSinceFirstPlay),this.updateElement("total-sessions",t.totalSessions),this.updateElement("engagement-score",t.engagementScore),this.updateElement("weekly-retention",Math.round(t.weeklyRetention));const i=this.analyticsData.player.decisionSpeed.length>0?this.analyticsData.player.decisionSpeed.reduce((n,e)=>n+e,0)/this.analyticsData.player.decisionSpeed.length/1e3:0;this.updateElement("decision-speed",Math.round(i))}updateCharts(){this.updatePerformanceChart(),this.updateApprovalChart(),this.updateSessionChart(),this.updateDecisionsChart(),this.updatePoliciesChart()}updatePerformanceChart(){const n=this.charts.get("performance");if(!n||!this.analyticsData)return;const t=Math.min(10,this.analyticsData.player.totalSessions),i=Array.from({length:t},(n,e)=>`S${e+1}`),a=e.getPlayerPerformance().overallScore,s=Array.from({length:t},(n,e)=>Math.max(0,a+20*(Math.random()-.5)));n.options.labels=i,n.updateData([{values:s,name:"Performance Score"}],i)}updateApprovalChart(){const n=this.charts.get("approval");if(!n||!this.analyticsData)return;const e=this.analyticsData.player.averageApproval.slice(-20),t=e.map((n,e)=>`T${e+1}`);n.options.labels=t,n.updateData([{values:e,name:"Approval Rating"}],t)}updateSessionChart(){const n=this.charts.get("sessions");if(!n||!this.analyticsData)return;const e=Math.min(10,this.analyticsData.player.totalSessions),t=Array.from({length:e},(n,e)=>`S${e+1}`),i=this.analyticsData.player.averageSessionLength,a=Array.from({length:e},()=>Math.max(1,i+10*(Math.random()-.5))).map((n,e)=>({value:n,name:t[e]}));n.options.labels=t,n.updateData(a,t)}updateDecisionsChart(){const n=this.charts.get("decisions");if(!n||!this.analyticsData)return;const{decisionTypes:e}=this.analyticsData.player,t=Object.entries(e).map(([n,e])=>({value:e,name:n}));n.updateData(t)}updatePoliciesChart(){const n=this.charts.get("policies");if(!n||!this.analyticsData)return;const e=this.analyticsData.player.policyPreferences,t=Object.entries(e).map(([n,e])=>({value:e,name:n}));n.updateData(t)}updateInsights(){this.updateInsightsList(),this.updateFeatureUsage(),this.updateRecommendations(),this.updateAchievements()}updateInsightsList(){const n=document.getElementById("insights-list");if(!n||!this.analyticsData)return;const{insights:e}=this.analyticsData;n.innerHTML=e.map(n=>`\n      <div class="insight-card ${n.priority}">\n        <div class="insight-icon">${this.getInsightIcon(n.type)}</div>\n        <div class="insight-content">\n          <h4>${n.title}</h4>\n          <p>${n.message}</p>\n        </div>\n        <div class="insight-priority">${n.priority}</div>\n      </div>\n    `).join("")}updateFeatureUsage(){const n=document.getElementById("feature-usage-list");if(!n||!this.analyticsData)return;const e=this.analyticsData.player.featureUsage,t=Object.values(e).reduce((n,e)=>n+e,0);n.innerHTML=Object.entries(e).sort(([,n],[,e])=>e-n).map(([n,e])=>{const i=t>0?Math.round(e/t*100):0;return`\n          <div class="usage-item">\n            <div class="usage-bar">\n              <div class="usage-fill" style="width: ${i}%"></div>\n            </div>\n            <div class="usage-info">\n              <span class="usage-feature">${n}</span>\n              <span class="usage-count">${e} (${i}%)</span>\n            </div>\n          </div>\n        `}).join("")}updateRecommendations(){const n=document.getElementById("recommendations-list");if(!n)return;const t=e.getPlayerPerformance(),i=this.generateRecommendations(t);n.innerHTML=i.map(n=>`\n      <div class="recommendation-card">\n        <div class="rec-icon">${n.icon}</div>\n        <div class="rec-content">\n          <h4>${n.title}</h4>\n          <p>${n.description}</p>\n          ${n.action?`<button class="btn btn--small">${n.action}</button>`:""}\n        </div>\n      </div>\n    `).join("")}updateAchievements(){const n=document.getElementById("achievements-grid");if(!n)return;const e=this.calculateAchievements();n.innerHTML=e.map(n=>`\n      <div class="achievement-card ${n.unlocked?"unlocked":"locked"}">\n        <div class="achievement-icon">${n.icon}</div>\n        <div class="achievement-info">\n          <h4>${n.title}</h4>\n          <p>${n.description}</p>\n          ${n.progress?`<div class="achievement-progress">${n.progress}%</div>`:""}\n        </div>\n      </div>\n    `).join("")}generateRecommendations(n){const e=[];return n.averageApproval<50&&e.push({icon:"📈",title:"Improve Public Support",description:"Focus on popular policies and effective crisis management.",action:"View Policy Guide"}),n.sessionLength<20&&e.push({icon:"⏰",title:"Explore More Features",description:"Try different game screens to increase engagement.",action:"Take Tutorial"}),n.crisisManagement<60&&e.push({icon:"🚨",title:"Crisis Management Training",description:"Practice handling crises to improve your skills.",action:"Practice Mode"}),e}calculateAchievements(){const n=e.getPlayerPerformance(),t=e.getRetentionMetrics();return[{title:"First Steps",description:"Complete your first session",icon:"🏃",unlocked:t.totalSessions>=1,progress:Math.min(100,100*t.totalSessions)},{title:"People's Champion",description:"Maintain 70%+ approval rating",icon:"👑",unlocked:n.averageApproval>=70,progress:Math.min(100,n.averageApproval/70*100)},{title:"Crisis Manager",description:"Handle 5 crises successfully",icon:"🛡️",unlocked:n.crisisManagement>=80,progress:Math.min(100,n.crisisManagement/80*100)},{title:"Dedicated Leader",description:"Play for over 5 hours total",icon:"⏱️",unlocked:this.analyticsData?.player.totalPlaytime>=300,progress:Math.min(100,(this.analyticsData?.player.totalPlaytime||0)/300*100)}]}getInsightIcon(n){return{improvement:"📈",engagement:"🎯",retention:"🔄",strength:"💪",warning:"⚠️"}[n]||"💡"}startDataRefresh(){this.refreshInterval=setInterval(()=>{this.refreshData()},3e4)}scheduleRefresh(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refreshData()},2e3)}exportAnalytics(){const n=e.getAnalytics(),t=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`sp_sim_analytics_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),e.trackFeatureUsage("analytics-export")}clearAnalytics(){this.showConfirmationModal("Are you sure you want to clear all analytics data? This cannot be undone.",()=>{e.clearAnalytics(),this.refreshData(),e.trackFeatureUsage("analytics-clear")})}showConfirmationModal(n,e){const t=document.createElement("div");t.className="custom-modal",t.innerHTML=`\n      <div class="custom-modal-content">\n        <p>${n}</p>\n        <div class="custom-modal-actions">\n          <button class="btn btn--danger" id="modal-confirm">Confirm</button>\n          <button class="btn btn--secondary" id="modal-cancel">Cancel</button>\n        </div>\n      </div>\n    `,document.body.appendChild(t),t.querySelector("#modal-confirm").onclick=()=>{document.body.removeChild(t),"function"==typeof e&&e()},t.querySelector("#modal-cancel").onclick=()=>{document.body.removeChild(t)}}updateElement(n,e){const t=document.getElementById(n);t&&(t.textContent=e)}destroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.charts.clear(),super.destroy()}}class f extends d{constructor(){super(),this.gameState=null,this.element=null,this.isExpanded=!1,this.maxVisibleWeeks=52,this.initializeTimeline(),this.setupEventListeners()}initializeTimeline(){this.element=this.createElement("div","timeline-container"),this.element.innerHTML='\n      <div class="timeline-header">\n        <h3 class="timeline-title">\n          <span class="timeline-icon">📅</span>\n          Game Timeline\n        </h3>\n        <button class="timeline-toggle btn btn--secondary" type="button">\n          <span class="toggle-text">Expand</span>\n          <span class="toggle-icon">▼</span>\n        </button>\n      </div>\n      <div class="timeline-content">\n        <div class="timeline-controls">\n          <div class="timeline-info">\n            <span class="current-time">Week 1, Year 1</span>\n            <span class="playtime">Playtime: 0 weeks</span>\n          </div>\n          <div class="timeline-zoom">\n            <button class="zoom-btn" data-zoom="week" type="button">Week View</button>\n            <button class="zoom-btn active" data-zoom="month" type="button">Month View</button>\n            <button class="zoom-btn" data-zoom="year" type="button">Year View</button>\n          </div>\n        </div>\n        <div class="timeline-track">\n          <div class="timeline-progress">\n            <div class="timeline-line"></div>\n            <div class="timeline-markers"></div>\n            <div class="timeline-current-marker"></div>\n          </div>\n          <div class="timeline-events"></div>\n        </div>\n        <div class="timeline-legend">\n          <div class="legend-item">\n            <span class="legend-dot event-economic"></span>\n            <span>Economic Events</span>\n          </div>\n          <div class="legend-item">\n            <span class="legend-dot event-political"></span>\n            <span>Political Events</span>\n          </div>\n          <div class="legend-item">\n            <span class="legend-dot event-save"></span>\n            <span>Save Points</span>\n          </div>\n          <div class="legend-item">\n            <span class="legend-dot event-milestone"></span>\n            <span>Milestones</span>\n          </div>\n        </div>\n      </div>\n    '}setupEventListeners(){this.addEventListener(this.element,"click",n=>{n.target.closest(".timeline-toggle")&&this.toggleTimeline()}),this.addEventListener(this.element,"click",n=>{n.target.classList.contains("zoom-btn")&&this.handleZoomChange(n.target.dataset.zoom)}),this.addEventListener(this.element,"click",n=>{n.target.closest(".timeline-event")&&this.handleEventClick(n.target.closest(".timeline-event"))}),t.on(i.TURN_END,n=>{this.updateTimeline(n.data.gameState)}),t.on(i.GAME_SAVE,n=>{this.addSavePoint(n.data)}),t.on("economic:event",n=>{this.addTimelineEvent(n.data,"economic")})}toggleTimeline(){this.isExpanded=!this.isExpanded;const n=this.element.querySelector(".timeline-content"),e=this.element.querySelector(".toggle-text"),t=this.element.querySelector(".toggle-icon");this.isExpanded?(n.style.maxHeight=`${n.scrollHeight}px`,e.textContent="Collapse",t.textContent="▲",this.element.classList.add("timeline-expanded")):(n.style.maxHeight="0",e.textContent="Expand",t.textContent="▼",this.element.classList.remove("timeline-expanded"))}handleZoomChange(n){this.element.querySelectorAll(".zoom-btn").forEach(n=>n.classList.remove("active")),this.element.querySelector(`[data-zoom="${n}"]`).classList.add("active"),this.currentZoom=n,this.rerenderTimeline()}updateTimeline(n){this.gameState=n;const e=this.element.querySelector(".current-time"),t=this.element.querySelector(".playtime");e.textContent=`Week ${n.time.week}, Year ${n.time.year}`;const i=52*(n.time.year-1)+n.time.week;t.textContent=`Playtime: ${i} weeks`,this.updateTimelineProgress(n),n.events&&n.events.recent&&n.events.recent.forEach(n=>{this.addTimelineEvent(n,n.type||"general")})}updateTimelineProgress(n){const e=this.element.querySelector(".timeline-current-marker"),t=52*(n.time.year-1)+n.time.week;let i=this.maxVisibleWeeks;"week"===this.currentZoom?i=12:"year"===this.currentZoom&&(i=208);const a=Math.min(t/i*100,100);e.style.left=`${a}%`,this.updateTimelineMarkers(i,n)}updateTimelineMarkers(n,e){const t=this.element.querySelector(".timeline-markers");let i;t.innerHTML="",i="week"===this.currentZoom?1:"month"===this.currentZoom?4:13;for(let a=0;a<=n;a+=i){const e=this.createElement("div","timeline-marker");e.style.left=a/n*100+"%";const i=this.createElement("span","marker-label");"year"===this.currentZoom?i.textContent=`Y${Math.floor(a/52)+1}`:i.textContent=`W${a}`,e.appendChild(i),t.appendChild(e)}}addTimelineEvent(n,e="general"){const t=this.element.querySelector(".timeline-events"),i=this.createElement("div",`timeline-event event-${e}`);i.setAttribute("data-event-id",n.id||Date.now()),i.setAttribute("data-tooltip",n.description||n.title||"Game Event");const a=n.week||(this.gameState?52*(this.gameState.time.year-1)+this.gameState.time.week:1);let s;s="week"===this.currentZoom?12:"month"===this.currentZoom?52:208;const o=Math.min(a/s*100,100);i.style.left=`${o}%`;const r=this.createElement("div","event-dot"),c=this.createElement("div","event-tooltip");c.textContent=n.description||n.title||"Game Event",i.appendChild(r),i.appendChild(c),t.appendChild(i),this.cleanupOldEvents()}addSavePoint(n){this.addTimelineEvent({id:n.saveId||`save_${Date.now()}`,title:"Game Saved",description:`Save: ${n.saveName||"Unnamed"}`,week:this.gameState?52*(this.gameState.time.year-1)+this.gameState.time.week:1},"save")}handleEventClick(n){const e=n.querySelector(".event-tooltip");e&&(e.classList.toggle("visible"),this.element.querySelectorAll(".event-tooltip.visible").forEach(n=>{n!==e&&n.classList.remove("visible")}))}cleanupOldEvents(){const n=this.element.querySelectorAll(".timeline-event");n.length>50&&Array.from(n).slice(0,n.length-50).forEach(n=>n.remove())}rerenderTimeline(){this.gameState&&this.updateTimeline(this.gameState)}show(n){return n&&n.appendChild(this.element),this.element}hide(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}getStats(){return{totalEvents:this.element.querySelectorAll(".timeline-event").length,economicEvents:this.element.querySelectorAll(".event-economic").length,politicalEvents:this.element.querySelectorAll(".event-political").length,savePoints:this.element.querySelectorAll(".event-save").length,isExpanded:this.isExpanded,currentZoom:this.currentZoom}}}class x extends d{constructor(){super(),this.currentMode="basic",this.currentSection="overview",this.guideData=this.initializeGuideData(),this.element=null,this.createGuideStructure()}initializeGuideData(){return{basic:{overview:{title:"Welcome to SP_Sim",icon:"🎮",content:'\n            <div class="guide-welcome">\n              <h2>Welcome to SP_Sim! 🏛️</h2>\n              <p>You are now the leader of Democracia, a nation of 50 million people. Your decisions will shape the economic, political, and social future of your country.</p>\n              \n              <div class="key-objectives">\n                <h3>Your Main Objectives:</h3>\n                <ul>\n                  <li><strong>Maintain Public Support:</strong> Keep your approval rating above 30% to stay in power</li>\n                  <li><strong>Manage the Economy:</strong> Balance growth, employment, and fiscal responsibility</li>\n                  <li><strong>Navigate Politics:</strong> Build coalitions and pass important legislation</li>\n                  <li><strong>Handle Crises:</strong> Respond effectively to unexpected events and scandals</li>\n                  <li><strong>Prepare for Elections:</strong> Face voters every 4 years to secure your mandate</li>\n                </ul>\n              </div>\n\n              <div class="getting-started">\n                <h3>Getting Started:</h3>\n                <p>The game runs in real-time with each turn representing one week. \n                <br>You can pause anytime to make decisions carefully. Start by exploring the different screens and familiarizing yourself with the current state of your nation.</p>\n              </div>\n            </div>\n          '},controls:{title:"Game Controls & Interface",icon:"🎛️",content:'\n            <div class="guide-controls">\n              <h2>Game Controls & Interface</h2>\n              \n              <div class="control-section">\n                <h3>Main Navigation</h3>\n                <div class="control-grid">\n                  <div class="control-item">\n                    <strong>Dashboard:</strong> Overview of all key metrics and current status\n                  </div>\n                  <div class="control-item">\n                    <strong>Economy:</strong> Detailed economic data, charts, and policy tools\n                  </div>\n                  <div class="control-item">\n                    <strong>Politics:</strong> Coalition management, approval ratings, and elections\n                  </div>\n                  <div class="control-item">\n                    <strong>Global Relations:</strong> International diplomacy and trade\n                  </div>\n                  <div class="control-item">\n                    <strong>Policies:</strong> Implement new policies and review active legislation\n                  </div>\n                  <div class="control-item">\n                    <strong>Crisis Management:</strong> Handle scandals, emergencies, and unexpected events\n                  </div>\n                </div>\n              </div>\n\n              <div class="control-section">\n                <h3>Game Controls</h3>\n                <div class="control-grid">\n                  <div class="control-item">\n                    <strong>Pause Button:</strong> Stop/resume game time (Spacebar)\n                  </div>\n                  <div class="control-item">\n                    <strong>Next Turn:</strong> Advance one week when paused (N key)\n                  </div>\n                  <div class="control-item">\n                    <strong>Save Game:</strong> Create a save file (Ctrl+S)\n                  </div>\n                  <div class="control-item">\n                    <strong>Load Game:</strong> Load a previous save (Ctrl+L)\n                  </div>\n                </div>\n              </div>\n\n              <div class="control-section">\n                <h3>Keyboard Shortcuts</h3>\n                <div class="shortcut-list">\n                  <div class="shortcut-item"><kbd>Space</kbd> - Pause/Resume game</div>\n                  <div class="shortcut-item"><kbd>N</kbd> - Next turn (when paused)</div>\n                  <div class="shortcut-item"><kbd>Ctrl+S</kbd> - Save game</div>\n                  <div class="shortcut-item"><kbd>Ctrl+L</kbd> - Load game dialog</div>\n                </div>\n              </div>\n            </div>\n          '},economy:{title:"Understanding the Economy",icon:"💰",content:'\n            <div class="guide-economy">\n              <h2>Understanding the Economy</h2>\n              \n              <div class="economic-indicators">\n                <h3>Key Economic Indicators</h3>\n                <div class="indicator-grid">\n                  <div class="indicator-item">\n                    <h4>GDP Growth</h4>\n                    <p>The percentage change in your nation\'s economic output. Higher is generally better, but rapid growth can cause inflation.</p>\n                    <div class="indicator-ranges">\n                      <span class="range-good">Good: 2-4%</span>\n                      <span class="range-caution">Caution: 4-6% or 0-2%</span>\n                      <span class="range-danger">Danger: Negative or >6%</span>\n                    </div>\n                  </div>\n                  \n                  <div class="indicator-item">\n                    <h4>Unemployment Rate</h4>\n                    <p>Percentage of working-age population without jobs. High unemployment hurts approval and economic growth.</p>\n                    <div class="indicator-ranges">\n                      <span class="range-good">Good: 3-6%</span>\n                      <span class="range-caution">Caution: 6-8%</span>\n                      <span class="range-danger">Danger: >8%</span>\n                    </div>\n                  </div>\n                  \n                  <div class="indicator-item">\n                    <h4>Inflation Rate</h4>\n                    <p>How fast prices are rising. Some inflation is normal, but too much erodes purchasing power.</p>\n                    <div class="indicator-ranges">\n                      <span class="range-good">Good: 1-3%</span>\n                      <span class="range-caution">Caution: 3-5% or <1%</span>\n                      <span class="range-danger">Danger: >5% or negative</span>\n                    </div>\n                  </div>\n                  \n                  <div class="indicator-item">\n                    <h4>National Debt</h4>\n                    <p>Government debt as percentage of GDP. Some debt is normal, but too much limits your options.</p>\n                    <div class="indicator-ranges">\n                      <span class="range-good">Good: <60%</span>\n                      <span class="range-caution">Caution: 60-90%</span>\n                      <span class="range-danger">Danger: >90%</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="economic-tips">\n                <h3>Economic Management Tips</h3>\n                <ul>\n                  <li><strong>Watch for cycles:</strong> Economies naturally go through boom and bust cycles</li>\n                  <li><strong>Counter-cyclical policy:</strong> Stimulate during recessions, cool down during overheating</li>\n                  <li><strong>Balance growth and stability:</strong> Fast growth is good, but avoid bubbles</li>\n                  <li><strong>Monitor all indicators:</strong> Don\'t focus on just one metric</li>\n                  <li><strong>Plan for the long term:</strong> Short-term gains can have long-term consequences</li>\n                </ul>\n              </div>\n            </div>\n          '},politics:{title:"Political System Basics",icon:"🗳️",content:'\n            <div class="guide-politics">\n              <h2>Political System Basics</h2>\n              \n              <div class="political-overview">\n                <h3>How Politics Works in SP_Sim</h3>\n                <p>Your political survival depends on maintaining support from various groups and managing complex relationships.</p>\n              </div>\n\n              <div class="approval-system">\n                <h3>Approval Rating</h3>\n                <p>Your approval rating represents public support and is influenced by:</p>\n                <ul>\n                  <li><strong>Economic Performance:</strong> GDP growth, unemployment, inflation</li>\n                  <li><strong>Policy Success:</strong> Whether your policies achieve their goals</li>\n                  <li><strong>Crisis Handling:</strong> How well you manage unexpected events</li>\n                  <li><strong>Scandals:</strong> Personal and government controversies</li>\n                  <li><strong>International Standing:</strong> Success in foreign policy</li>\n                </ul>\n                \n                <div class="approval-ranges">\n                  <div class="approval-range">\n                    <span class="range-excellent">70%+: Excellent - Strong mandate, easy to pass policies</span>\n                  </div>\n                  <div class="approval-range">\n                    <span class="range-good">50-70%: Good - Stable position, normal governance</span>\n                  </div>\n                  <div class="approval-range">\n                    <span class="range-caution">30-50%: Caution - Vulnerable, difficult to govern</span>\n                  </div>\n                  <div class="approval-range">\n                    <span class="range-danger">Below 30%: Danger - Risk of losing power</span>\n                  </div>\n                </div>\n              </div>\n\n              <div class="coalition-system">\n                <h3>Coalition Management</h3>\n                <p>You need parliamentary support to pass legislation:</p>\n                <ul>\n                  <li><strong>Government Party:</strong> Your core support base</li>\n                  <li><strong>Coalition Partners:</strong> Allies who support you conditionally</li>\n                  <li><strong>Opposition:</strong> Parties that oppose your agenda</li>\n                  <li><strong>Independents:</strong> Swing votes that can be persuaded</li>\n                </ul>\n              </div>\n\n              <div class="election-system">\n                <h3>Elections</h3>\n                <p>Face voters every 4 years (208 weeks). Your chances depend on:</p>\n                <ul>\n                  <li>Final year approval rating</li>\n                  <li>Economic performance during your term</li>\n                  <li>Major achievements and failures</li>\n                  <li>Scandal management</li>\n                  <li>Opposition strength</li>\n                </ul>\n              </div>\n            </div>\n          '},save_system:{title:"Saving & Loading Games",icon:"💾",content:'\n            <div class="guide-saves">\n              <h2>Saving & Loading Games</h2>\n              \n              <div class="save-overview">\n                <h3>Save System Overview</h3>\n                <p>SP_Sim automatically saves your progress and allows you to create manual save points to preserve important moments in your political career.</p>\n              </div>\n\n              <div class="save-types">\n                <h3>Types of Saves</h3>\n                <div class="save-type">\n                  <h4>🔄 Auto-Save</h4>\n                  <p>The game automatically saves every 4 weeks. This ensures you don\'t lose progress if something goes wrong. Auto-saves are overwritten each time.</p>\n                </div>\n                \n                <div class="save-type">\n                  <h4>💾 Manual Saves</h4>\n                  <p>Create named save files at any time using the "Save Game" button or Ctrl+S. These are permanent and won\'t be overwritten.</p>\n                </div>\n              </div>\n\n              <div class="save-tips">\n                <h3>Saving Tips</h3>\n                <ul>\n                  <li><strong>Save before major decisions:</strong> Create saves before important policy votes or crisis responses</li>\n                  <li><strong>Name saves meaningfully:</strong> Use names like "Pre-Election 2024" or "Economic Crisis Start"</li>\n                  <li><strong>Regular manual saves:</strong> Don\'t rely only on auto-save</li>\n                  <li><strong>Experiment freely:</strong> You can always reload if a decision doesn\'t work out</li>\n                  <li><strong>Keep multiple saves:</strong> The game stores up to 10 manual saves</li>\n                </ul>\n              </div>\n\n              <div class="save-management">\n                <h3>Managing Save Files</h3>\n                <ul>\n                  <li><strong>Export saves:</strong> Download save files to backup or share</li>\n                  <li><strong>Import saves:</strong> Load save files from other devices</li>\n                  <li><strong>Delete old saves:</strong> Remove saves you no longer need</li>\n                  <li><strong>Storage usage:</strong> Check how much browser storage you\'re using</li>\n                </ul>\n              </div>\n            </div>\n          '}},advanced:{mechanics:{title:"Advanced Game Mechanics",icon:"⚙️",content:'\n            <div class="guide-advanced-mechanics">\n              <h2>Advanced Game Mechanics</h2>\n              \n              <div class="complex-systems">\n                <h3>Complex System Interactions</h3>\n                <p>Understanding how different systems interact is key to mastering SP_Sim:</p>\n                \n                <div class="system-interaction">\n                  <h4>Economic-Political Feedback Loops</h4>\n                  <ul>\n                    <li>Economic performance affects approval ratings with 2-3 week delay</li>\n                    <li>Political instability can hurt economic confidence</li>\n                    <li>Election years often see economic manipulation attempts</li>\n                    <li>Coalition stability affects market confidence</li>\n                  </ul>\n                </div>\n\n                <div class="system-interaction">\n                  <h4>International Relations Impact</h4>\n                  <ul>\n                    <li>Trade relationships affect economic growth</li>\n                    <li>Diplomatic crises can trigger economic sanctions</li>\n                    <li>International standing affects foreign investment</li>\n                    <li>Global economic cycles influence domestic economy</li>\n                  </ul>\n                </div>\n              </div>\n\n              <div class="hidden-mechanics">\n                <h3>Hidden Mechanics</h3>\n                <div class="mechanic-detail">\n                  <h4>Economic Cycles</h4>\n                  <p>The economy follows realistic boom-bust cycles lasting 8-12 years. Understanding where you are in the cycle helps predict future challenges.</p>\n                </div>\n                \n                <div class="mechanic-detail">\n                  <h4>Scandal Accumulation</h4>\n                  <p>Minor scandals accumulate over time. Even if individual scandals are handled well, accumulated scandal points can trigger major crises.</p>\n                </div>\n                \n                <div class="mechanic-detail">\n                  <h4>Coalition Fatigue</h4>\n                  <p>Coalition partners become harder to maintain over time. Fresh coalitions are more stable than ones that have been together for years.</p>\n                </div>\n              </div>\n\n              <div class="optimization-strategies">\n                <h3>Optimization Strategies</h3>\n                <ul>\n                  <li><strong>Timing is everything:</strong> Major reforms work best early in your term</li>\n                  <li><strong>Build political capital:</strong> High approval early allows for unpopular but necessary policies later</li>\n                  <li><strong>Diversify your coalition:</strong> Don\'t rely on a single partner for your majority</li>\n                  <li><strong>Plan for cycles:</strong> Prepare for economic downturns during good times</li>\n                  <li><strong>International leverage:</strong> Use foreign policy success to boost domestic standing</li>\n                </ul>\n              </div>\n            </div>\n          '},strategy:{title:"Advanced Political Strategy",icon:"🎯",content:'\n            <div class="guide-strategy">\n              <h2>Advanced Political Strategy</h2>\n              \n              <div class="strategic-thinking">\n                <h3>Long-Term Strategic Thinking</h3>\n                <p>Successful leaders think beyond immediate challenges and plan for long-term success:</p>\n                \n                <div class="strategy-framework">\n                  <h4>The Four-Year Election Cycle</h4>\n                  <div class="cycle-breakdown">\n                    <div class="cycle-phase">\n                      <h5>Year 1: Honeymoon & Reforms</h5>\n                      <ul>\n                        <li>Highest approval and political capital</li>\n                        <li>Best time for difficult but necessary reforms</li>\n                        <li>Establish your policy agenda</li>\n                        <li>Build international relationships</li>\n                      </ul>\n                    </div>\n                    \n                    <div class="cycle-phase">\n                      <h5>Year 2-3: Implementation & Midterm</h5>\n                      <ul>\n                        <li>Focus on implementing promised policies</li>\n                        <li>Handle inevitable crises and challenges</li>\n                        <li>Adjust policies based on results</li>\n                        <li>Maintain coalition stability</li>\n                      </ul>\n                    </div>\n                    \n                    <div class="cycle-phase">\n                      <h5>Year 4: Pre-Election</h5>\n                      <ul>\n                        <li>Highlight achievements and successes</li>\n                        <li>Avoid unpopular decisions</li>\n                        <li>Focus on vote-winning policies</li>\n                        <li>Prepare for campaign season</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="crisis-management">\n                <h3>Crisis Management Strategies</h3>\n                <div class="crisis-type">\n                  <h4>Economic Crises</h4>\n                  <ul>\n                    <li><strong>Act quickly:</strong> Decisive action is better than delay</li>\n                    <li><strong>Communicate clearly:</strong> Explain your plan to the public</li>\n                    <li><strong>Accept short-term pain:</strong> Sometimes recession is necessary to prevent worse outcomes</li>\n                    <li><strong>Build consensus:</strong> Get opposition support for major reforms</li>\n                  </ul>\n                </div>\n                \n                <div class="crisis-type">\n                  <h4>Political Scandals</h4>\n                  <ul>\n                    <li><strong>Full disclosure:</strong> Cover-ups usually make things worse</li>\n                    <li><strong>Take responsibility:</strong> Accept blame for failures under your watch</li>\n                    <li><strong>Implement reforms:</strong> Show you\'re fixing the underlying problems</li>\n                    <li><strong>Stay focused:</strong> Don\'t let scandals derail your entire agenda</li>\n                  </ul>\n                </div>\n                \n                <div class="crisis-type">\n                  <h4>International Crises</h4>\n                  <ul>\n                    <li><strong>Rally effect:</strong> Foreign crises can boost domestic approval if handled well</li>\n                    <li><strong>Multilateral approach:</strong> Work with allies when possible</li>\n                    <li><strong>Proportional response:</strong> Match your response to the threat level</li>\n                    <li><strong>Domestic priorities:</strong> Don\'t let foreign issues overshadow domestic needs</li>\n                  </ul>\n                </div>\n              </div>\n\n              <div class="advanced-tactics">\n                <h3>Advanced Political Tactics</h3>\n                <ul>\n                  <li><strong>Issue ownership:</strong> Become the trusted voice on key topics</li>\n                  <li><strong>Agenda setting:</strong> Control what issues the public focuses on</li>\n                  <li><strong>Strategic ambiguity:</strong> Sometimes vague positions help build broader coalitions</li>\n                  <li><strong>Policy bundling:</strong> Package popular and unpopular policies together</li>\n                  <li><strong>Opposition management:</strong> Keep opponents divided, find common ground when beneficial</li>\n                </ul>\n              </div>\n            </div>\n          '},economics:{title:"Advanced Economic Management",icon:"📈",content:'\n            <div class="guide-advanced-economics">\n              <h2>Advanced Economic Management</h2>\n              \n              <div class="economic-theory">\n                <h3>Economic Theory in Practice</h3>\n                <p>SP_Sim\'s economic model incorporates real-world economic principles:</p>\n                \n                <div class="theory-section">\n                  <h4>Keynesian vs. Supply-Side Economics</h4>\n                  <div class="theory-comparison">\n                    <div class="theory-approach">\n                      <h5>Keynesian Approach (Demand-Side)</h5>\n                      <ul>\n                        <li>Increase government spending during recessions</li>\n                        <li>Lower interest rates to stimulate borrowing</li>\n                        <li>Accept higher deficits to maintain employment</li>\n                        <li>Focus on aggregate demand management</li>\n                      </ul>\n                    </div>\n                    \n                    <div class="theory-approach">\n                      <h5>Supply-Side Approach</h5>\n                      <ul>\n                        <li>Cut taxes to incentivize production</li>\n                        <li>Reduce regulations to lower business costs</li>\n                        <li>Focus on long-term growth over short-term stability</li>\n                        <li>Emphasize productivity and competitiveness</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="policy-tools">\n                <h3>Advanced Policy Tools</h3>\n                <div class="tool-category">\n                  <h4>Fiscal Policy</h4>\n                  <ul>\n                    <li><strong>Progressive taxation:</strong> Higher rates on wealthy, more redistribution</li>\n                    <li><strong>Flat taxation:</strong> Same rate for all, simpler but less redistributive</li>\n                    <li><strong>Infrastructure spending:</strong> Boosts short-term demand, long-term productivity</li>\n                    <li><strong>Social spending:</strong> Provides safety net but can reduce work incentives</li>\n                  </ul>\n                </div>\n                \n                <div class="tool-category">\n                  <h4>Monetary Policy Coordination</h4>\n                  <ul>\n                    <li><strong>Interest rate policy:</strong> Lower rates stimulate economy but risk inflation</li>\n                    <li><strong>Currency policy:</strong> Weak currency helps exports, strong currency helps imports</li>\n                    <li><strong>Banking regulation:</strong> Stricter rules prevent crises but may limit growth</li>\n                  </ul>\n                </div>\n                \n                <div class="tool-category">\n                  <h4>Structural Reforms</h4>\n                  <ul>\n                    <li><strong>Labor market flexibility:</strong> Easier hiring/firing can boost employment</li>\n                    <li><strong>Education investment:</strong> Long-term productivity gains</li>\n                    <li><strong>Innovation incentives:</strong> R&D tax credits, patent protection</li>\n                    <li><strong>Trade policy:</strong> Free trade vs. protectionism trade-offs</li>\n                  </ul>\n                </div>\n              </div>\n\n              <div class="economic-indicators-advanced">\n                <h3>Reading Economic Indicators Like a Pro</h3>\n                <div class="indicator-analysis">\n                  <h4>Leading Indicators</h4>\n                  <p>These predict future economic performance:</p>\n                  <ul>\n                    <li><strong>Business confidence:</strong> Predicts investment and hiring</li>\n                    <li><strong>Consumer confidence:</strong> Predicts spending patterns</li>\n                    <li><strong>Stock market performance:</strong> Reflects expectations</li>\n                    <li><strong>Currency movements:</strong> Show international confidence</li>\n                  </ul>\n                </div>\n                \n                <div class="indicator-analysis">\n                  <h4>Lagging Indicators</h4>\n                  <p>These confirm trends that have already started:</p>\n                  <ul>\n                    <li><strong>Unemployment rate:</strong> Responds slowly to policy changes</li>\n                    <li><strong>GDP growth:</strong> Measured quarterly, reports past performance</li>\n                    <li><strong>Government debt ratio:</strong> Accumulates over time</li>\n                  </ul>\n                </div>\n              </div>\n\n              <div class="economic-scenarios">\n                <h3>Managing Different Economic Scenarios</h3>\n                <div class="scenario">\n                  <h4>Recession Response</h4>\n                  <ol>\n                    <li>Act quickly - speed matters more than perfection</li>\n                    <li>Combine fiscal stimulus with monetary easing</li>\n                    <li>Focus on employment-intensive projects</li>\n                    <li>Provide targeted help to vulnerable groups</li>\n                    <li>Communicate confidence in eventual recovery</li>\n                  </ol>\n                </div>\n                \n                <div class="scenario">\n                  <h4>Inflation Control</h4>\n                  <ol>\n                    <li>Reduce government spending or raise taxes</li>\n                    <li>Support central bank interest rate increases</li>\n                    <li>Address supply-side bottlenecks</li>\n                    <li>Avoid wage-price spiral through dialogue</li>\n                    <li>Monitor expectations carefully</li>\n                  </ol>\n                </div>\n                \n                <div class="scenario">\n                  <h4>Structural Reform During Growth</h4>\n                  <ol>\n                    <li>Use good times to build fiscal buffers</li>\n                    <li>Invest in productivity-enhancing infrastructure</li>\n                    <li>Reform inefficient sectors</li>\n                    <li>Strengthen institutions and governance</li>\n                    <li>Prepare for the next downturn</li>\n                  </ol>\n                </div>\n              </div>\n            </div>\n          '}}}}createGuideStructure(){this.element=this.createElement("div","player-guide"),this.element.innerHTML='\n      <div class="guide-header">\n        <div class="guide-title">\n          <h2>📚 Player Guide</h2>\n          <p>Your complete guide to mastering SP_Sim</p>\n        </div>\n        <div class="guide-mode-switch">\n          <button class="mode-btn active" data-mode="basic" type="button">Basic Guide</button>\n          <button class="mode-btn" data-mode="advanced" type="button">Advanced Guide</button>\n        </div>\n      </div>\n      \n      <div class="guide-content">\n        <div class="guide-sidebar">\n          <nav class="guide-nav" id="guide-nav-basic">\n            \x3c!-- Basic navigation will be populated --\x3e\n          </nav>\n          <nav class="guide-nav hidden" id="guide-nav-advanced">\n            \x3c!-- Advanced navigation will be populated --\x3e\n          </nav>\n        </div>\n        \n        <div class="guide-main">\n          <div class="guide-section-content" id="guide-section-content">\n            \x3c!-- Content will be populated --\x3e\n          </div>\n        </div>\n      </div>\n      \n      <div class="guide-footer">\n        <div class="guide-progress">\n          <span class="progress-text">Progress through guide</span>\n          <div class="progress-bar">\n            <div class="progress-fill" style="width: 0%"></div>\n          </div>\n        </div>\n        <div class="guide-actions">\n          <button class="guide-btn guide-prev" disabled type="button">← Previous</button>\n          <button class="guide-btn guide-next" type="button">Next →</button>\n          <button class="guide-btn guide-close" type="button">Close Guide</button>\n        </div>\n      </div>\n    ',this.setupGuideNavigation(),this.setupEventListeners(),this.showSection("overview")}setupGuideNavigation(){const n=this.element.querySelector("#guide-nav-basic"),e=Object.keys(this.guideData.basic);n.innerHTML=e.map(n=>`\n      <button class="guide-nav-item ${"overview"===n?"active":""}" \n              data-section="${n}" \n              data-mode="basic" \n              type="button">\n        <span class="nav-icon">${this.guideData.basic[n].icon}</span>\n        <span class="nav-title">${this.guideData.basic[n].title}</span>\n      </button>\n    `).join("");const t=this.element.querySelector("#guide-nav-advanced"),i=Object.keys(this.guideData.advanced);t.innerHTML=i.map(n=>`\n      <button class="guide-nav-item" \n              data-section="${n}" \n              data-mode="advanced" \n              type="button">\n        <span class="nav-icon">${this.guideData.advanced[n].icon}</span>\n        <span class="nav-title">${this.guideData.advanced[n].title}</span>\n      </button>\n    `).join("")}setupEventListeners(){this.addEventListener(this.element,"click",n=>{n.target.classList.contains("mode-btn")&&this.switchMode(n.target.dataset.mode)}),this.addEventListener(this.element,"click",n=>{if(n.target.closest(".guide-nav-item")){const e=n.target.closest(".guide-nav-item");this.showSection(e.dataset.section,e.dataset.mode)}}),this.addEventListener(this.element,"click",n=>{n.target.classList.contains("guide-prev")?this.navigatePrevious():n.target.classList.contains("guide-next")?this.navigateNext():n.target.classList.contains("guide-close")&&this.hide()}),this.addEventListener(document,"keydown",n=>{this.element.classList.contains("guide-visible")&&("ArrowLeft"!==n.key||n.target.closest("input, textarea")?"ArrowRight"!==n.key||n.target.closest("input, textarea")?"Escape"===n.key&&(n.preventDefault(),this.hide()):(n.preventDefault(),this.navigateNext()):(n.preventDefault(),this.navigatePrevious()))})}switchMode(n){this.currentMode=n,this.element.querySelectorAll(".mode-btn").forEach(e=>{e.classList.toggle("active",e.dataset.mode===n)}),this.element.querySelectorAll(".guide-nav").forEach(e=>{e.classList.toggle("hidden",!e.id.includes(n))});const e=Object.keys(this.guideData[n])[0];this.showSection(e,n)}showSection(n,e=this.currentMode){this.currentSection=n,this.currentMode=e,this.element.querySelectorAll(".guide-nav-item").forEach(t=>{t.classList.toggle("active",t.dataset.section===n&&t.dataset.mode===e)});const t=this.element.querySelector("#guide-section-content"),i=this.guideData[e][n];t.innerHTML=i.content,t.scrollTop=0,this.updateProgress(),this.updateNavigationButtons()}navigatePrevious(){const n=Object.keys(this.guideData[this.currentMode]),e=n.indexOf(this.currentSection);if(e>0)this.showSection(n[e-1]);else if("advanced"===this.currentMode){const n=Object.keys(this.guideData.basic);this.switchMode("basic"),this.showSection(n[n.length-1])}}navigateNext(){const n=Object.keys(this.guideData[this.currentMode]),e=n.indexOf(this.currentSection);if(e<n.length-1)this.showSection(n[e+1]);else if("basic"===this.currentMode){const n=Object.keys(this.guideData.advanced);this.switchMode("advanced"),this.showSection(n[0])}}updateProgress(){const n=[...Object.keys(this.guideData.basic),...Object.keys(this.guideData.advanced)],e=Object.keys(this.guideData[this.currentMode]).indexOf(this.currentSection),t=("advanced"===this.currentMode?Object.keys(this.guideData.basic).length:0)+e,i=(t+1)/n.length*100,a=this.element.querySelector(".progress-fill"),s=this.element.querySelector(".progress-text");a.style.width=`${i}%`,s.textContent=`Progress: ${t+1}/${n.length} sections`}updateNavigationButtons(){const n=Object.keys(this.guideData[this.currentMode]),e=n.indexOf(this.currentSection),t=this.element.querySelector(".guide-prev"),i=this.element.querySelector(".guide-next"),a=e>0||"advanced"===this.currentMode;t.disabled=!a;const s=e<n.length-1||"basic"===this.currentMode;i.disabled=!s,"basic"===this.currentMode&&e===n.length-1?i.textContent="Advanced Guide →":i.textContent="Next →"}showModal(){new u({title:"Player Guide",content:this.element.outerHTML,size:"large",showCancel:!1,confirmText:"Close",onConfirm:()=>!0}).show();const n=document.querySelector(".modal .player-guide");n&&(this.element=n,this.setupEventListeners(),this.showSection(this.currentSection,this.currentMode))}show(n){return n&&n.appendChild(this.element),this.element.classList.add("guide-visible"),this.element}hide(){this.element.classList.remove("guide-visible"),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}getStats(){return{currentMode:this.currentMode,currentSection:this.currentSection,totalBasicSections:Object.keys(this.guideData.basic).length,totalAdvancedSections:Object.keys(this.guideData.advanced).length,isVisible:this.element.classList.contains("guide-visible")}}}class w extends d{constructor(){super(),this.isVisible=!1,this.selectedDifficulty="normal",this.gameOptions={tutorial:!0,autoSave:!0,crisisEvents:!0}}show(){return!this.isVisible&&(this.createStartingScreen(),this.isVisible=!0,!0)}hide(){const n=document.getElementById("starting-screen");n&&n.remove(),this.isVisible=!1}checkForExistingGame(){const n=localStorage.getItem("sp_sim_autosave"),e=localStorage.getItem("sp_sim_saves");return!!(n||e&&JSON.parse(e).length>0)}createStartingScreen(){const n=r.getDifficulties(),e=document.createElement("div");e.id="starting-screen",e.className="starting-screen",e.innerHTML=`\n      <div class="starting-screen__overlay">\n        <div class="starting-screen__container">\n          \x3c!-- Header Section --\x3e\n          <div class="starting-screen__header">\n            <div class="game-logo">\n              <h1 class="game-title">🏛️ SP_Sim</h1>\n              <p class="game-subtitle">Political Economy Simulation</p>\n            </div>\n            <div class="game-intro">\n              <p>Welcome to SP_Sim! Take on the role of a political leader and guide your nation through complex economic, political, and global challenges.</p>\n              <p>Your decisions will shape the future of your country and determine your political legacy.</p>\n            </div>\n          </div>\n\n          \x3c!-- Difficulty Selection --\x3e\n          <div class="starting-screen__section">\n            <h2 class="section-title">Choose Your Challenge</h2>\n            <p class="section-description">Select the difficulty level that matches your experience and desired challenge:</p>\n            \n            <div class="difficulty-grid">\n              ${n.map(n=>`\n                <div class="difficulty-card ${"normal"===n.id?"selected":""}" \n                     data-difficulty="${n.id}">\n                  <div class="difficulty-header">\n                    <div class="difficulty-icon">${n.icon}</div>\n                    <h3 class="difficulty-name">${n.name}</h3>\n                  </div>\n                  <p class="difficulty-description">${n.description}</p>\n                  <div class="difficulty-stats">\n                    <div class="stat-row">\n                      <span class="stat-label">Starting Approval:</span>\n                      <span class="stat-value">${n.startingConditions.approval}%</span>\n                    </div>\n                    <div class="stat-row">\n                      <span class="stat-label">GDP Growth:</span>\n                      <span class="stat-value">${n.startingConditions.gdpGrowth}%</span>\n                    </div>\n                    <div class="stat-row">\n                      <span class="stat-label">Unemployment:</span>\n                      <span class="stat-value">${n.startingConditions.unemployment}%</span>\n                    </div>\n                    <div class="stat-row">\n                      <span class="stat-label">Crisis Frequency:</span>\n                      <span class="stat-value">${this.getFrequencyText(n.modifiers.crisisFrequency)}</span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n          </div>\n\n          \x3c!-- Game Options --\x3e\n          <div class="starting-screen__section">\n            <h2 class="section-title">Game Options</h2>\n            <div class="options-grid">\n              <label class="option-item">\n                <input type="checkbox" id="option-tutorial" checked>\n                <div class="option-content">\n                  <div class="option-icon">🎓</div>\n                  <div class="option-text">\n                    <strong>Tutorial & Hints</strong>\n                    <span>Get guidance and tips during your first term</span>\n                  </div>\n                </div>\n              </label>\n              \n              <label class="option-item">\n                <input type="checkbox" id="option-autosave" checked>\n                <div class="option-content">\n                  <div class="option-icon">💾</div>\n                  <div class="option-text">\n                    <strong>Auto-Save</strong>\n                    <span>Automatically save progress every 4 weeks</span>\n                  </div>\n                </div>\n              </label>\n              \n              <label class="option-item">\n                <input type="checkbox" id="option-crisis" checked>\n                <div class="option-content">\n                  <div class="option-icon">⚡</div>\n                  <div class="option-text">\n                    <strong>Crisis Events</strong>\n                    <span>Enable random political and economic crises</span>\n                  </div>\n                </div>\n              </label>\n            </div>\n          </div>\n\n          \x3c!-- Action Buttons --\x3e\n          <div class="starting-screen__actions">\n            <button class="btn btn--secondary" id="btn-load-game">\n              📁 Load Existing Game\n            </button>\n            <button class="btn btn--primary" id="btn-start-game">\n              🚀 Start New Game\n            </button>\n          </div>\n\n          \x3c!-- Quick Start Option --\x3e\n          <div class="quick-start">\n            <button class="btn btn--ghost" id="btn-quick-start">\n              ⚡ Quick Start (Normal Difficulty)\n            </button>\n          </div>\n        </div>\n      </div>\n    `,e.innerHTML+='\n      <style>\n        .starting-screen {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          z-index: 9999;\n          background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);\n          color: white;\n          overflow-y: auto;\n        }\n        \n        .starting-screen__overlay {\n          min-height: 100vh;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: 2rem;\n        }\n        \n        .starting-screen__container {\n          max-width: 1000px;\n          width: 100%;\n          background: rgba(255, 255, 255, 0.1);\n          backdrop-filter: blur(10px);\n          border-radius: 20px;\n          padding: 3rem;\n          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n        }\n        \n        .starting-screen__header {\n          text-align: center;\n          margin-bottom: 3rem;\n        }\n        \n        .game-logo {\n          margin-bottom: 2rem;\n        }\n        \n        .game-title {\n          font-size: 3.5rem;\n          margin: 0 0 0.5rem 0;\n          font-weight: 700;\n          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n        }\n        \n        .game-subtitle {\n          font-size: 1.2rem;\n          opacity: 0.9;\n          margin: 0;\n          font-weight: 300;\n        }\n        \n        .game-intro {\n          font-size: 1.1rem;\n          line-height: 1.6;\n          opacity: 0.95;\n          max-width: 600px;\n          margin: 0 auto;\n        }\n        \n        .starting-screen__section {\n          margin-bottom: 3rem;\n        }\n        \n        .section-title {\n          font-size: 1.8rem;\n          margin: 0 0 0.5rem 0;\n          text-align: center;\n        }\n        \n        .section-description {\n          text-align: center;\n          opacity: 0.9;\n          margin-bottom: 2rem;\n        }\n        \n        .difficulty-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n          gap: 1.5rem;\n          margin-bottom: 2rem;\n        }\n        \n        .difficulty-card {\n          background: rgba(255, 255, 255, 0.1);\n          border: 2px solid transparent;\n          border-radius: 12px;\n          padding: 1.5rem;\n          cursor: pointer;\n          transition: all 0.3s ease;\n          backdrop-filter: blur(5px);\n        }\n        \n        .difficulty-card:hover {\n          background: rgba(255, 255, 255, 0.15);\n          transform: translateY(-2px);\n        }\n        \n        .difficulty-card.selected {\n          border-color: #4ade80;\n          background: rgba(74, 222, 128, 0.2);\n        }\n        \n        .difficulty-header {\n          display: flex;\n          align-items: center;\n          gap: 1rem;\n          margin-bottom: 1rem;\n        }\n        \n        .difficulty-icon {\n          font-size: 2rem;\n        }\n        \n        .difficulty-name {\n          margin: 0;\n          font-size: 1.3rem;\n        }\n        \n        .difficulty-description {\n          margin-bottom: 1.5rem;\n          opacity: 0.9;\n          line-height: 1.5;\n        }\n        \n        .difficulty-stats {\n          display: flex;\n          flex-direction: column;\n          gap: 0.5rem;\n        }\n        \n        .stat-row {\n          display: flex;\n          justify-content: space-between;\n          font-size: 0.9rem;\n        }\n        \n        .stat-label {\n          opacity: 0.8;\n        }\n        \n        .stat-value {\n          font-weight: 600;\n        }\n        \n        .options-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n          gap: 1rem;\n        }\n        \n        .option-item {\n          display: flex;\n          align-items: flex-start;\n          gap: 1rem;\n          background: rgba(255, 255, 255, 0.1);\n          padding: 1rem;\n          border-radius: 8px;\n          cursor: pointer;\n          transition: background 0.3s ease;\n        }\n        \n        .option-item:hover {\n          background: rgba(255, 255, 255, 0.15);\n        }\n        \n        .option-item input[type="checkbox"] {\n          margin: 0;\n          transform: scale(1.2);\n        }\n        \n        .option-content {\n          display: flex;\n          align-items: flex-start;\n          gap: 1rem;\n          flex: 1;\n        }\n        \n        .option-icon {\n          font-size: 1.5rem;\n        }\n        \n        .option-text strong {\n          display: block;\n          margin-bottom: 0.25rem;\n        }\n        \n        .option-text span {\n          opacity: 0.8;\n          font-size: 0.9rem;\n        }\n        \n        .starting-screen__actions {\n          display: flex;\n          justify-content: center;\n          gap: 1.5rem;\n          margin-bottom: 2rem;\n        }\n        \n        .btn {\n          padding: 1rem 2rem;\n          border: none;\n          border-radius: 8px;\n          font-size: 1.1rem;\n          font-weight: 600;\n          cursor: pointer;\n          transition: all 0.3s ease;\n          text-decoration: none;\n          display: inline-flex;\n          align-items: center;\n          gap: 0.5rem;\n        }\n        \n        .btn--primary {\n          background: #4ade80;\n          color: #1e3c72;\n        }\n        \n        .btn--primary:hover {\n          background: #22c55e;\n          transform: translateY(-2px);\n          box-shadow: 0 10px 20px rgba(74, 222, 128, 0.3);\n        }\n        \n        .btn--secondary {\n          background: rgba(255, 255, 255, 0.2);\n          color: white;\n          border: 1px solid rgba(255, 255, 255, 0.3);\n        }\n        \n        .btn--secondary:hover {\n          background: rgba(255, 255, 255, 0.3);\n        }\n        \n        .btn--ghost {\n          background: transparent;\n          color: rgba(255, 255, 255, 0.8);\n          border: 1px solid rgba(255, 255, 255, 0.3);\n          font-size: 0.9rem;\n          padding: 0.75rem 1.5rem;\n        }\n        \n        .btn--ghost:hover {\n          color: white;\n          border-color: rgba(255, 255, 255, 0.5);\n        }\n        \n        .quick-start {\n          text-align: center;\n        }\n        \n        @media (max-width: 768px) {\n          .starting-screen__container {\n            padding: 2rem;\n            margin: 1rem;\n          }\n          \n          .game-title {\n            font-size: 2.5rem;\n          }\n          \n          .difficulty-grid {\n            grid-template-columns: 1fr;\n          }\n          \n          .starting-screen__actions {\n            flex-direction: column;\n            align-items: center;\n          }\n          \n          .btn {\n            width: 100%;\n            max-width: 300px;\n          }\n        }\n      </style>\n    ',document.body.appendChild(e),this.setupEventListeners()}getFrequencyText(n){return n<=.5?"Very Low":n<=.8?"Low":n<=1.2?"Normal":n<=1.5?"High":"Very High"}setupEventListeners(){const n=document.querySelectorAll(".difficulty-card");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),this.selectedDifficulty=e.getAttribute("data-difficulty")})});const e=document.getElementById("btn-start-game");e&&e.addEventListener("click",()=>{this.startNewGame()});const i=document.getElementById("btn-quick-start");i&&i.addEventListener("click",()=>{this.selectedDifficulty="normal",this.startNewGame()});const a=document.getElementById("btn-load-game");a&&a.addEventListener("click",()=>{this.hide(),t.emit("ui:load_game_dialog")});const s=document.getElementById("option-tutorial"),o=document.getElementById("option-autosave"),r=document.getElementById("option-crisis");s&&s.addEventListener("change",n=>{this.gameOptions.tutorial=n.target.checked}),o&&o.addEventListener("change",n=>{this.gameOptions.autoSave=n.target.checked}),r&&r.addEventListener("change",n=>{this.gameOptions.crisisEvents=n.target.checked})}startNewGame(){this.showLoadingProgress(),setTimeout(()=>{r.startNewGame({difficulty:this.selectedDifficulty,options:this.gameOptions}),setTimeout(()=>{this.hide()},500)},2e3)}showLoadingProgress(){const n=document.querySelector(".starting-screen__container");if(!n)return;const e=document.createElement("div");e.className="loading-overlay",e.innerHTML='\n      <div class="loading-content">\n        <div class="loading-spinner"></div>\n        <h3 class="loading-title">Initializing Your Nation...</h3>\n        <div class="loading-progress">\n          <div class="progress-bar">\n            <div class="progress-fill"></div>\n          </div>\n          <div class="loading-steps">\n            <div class="loading-step active">Setting up government structure...</div>\n            <div class="loading-step">Initializing economic systems...</div>\n            <div class="loading-step">Establishing diplomatic relations...</div>\n            <div class="loading-step">Preparing political landscape...</div>\n            <div class="loading-step">Ready to govern!</div>\n          </div>\n        </div>\n      </div>\n      \n      <style>\n        .loading-overlay {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.8);\n          backdrop-filter: blur(5px);\n          border-radius: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          z-index: 10000;\n        }\n        \n        .loading-content {\n          text-align: center;\n          max-width: 400px;\n        }\n        \n        .loading-spinner {\n          width: 60px;\n          height: 60px;\n          border: 4px solid rgba(255, 255, 255, 0.3);\n          border-top: 4px solid #4ade80;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n          margin: 0 auto 2rem auto;\n        }\n        \n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n        \n        .loading-title {\n          margin-bottom: 2rem;\n          color: white;\n        }\n        \n        .progress-bar {\n          width: 100%;\n          height: 8px;\n          background: rgba(255, 255, 255, 0.2);\n          border-radius: 4px;\n          overflow: hidden;\n          margin-bottom: 1.5rem;\n        }\n        \n        .progress-fill {\n          height: 100%;\n          background: #4ade80;\n          width: 0%;\n          animation: fillProgress 2s ease-out forwards;\n        }\n        \n        @keyframes fillProgress {\n          to { width: 100%; }\n        }\n        \n        .loading-steps {\n          text-align: left;\n        }\n        \n        .loading-step {\n          padding: 0.5rem 0;\n          opacity: 0.5;\n          transition: opacity 0.3s ease;\n        }\n        \n        .loading-step.active {\n          opacity: 1;\n          color: #4ade80;\n        }\n      </style>\n    ',n.appendChild(e);const t=e.querySelectorAll(".loading-step");t.forEach((n,e)=>{setTimeout(()=>{t.forEach(n=>n.classList.remove("active")),n.classList.add("active")},400*e)})}}class S extends d{constructor(){super(),this.activeEvents=[],this.oppositionActions=[],this.activeDebates=[],this.coalitionStability=100,this.oppositionStatus=null,this.setupEventListeners()}setupEventListeners(){t.on("political:event_triggered",n=>{this.handleEventTriggered(n.data)}),t.on("political:event_resolved",n=>{this.handleEventResolved(n.data)}),t.on("political:vote_completed",n=>{this.handleVoteCompleted(n.data)}),t.on("political:crisis_triggered",n=>{this.handleCrisisTriggered(n.data)}),t.on("opposition:action",n=>{this.handleOppositionAction(n.data)}),t.on("opposition:policy_response",n=>{this.handleOppositionPolicyResponse(n.data)}),t.on("opposition:debate_initiated",n=>{this.handleDebateInitiated(n.data)}),t.on("opposition:debate_concluded",n=>{this.handleDebateConcluded(n.data)}),t.on("opposition:economic_response",n=>{this.handleOppositionEconomicResponse(n.data)})}update(n,e){this.coalitionStability=e.coalition,this.lastGameState=n,this.updatePoliticalStatusDisplay(n,e),this.updateOppositionActionsList()}handleOppositionAction(n){const{action:e,oppositionStatus:t}=n;this.oppositionStatus=t,this.oppositionActions.unshift(e),this.oppositionActions.length>10&&(this.oppositionActions=this.oppositionActions.slice(0,10)),"criticism"===e.type&&"high"===e.severity?this.showOppositionNotification(e):"policy_proposal"===e.type?this.showPolicyProposalNotification(e):"debate_call"===e.type&&this.showDebateCallNotification(e),this.updateOppositionActionsList()}handleOppositionPolicyResponse(n){const{response:e,oppositionParty:t}=n,i={type:"policy_response",title:`${t.name} responds to policy`,message:e.message,stance:e.stance,severity:e.severity,timestamp:Date.now()};this.showOppositionNotification(i)}handleDebateInitiated(n){const{debate:e,requiredResponse:t}=n;this.activeDebates.push(e),t?this.showDebateModal(e):this.showDebateNotification(e)}handleDebateConcluded(n){const{debate:e,outcome:t}=n;this.activeDebates=this.activeDebates.filter(n=>n.id!==e.id),this.showDebateOutcomeModal(e,t)}handleOppositionEconomicResponse(n){const{change:e,party:t,message:i,urgency:a}=n,s={type:"economic_response",title:`${t.name} on Economic Issues`,message:i,urgency:a,change:e,timestamp:Date.now()};this.showOppositionNotification(s)}handleEventTriggered(n){const{event:e,gameState:t}=n;this.activeEvents.push(e),"high"===e.severity?this.showEventModal(e,t):this.showEventNotification(e)}handleEventResolved(n){const{event:e}=n;this.activeEvents=this.activeEvents.filter(n=>n.id!==e.id),this.updateOppositionActionsList()}handleVoteCompleted(n){const{vote:e,outcome:t}=n;this.showVoteResultModal(e,t)}handleCrisisTriggered(n){const{crisis:e}=n;this.showCrisisModal(e)}showEventModal(n,e){const t=n.options.map(n=>`\n      <div class="event-option" data-option-id="${n.id}">\n        <div class="option-header">\n          <h4>${n.text}</h4>\n        </div>\n        <p class="option-description">${n.description}</p>\n        <div class="option-effects">\n          ${this.formatEffectsPreview(n.effects)}\n        </div>\n      </div>\n    `).join("");new u({title:`Political Event: ${n.title}`,content:`\n        <div class="political-event-modal">\n          <div class="event-header">\n            <div class="event-severity event-severity--${n.severity}">\n              ${this.getSeverityIcon(n.severity)} ${n.severity.toUpperCase()}\n            </div>\n            <div class="event-deadline">\n              Deadline: Week ${n.deadline.week}, Year ${n.deadline.year}\n            </div>\n          </div>\n          \n          <div class="event-description">\n            <p>${n.description}</p>\n          </div>\n\n          <div class="event-context">\n            <h4>Current Political Situation:</h4>\n            <div class="context-stats">\n              <div class="context-stat">\n                <span class="label">Approval Rating:</span>\n                <span class="value">${e.politics.approval.toFixed(1)}%</span>\n              </div>\n              <div class="context-stat">\n                <span class="label">Coalition Stability:</span>\n                <span class="value">${this.coalitionStability.toFixed(1)}%</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="event-options">\n            <h4>Choose Your Response:</h4>\n            ${t}\n          </div>\n        </div>\n\n        <style>\n          .political-event-modal {\n            max-width: 600px;\n            margin: 0 auto;\n          }\n          \n          .event-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--spacing-md);\n            padding: var(--spacing-sm);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n          \n          .event-severity {\n            display: flex;\n            align-items: center;\n            gap: var(--spacing-xs);\n            font-weight: 600;\n            padding: var(--spacing-xs) var(--spacing-sm);\n            border-radius: var(--border-radius);\n          }\n          \n          .event-severity--high {\n            background: rgba(239, 68, 68, 0.2);\n            color: #dc2626;\n          }\n          \n          .event-severity--medium {\n            background: rgba(245, 158, 11, 0.2);\n            color: #d97706;\n          }\n          \n          .event-severity--low {\n            background: rgba(34, 197, 94, 0.2);\n            color: #16a34a;\n          }\n          \n          .event-deadline {\n            font-size: 0.875rem;\n            color: var(--text-light);\n          }\n          \n          .event-description {\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(0, 0, 0, 0.02);\n            border-left: 4px solid var(--secondary-color);\n            border-radius: 0 var(--border-radius) var(--border-radius) 0;\n          }\n          \n          .event-context {\n            margin-bottom: var(--spacing-lg);\n          }\n          \n          .event-context h4 {\n            margin-bottom: var(--spacing-sm);\n            color: var(--primary-color);\n          }\n          \n          .context-stats {\n            display: flex;\n            gap: var(--spacing-lg);\n          }\n          \n          .context-stat {\n            display: flex;\n            flex-direction: column;\n            gap: var(--spacing-xs);\n          }\n          \n          .context-stat .label {\n            font-size: 0.875rem;\n            color: var(--text-light);\n          }\n          \n          .context-stat .value {\n            font-weight: 600;\n            font-size: 1.1rem;\n          }\n          \n          .event-options h4 {\n            margin-bottom: var(--spacing-md);\n            color: var(--primary-color);\n          }\n          \n          .event-option {\n            border: 2px solid var(--border-color);\n            border-radius: var(--border-radius);\n            padding: var(--spacing-md);\n            margin-bottom: var(--spacing-md);\n            cursor: pointer;\n            transition: all var(--transition-base);\n          }\n          \n          .event-option:hover {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.05);\n          }\n          \n          .event-option.selected {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.1);\n          }\n          \n          .option-header h4 {\n            margin: 0 0 var(--spacing-sm) 0;\n            color: var(--text-color);\n          }\n          \n          .option-description {\n            margin-bottom: var(--spacing-sm);\n            color: var(--text-light);\n          }\n          \n          .option-effects {\n            display: flex;\n            flex-wrap: wrap;\n            gap: var(--spacing-sm);\n          }\n          \n          .effect-tag {\n            padding: var(--spacing-xs) var(--spacing-sm);\n            border-radius: var(--border-radius);\n            font-size: 0.8rem;\n            font-weight: 500;\n          }\n          \n          .effect-tag--positive {\n            background: rgba(34, 197, 94, 0.2);\n            color: #16a34a;\n          }\n          \n          .effect-tag--negative {\n            background: rgba(239, 68, 68, 0.2);\n            color: #dc2626;\n          }\n          \n          .effect-tag--neutral {\n            background: rgba(107, 114, 128, 0.2);\n            color: #6b7280;\n          }\n          \n          @media (max-width: 768px) {\n            .event-header {\n              flex-direction: column;\n              gap: var(--spacing-sm);\n              text-align: center;\n            }\n            \n            .context-stats {\n              flex-direction: column;\n              gap: var(--spacing-sm);\n            }\n          }\n        </style>\n      `,confirmText:"Make Decision",cancelText:"Delay Decision",showCancel:!0,onConfirm:()=>{const t=document.querySelector(".event-option.selected");if(!t)return this.showNotification("Please select a response option.","warning"),!1;const i=t.getAttribute("data-option-id");return this.respondToEvent(n.id,i,e),!0}}).show(),setTimeout(()=>{const n=document.querySelectorAll(".event-option");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected")})})},100)}getSeverityIcon(n){switch(n){case"high":return"🚨";case"medium":return"⚠️";case"low":return"ℹ️";default:return"📢"}}formatEffectsPreview(n){const e=[];if(void 0!==n.approval){const t=n.approval>0;e.push(`\n        <span class="effect-tag effect-tag--${t?"positive":"negative"}">\n          Approval ${t?"+":""}${n.approval}%\n        </span>\n      `)}if(void 0!==n.gdp){const t=n.gdp>0;e.push(`\n        <span class="effect-tag effect-tag--${t?"positive":"negative"}">\n          GDP ${t?"+":""}${n.gdp}%\n        </span>\n      `)}if(void 0!==n.coalitionSupport){const t=n.coalitionSupport>0;e.push(`\n        <span class="effect-tag effect-tag--${t?"positive":"negative"}">\n          Coalition ${t?"+":""}${n.coalitionSupport}%\n        </span>\n      `)}if(void 0!==n.debt){const t=n.debt>0;e.push(`\n        <span class="effect-tag effect-tag--${t?"negative":"positive"}">\n          Debt ${n.debt>0?"+":""}${n.debt}%\n        </span>\n      `)}return e.join("")}respondToEvent(n,e,i){t.emit("political:event_response",{eventId:n,optionId:e,gameState:i})}showOppositionNotification(n){const e=document.createElement("div");e.className="opposition-notification";const t={high:"#dc2626",medium:"#d97706",low:"#16a34a"},i=n.severity||n.urgency||"medium",a={criticism:"📢",policy_proposal:"📋",debate_call:"⚡",policy_response:"💬",economic_response:"📊"}[n.type]||"🏛️";e.innerHTML=`\n      <div class="notification-header">\n        <span class="notification-icon">${a}</span>\n        <span class="notification-title">Opposition Action</span>\n        <button class="notification-close" onclick="this.closest('.opposition-notification').remove()">×</button>\n      </div>\n      <div class="notification-content">\n        <h4>${n.title||"Opposition Response"}</h4>\n        <p>${n.message||n.description}</p>\n        ${n.proposedBy?`<small>— ${n.proposedBy.name}</small>`:""}\n      </div>\n    `,e.style.cssText=`\n      position: fixed;\n      top: 80px;\n      right: 20px;\n      width: 320px;\n      background: ${{high:"rgba(239, 68, 68, 0.1)",medium:"rgba(245, 158, 11, 0.1)",low:"rgba(34, 197, 94, 0.1)"}[i]};\n      border: 1px solid ${t[i]};\n      border-radius: var(--border-radius);\n      box-shadow: var(--shadow-lg);\n      z-index: 1000;\n      animation: slideInRight 0.3s ease-out;\n      padding: var(--spacing-md);\n    `;const s=document.createElement("style");s.textContent=`\n      .opposition-notification .notification-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: var(--spacing-sm);\n      }\n      .opposition-notification .notification-title {\n        font-weight: 600;\n        color: ${t[i]};\n      }\n      .opposition-notification .notification-close {\n        background: none;\n        border: none;\n        font-size: 1.2rem;\n        cursor: pointer;\n        color: ${t[i]};\n      }\n      .opposition-notification h4 {\n        margin: 0 0 var(--spacing-xs) 0;\n        color: ${t[i]};\n      }\n      .opposition-notification p {\n        margin: 0 0 var(--spacing-xs) 0;\n        font-size: 0.9rem;\n      }\n      .opposition-notification small {\n        font-style: italic;\n        opacity: 0.8;\n      }\n    `,document.head.appendChild(s),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.animation="slideOutRight 0.3s ease-in forwards",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))},6e3)}showPolicyProposalNotification(n){const e=document.createElement("div");e.className="policy-proposal-notification",e.innerHTML=`\n      <div class="notification-header">\n        <span class="notification-icon">📋</span>\n        <span class="notification-title">Opposition Policy Proposal</span>\n      </div>\n      <div class="notification-content">\n        <h4>${n.title}</h4>\n        <p>${n.description}</p>\n        <div class="proposal-actions">\n          <button class="btn btn--sm btn--primary view-proposal-btn" data-action='${JSON.stringify(n)}'>\n            View Proposal\n          </button>\n        </div>\n      </div>\n    `,e.style.cssText="\n      position: fixed;\n      top: 80px;\n      right: 20px;\n      width: 340px;\n      background: rgba(49, 130, 206, 0.1);\n      border: 1px solid #3182ce;\n      border-radius: var(--border-radius);\n      box-shadow: var(--shadow-lg);\n      z-index: 1000;\n      animation: slideInRight 0.3s ease-out;\n      padding: var(--spacing-md);\n    ",document.body.appendChild(e),e.querySelector(".view-proposal-btn").addEventListener("click",()=>{this.showPolicyProposalModal(n),e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}showDebateCallNotification(n){this.showOppositionNotification({...n,message:`${n.proposedBy.name} is calling for a parliamentary debate on: ${n.topics.join(", ")}`})}showDebateNotification(n){const e=document.createElement("div");e.className="debate-notification",e.innerHTML=`\n      <div class="notification-header">\n        <span class="notification-icon">⚡</span>\n        <span class="notification-title">Parliamentary Debate</span>\n      </div>\n      <div class="notification-content">\n        <h4>${n.topic}</h4>\n        <p>The ${n.initiator.name} has initiated a debate</p>\n        <div class="debate-actions">\n          <button class="btn btn--sm btn--primary join-debate-btn" data-debate-id="${n.id}">\n            Join Debate\n          </button>\n        </div>\n      </div>\n    `,e.style.cssText="\n      position: fixed;\n      top: 80px;\n      right: 20px;\n      width: 320px;\n      background: rgba(245, 158, 11, 0.1);\n      border: 1px solid #d97706;\n      border-radius: var(--border-radius);\n      box-shadow: var(--shadow-lg);\n      z-index: 1000;\n      animation: slideInRight 0.3s ease-out;\n      padding: var(--spacing-md);\n    ",document.body.appendChild(e),e.querySelector(".join-debate-btn").addEventListener("click",()=>{this.showDebateModal(n),e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},8e3)}showEventNotification(n){const e=document.createElement("div");e.className="political-event-notification",e.innerHTML=`\n      <div class="notification-header">\n        <span class="notification-icon">${this.getSeverityIcon(n.severity)}</span>\n        <span class="notification-title">Political Event</span>\n      </div>\n      <div class="notification-content">\n        <h4>${n.title}</h4>\n        <p>${n.description}</p>\n        <button class="btn btn--sm btn--primary" onclick="this.closest('.political-event-notification').remove()">\n          View Details\n        </button>\n      </div>\n    `,e.style.cssText="\n      position: fixed;\n      top: 80px;\n      right: 20px;\n      width: 320px;\n      background: white;\n      border: 1px solid var(--border-color);\n      border-radius: var(--border-radius);\n      box-shadow: var(--shadow-lg);\n      z-index: 1000;\n      animation: slideInRight 0.3s ease-out;\n    ",document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.animation="slideOutRight 0.3s ease-in forwards",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))},8e3)}showDebateModal(n){const e=n.arguments.map(n=>`\n      <div class="debate-argument">\n        <div class="argument-header">\n          <strong>${n.party}</strong>\n          <span class="argument-strength">${(100*n.strength).toFixed(0)}% strength</span>\n        </div>\n        <p>${n.argument}</p>\n      </div>\n    `).join("");new u({title:`Parliamentary Debate: ${n.topic}`,content:`\n        <div class="debate-modal">\n          <div class="debate-header">\n            <div class="debate-info">\n              <div class="debate-urgency debate-urgency--${n.urgency}">\n                ${n.urgency.toUpperCase()} PRIORITY\n              </div>\n              <div class="debate-interest">\n                Public Interest: ${(100*n.publicInterest).toFixed(0)}%\n              </div>\n            </div>\n          </div>\n\n          <div class="debate-description">\n            <p>The ${n.initiator.name} has called for a parliamentary debate on this important issue.</p>\n          </div>\n\n          <div class="opposition-arguments">\n            <h4>Opposition Arguments:</h4>\n            ${e}\n          </div>\n\n          <div class="debate-response-options">\n            <h4>Choose Your Response:</h4>\n            <div class="response-options">\n              <div class="response-option" data-response="strong_defense">\n                <h5>🛡️ Strong Defense</h5>\n                <p>Vigorously defend current policies with detailed counterarguments</p>\n                <small>High impact, moderate risk</small>\n              </div>\n              <div class="response-option" data-response="compromise">\n                <h5>🤝 Seek Compromise</h5>\n                <p>Acknowledge concerns and propose middle-ground solutions</p>\n                <small>Moderate impact, low risk</small>\n              </div>\n              <div class="response-option" data-response="deflect">\n                <h5>🔄 Deflect & Redirect</h5>\n                <p>Shift focus to opposition's past failures or other issues</p>\n                <small>Variable impact, moderate risk</small>\n              </div>\n              <div class="response-option" data-response="weak_response">\n                <h5>😐 Minimal Response</h5>\n                <p>Provide only basic, non-committal answers</p>\n                <small>Low impact, high risk</small>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <style>\n          .debate-modal {\n            max-width: 600px;\n            margin: 0 auto;\n          }\n          \n          .debate-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n          \n          .debate-urgency {\n            padding: var(--spacing-xs) var(--spacing-sm);\n            border-radius: var(--border-radius);\n            font-weight: 600;\n            font-size: 0.8rem;\n          }\n          \n          .debate-urgency--high {\n            background: rgba(239, 68, 68, 0.2);\n            color: #dc2626;\n          }\n          \n          .debate-urgency--medium {\n            background: rgba(245, 158, 11, 0.2);\n            color: #d97706;\n          }\n          \n          .debate-urgency--low {\n            background: rgba(34, 197, 94, 0.2);\n            color: #16a34a;\n          }\n          \n          .debate-interest {\n            font-size: 0.9rem;\n            color: var(--text-light);\n          }\n          \n          .opposition-arguments {\n            margin-bottom: var(--spacing-lg);\n          }\n          \n          .debate-argument {\n            border: 1px solid var(--border-color);\n            border-radius: var(--border-radius);\n            padding: var(--spacing-md);\n            margin-bottom: var(--spacing-sm);\n            background: rgba(0, 0, 0, 0.02);\n          }\n          \n          .argument-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--spacing-sm);\n          }\n          \n          .argument-strength {\n            font-size: 0.8rem;\n            color: var(--text-light);\n            background: rgba(0, 0, 0, 0.1);\n            padding: 2px 6px;\n            border-radius: var(--border-radius);\n          }\n          \n          .debate-response-options h4 {\n            margin-bottom: var(--spacing-md);\n            color: var(--primary-color);\n          }\n          \n          .response-options {\n            display: grid;\n            gap: var(--spacing-sm);\n          }\n          \n          .response-option {\n            border: 2px solid var(--border-color);\n            border-radius: var(--border-radius);\n            padding: var(--spacing-md);\n            cursor: pointer;\n            transition: all var(--transition-base);\n          }\n          \n          .response-option:hover {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.05);\n          }\n          \n          .response-option.selected {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.1);\n          }\n          \n          .response-option h5 {\n            margin: 0 0 var(--spacing-xs) 0;\n            color: var(--text-color);\n          }\n          \n          .response-option p {\n            margin: 0 0 var(--spacing-xs) 0;\n            color: var(--text-light);\n          }\n          \n          .response-option small {\n            font-style: italic;\n            opacity: 0.7;\n          }\n        </style>\n      `,confirmText:"Respond to Debate",cancelText:"Skip Debate",showCancel:!0,onConfirm:()=>{const e=document.querySelector(".response-option.selected");if(!e)return this.showNotification("Please select a response option.","warning"),!1;const t=e.getAttribute("data-response");return this.respondToDebate(n.id,{type:t}),!0}}).show(),setTimeout(()=>{const n=document.querySelectorAll(".response-option");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected")})})},100)}showPolicyProposalModal(n){const e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact"}).format(n.cost);new u({title:`Opposition Policy Proposal: ${n.title}`,content:`\n        <div class="policy-proposal-modal">\n          <div class="proposal-header">\n            <div class="proposal-area">${n.area.toUpperCase()}</div>\n            <div class="proposal-cost">Cost: ${e}</div>\n          </div>\n\n          <div class="proposal-description">\n            <p>${n.description}</p>\n          </div>\n\n          <div class="proposal-impact">\n            <h4>Projected Impact:</h4>\n            <div class="impact-grid">\n              ${Object.entries(n.impact).map(([n,e])=>`\n                <div class="impact-item">\n                  <span class="impact-label">${n}:</span>\n                  <span class="impact-value ${e>0?"positive":"negative"}">\n                    ${e>0?"+":""}${e}${n.includes("percent")||n.includes("%")?"%":""}\n                  </span>\n                </div>\n              `).join("")}\n            </div>\n          </div>\n\n          <div class="proposal-source">\n            <p><strong>Proposed by:</strong> ${n.proposedBy.name}</p>\n          </div>\n        </div>\n\n        <style>\n          .policy-proposal-modal {\n            max-width: 500px;\n            margin: 0 auto;\n          }\n          \n          .proposal-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(49, 130, 206, 0.1);\n            border-radius: var(--border-radius);\n          }\n          \n          .proposal-area {\n            font-weight: 600;\n            color: var(--secondary-color);\n          }\n          \n          .proposal-cost {\n            font-weight: 600;\n            color: var(--text-color);\n          }\n          \n          .proposal-description {\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(0, 0, 0, 0.02);\n            border-radius: var(--border-radius);\n          }\n          \n          .proposal-impact h4 {\n            margin-bottom: var(--spacing-sm);\n            color: var(--primary-color);\n          }\n          \n          .impact-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: var(--spacing-sm);\n            margin-bottom: var(--spacing-lg);\n          }\n          \n          .impact-item {\n            display: flex;\n            justify-content: space-between;\n            padding: var(--spacing-sm);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n          \n          .impact-value.positive {\n            color: #16a34a;\n          }\n          \n          .impact-value.negative {\n            color: #dc2626;\n          }\n          \n          .proposal-source {\n            font-style: italic;\n            color: var(--text-light);\n          }\n        </style>\n      `,confirmText:"Consider Proposal",cancelText:"Dismiss",showCancel:!0,onConfirm:()=>(this.showNotification("Opposition proposal noted for future consideration.","info"),!0)}).show()}showDebateOutcomeModal(n,e){new u({title:"Debate Concluded",content:`\n        <div class="debate-outcome-modal">\n          <div class="outcome-header">\n            <h3 style="color: ${{player_victory:"#16a34a",opposition_victory:"#dc2626",draw:"#d97706"}[e.outcome]};">\n              ${{player_victory:"You successfully defended your position!",opposition_victory:"The opposition made compelling arguments.",draw:"The debate ended without a clear winner."}[e.outcome]}\n            </h3>\n            <div class="outcome-score">\n              Performance Score: ${(100*e.score).toFixed(0)}%\n            </div>\n          </div>\n\n          <div class="outcome-impact">\n            <h4>Political Impact:</h4>\n            <div class="impact-list">\n              ${e.impact.approval?`\n                <div class="impact-item">\n                  Approval Rating: ${e.impact.approval>0?"+":""}${e.impact.approval.toFixed(1)}%\n                </div>\n              `:""}\n              ${e.impact.support?`\n                <div class="impact-item">\n                  Opposition Support: ${e.impact.support>0?"+":""}${e.impact.support.toFixed(1)}%\n                </div>\n              `:""}\n            </div>\n          </div>\n        </div>\n\n        <style>\n          .debate-outcome-modal {\n            text-align: center;\n            max-width: 400px;\n            margin: 0 auto;\n          }\n          \n          .outcome-header h3 {\n            margin-bottom: var(--spacing-sm);\n          }\n          \n          .outcome-score {\n            font-size: 1.1rem;\n            font-weight: 600;\n            margin-bottom: var(--spacing-lg);\n            color: var(--text-light);\n          }\n          \n          .outcome-impact h4 {\n            margin-bottom: var(--spacing-md);\n            color: var(--primary-color);\n          }\n          \n          .impact-list {\n            text-align: left;\n          }\n          \n          .impact-item {\n            padding: var(--spacing-sm);\n            margin-bottom: var(--spacing-xs);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n        </style>\n      `,confirmText:"Continue",showCancel:!1}).show()}showVoteResultModal(n,e){const t=e.passed?"PASSED":"FAILED",i=e.passed?"#16a34a":"#dc2626";new u({title:"Vote Result",content:`\n        <div class="vote-result-modal">\n          <div class="vote-header">\n            <h3>${n.title}</h3>\n            <div class="vote-result" style="color: ${i};">\n              ${t}\n            </div>\n          </div>\n          \n          <div class="vote-details">\n            <div class="detail-item">\n              <span class="label">Margin:</span>\n              <span class="value">${e.margin} votes</span>\n            </div>\n            <div class="detail-item">\n              <span class="label">Coalition Unity:</span>\n              <span class="value">${e.coalitionUnity.toFixed(1)}%</span>\n            </div>\n          </div>\n\n          <div class="vote-impact">\n            <p>${e.passed?"The vote passed successfully, strengthening your political position.":"The vote failed, potentially weakening your government."}</p>\n          </div>\n        </div>\n\n        <style>\n          .vote-result-modal {\n            text-align: center;\n            max-width: 400px;\n            margin: 0 auto;\n          }\n          \n          .vote-header h3 {\n            margin-bottom: var(--spacing-sm);\n          }\n          \n          .vote-result {\n            font-size: 1.5rem;\n            font-weight: bold;\n            margin-bottom: var(--spacing-lg);\n          }\n          \n          .vote-details {\n            display: flex;\n            justify-content: space-around;\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n          \n          .detail-item {\n            display: flex;\n            flex-direction: column;\n            gap: var(--spacing-xs);\n          }\n          \n          .detail-item .label {\n            font-size: 0.875rem;\n            color: var(--text-light);\n          }\n          \n          .detail-item .value {\n            font-weight: 600;\n          }\n          \n          .vote-impact {\n            font-style: italic;\n            color: var(--text-light);\n          }\n        </style>\n      `,confirmText:"Continue",showCancel:!1}).show()}showCrisisModal(n){new u({title:`🚨 Political Crisis: ${n.title}`,content:`\n        <div class="crisis-modal">\n          <div class="crisis-alert">\n            <p><strong>Crisis Alert!</strong> Your government is facing a significant political crisis.</p>\n          </div>\n          \n          <div class="crisis-description">\n            <p>${n.description}</p>\n          </div>\n\n          <div class="crisis-impact">\n            <h4>Potential Impact:</h4>\n            <ul>\n              <li>Coalition stability may be affected</li>\n              <li>Public approval could decline</li>\n              <li>Opposition may gain momentum</li>\n              <li>International reputation at risk</li>\n            </ul>\n          </div>\n        </div>\n\n        <style>\n          .crisis-modal {\n            max-width: 500px;\n            margin: 0 auto;\n          }\n          \n          .crisis-alert {\n            background: rgba(239, 68, 68, 0.1);\n            border: 1px solid rgba(239, 68, 68, 0.3);\n            border-radius: var(--border-radius);\n            padding: var(--spacing-md);\n            margin-bottom: var(--spacing-lg);\n            color: #dc2626;\n          }\n          \n          .crisis-description {\n            margin-bottom: var(--spacing-lg);\n            padding: var(--spacing-md);\n            background: rgba(0, 0, 0, 0.05);\n            border-radius: var(--border-radius);\n          }\n          \n          .crisis-impact h4 {\n            color: var(--primary-color);\n            margin-bottom: var(--spacing-sm);\n          }\n          \n          .crisis-impact ul {\n            list-style: none;\n            padding: 0;\n          }\n          \n          .crisis-impact li {\n            padding: var(--spacing-xs) 0;\n            position: relative;\n            padding-left: var(--spacing-md);\n          }\n          \n          .crisis-impact li:before {\n            content: "⚠️";\n            position: absolute;\n            left: 0;\n          }\n        </style>\n      `,confirmText:"Acknowledge",showCancel:!1}).show()}updatePoliticalStatusDisplay(n,e){const t=document.getElementById("coalition-stability");t&&void 0!==e.coalition&&(t.textContent=`${e.coalition.toFixed(1)}%`,t.className=`status-value ${this.getStabilityClass(e.coalition)}`);const i=document.getElementById("political-pressure");i&&void 0!==e.politicalPressure&&(i.textContent=`${e.politicalPressure.toFixed(1)}%`,i.className=`pressure-value ${this.getPressureClass(e.politicalPressure)}`)}getStabilityClass(n){return n>=80?"status-high":n>=60?"status-medium":n>=40?"status-low":"status-critical"}getPressureClass(n){return n<=20?"pressure-low":n<=40?"pressure-medium":n<=60?"pressure-high":"pressure-critical"}respondToDebate(n,e){t.emit("opposition:debate_response",{debateId:n,response:e})}updateOppositionActionsList(){const n=document.getElementById("active-political-events");if(!n)return;const e=[...this.activeEvents,...this.oppositionActions.slice(0,5)];0!==e.length?(n.innerHTML=e.map(n=>{if(n.type&&["criticism","policy_proposal","debate_call"].includes(n.type)){const e={criticism:"📢",policy_proposal:"📋",debate_call:"⚡"};return`\n          <li class="opposition-action-item" data-action='${JSON.stringify(n)}'>\n            <div class="action-summary">\n              <span class="action-icon">${e[n.type]||"🏛️"}</span>\n              <span class="action-title">${n.title||n.message}</span>\n              <span class="action-source">${n.proposedBy?n.proposedBy.name:"Opposition"}</span>\n            </div>\n          </li>\n        `}return`\n          <li class="political-event-item" data-event-id="${n.id}">\n            <div class="event-summary">\n              <span class="event-icon">${this.getSeverityIcon(n.severity)}</span>\n              <span class="event-title">${n.title}</span>\n              <span class="event-deadline">Due: Week ${n.deadline.week}</span>\n            </div>\n          </li>\n        `}).join(""),n.querySelectorAll(".opposition-action-item").forEach(n=>{n.addEventListener("click",()=>{const e=JSON.parse(n.getAttribute("data-action"));this.showOppositionActionDetail(e)})}),n.querySelectorAll(".political-event-item").forEach(n=>{n.addEventListener("click",()=>{const e=n.getAttribute("data-event-id"),t=this.activeEvents.find(n=>n.id===e);t&&this.showEventModal(t,this.lastGameState)})})):n.innerHTML="<li>No active political events</li>"}showOppositionActionDetail(n){if("policy_proposal"===n.type)this.showPolicyProposalModal(n);else if("debate_call"===n.type){const e=this.activeDebates.find(e=>e.initiator.id===n.proposedBy.id);e&&this.showDebateModal(e)}else new u({title:"Opposition Action",content:`\n          <div class="opposition-action-detail">\n            <h4>${n.title||"Opposition Statement"}</h4>\n            <p>${n.message||n.description}</p>\n            ${n.proposedBy?`<p><strong>Source:</strong> ${n.proposedBy.name}</p>`:""}\n            ${n.timestamp?`<p><small>Time: ${new Date(n.timestamp).toLocaleString()}</small></p>`:""}\n          </div>\n        `,confirmText:"Close",showCancel:!1}).show()}showNotification(n,e="info"){t.emit("ui:notification",{message:n,type:e})}}class k extends d{constructor(){super(),this.settings=this.loadSettings(),this.initializeScreen()}loadSettings(){return{gameSpeed:parseInt(localStorage.getItem("sp_sim_game_speed")||"1000",10),theme:localStorage.getItem("sp_sim_theme")||"system",autoSave:"false"!==localStorage.getItem("sp_sim_auto_save"),notifications:"false"!==localStorage.getItem("sp_sim_notifications"),autoPause:"true"===localStorage.getItem("sp_sim_auto_pause"),soundEffects:"false"!==localStorage.getItem("sp_sim_sound_effects"),animationSpeed:localStorage.getItem("sp_sim_animation_speed")||"normal",language:localStorage.getItem("sp_sim_language")||"en",autoAdvanceTurn:"true"===localStorage.getItem("sp_sim_auto_advance_turn"),difficultyAdjustments:"false"!==localStorage.getItem("sp_sim_difficulty_adjustments")}}saveSettings(){Object.entries(this.settings).forEach(([n,e])=>{const t=`sp_sim_${n.replace(/([A-Z])/g,"_$1").toLowerCase()}`;localStorage.setItem(t,e.toString())})}initializeScreen(){let n=document.querySelector("#screen-settings");if(!n){n=this.createElement("div","screen"),n.id="screen-settings";const e=document.querySelector(".main-content");e&&e.appendChild(n)}this.element=n,this.render(),this.setupEventListeners(),this.applyTheme()}render(){this.element.innerHTML=`\n      <div class="settings-screen">\n        \x3c!-- Settings Header --\x3e\n        <div class="settings-header">\n          <div class="header-content">\n            <h1>⚙️ Game Settings</h1>\n            <p>Customize your SP_Sim experience</p>\n          </div>\n          <div class="settings-actions">\n            <button class="btn btn--secondary" id="reset-settings">🔄 Reset to Defaults</button>\n            <button class="btn btn--secondary" id="export-settings">📤 Export Settings</button>\n          </div>\n        </div>\n\n        \x3c!-- Settings Tabs --\x3e\n        <div class="settings-tabs">\n          <button class="tab-btn active" data-tab="display">\n            <span class="tab-icon">🎨</span>\n            <span class="tab-text">Display</span>\n          </button>\n          <button class="tab-btn" data-tab="gameplay">\n            <span class="tab-icon">🎮</span>\n            <span class="tab-text">Gameplay</span>\n          </button>\n          <button class="tab-btn" data-tab="about">\n            <span class="tab-icon">ℹ️</span>\n            <span class="tab-text">About</span>\n          </button>\n        </div>\n\n        \x3c!-- Settings Content --\x3e\n        <div class="settings-content">\n          \x3c!-- Display Tab --\x3e\n          <div class="tab-content active" id="tab-display">\n            ${this.renderDisplayTab()}\n          </div>\n\n          \x3c!-- Gameplay Tab --\x3e\n          <div class="tab-content" id="tab-gameplay">\n            ${this.renderGameplayTab()}\n          </div>\n\n          \x3c!-- About Tab --\x3e\n          <div class="tab-content" id="tab-about">\n            ${this.renderAboutTab()}\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Settings Screen Styles --\x3e\n      <style>\n        .settings-screen {\n          max-width: 1000px;\n          margin: 0 auto;\n          padding: var(--spacing-lg);\n        }\n\n        .settings-header {\n          background: linear-gradient(135deg, var(--surface-color) 0%, var(--background-alt) 100%);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xl);\n          margin-bottom: var(--spacing-lg);\n          box-shadow: var(--shadow-md);\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          border: 1px solid var(--border-color);\n        }\n\n        .header-content h1 {\n          margin: 0 0 var(--spacing-sm) 0;\n          color: var(--primary-color);\n          font-size: 2rem;\n          font-weight: 700;\n        }\n\n        .header-content p {\n          margin: 0;\n          color: var(--text-light);\n          font-size: 1rem;\n        }\n\n        .settings-actions {\n          display: flex;\n          gap: var(--spacing-sm);\n          flex-wrap: wrap;\n        }\n\n        .settings-tabs {\n          display: flex;\n          gap: 0;\n          margin-bottom: var(--spacing-lg);\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xs);\n          box-shadow: var(--shadow-sm);\n          border: 1px solid var(--border-color);\n          overflow-x: auto;\n        }\n\n        .tab-btn {\n          flex: 1;\n          min-width: 120px;\n          padding: var(--spacing-md) var(--spacing-lg);\n          border: none;\n          background: none;\n          color: var(--text-light);\n          font-weight: 500;\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: var(--spacing-sm);\n          white-space: nowrap;\n        }\n\n        .tab-btn:hover {\n          background: var(--background-alt);\n          color: var(--text-color);\n        }\n\n        .tab-btn.active {\n          background: var(--secondary-color);\n          color: white;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .tab-icon {\n          font-size: 1.1rem;\n        }\n\n        .settings-content {\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          box-shadow: var(--shadow-md);\n          border: 1px solid var(--border-color);\n          min-height: 500px;\n        }\n\n        .tab-content {\n          display: none;\n          padding: var(--spacing-xl);\n          animation: fadeInUp 0.3s ease-out;\n        }\n\n        .tab-content.active {\n          display: block;\n        }\n\n        .settings-section {\n          margin-bottom: var(--spacing-xl);\n        }\n\n        .settings-section:last-child {\n          margin-bottom: 0;\n        }\n\n        .section-title {\n          font-size: 1.3rem;\n          font-weight: 600;\n          color: var(--primary-color);\n          margin-bottom: var(--spacing-lg);\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-sm);\n          padding-bottom: var(--spacing-sm);\n          border-bottom: 2px solid var(--border-light);\n        }\n\n        .settings-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          gap: var(--spacing-lg);\n        }\n\n        .setting-item {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n          transition: all var(--transition-base);\n        }\n\n        .setting-item:hover {\n          transform: translateY(-2px);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .setting-header {\n          margin-bottom: var(--spacing-md);\n        }\n\n        .setting-title {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--text-color);\n          margin-bottom: var(--spacing-xs);\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-sm);\n        }\n\n        .setting-description {\n          font-size: 0.875rem;\n          color: var(--text-light);\n          line-height: 1.4;\n        }\n\n        .setting-control {\n          margin-top: var(--spacing-md);\n        }\n\n        .theme-selector {\n          display: grid;\n          grid-template-columns: repeat(3, 1fr);\n          gap: var(--spacing-sm);\n        }\n\n        .theme-option {\n          padding: var(--spacing-md);\n          border: 2px solid var(--border-color);\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          text-align: center;\n          background: var(--surface-color);\n        }\n\n        .theme-option:hover {\n          border-color: var(--secondary-color);\n          transform: translateY(-2px);\n        }\n\n        .theme-option.active {\n          border-color: var(--secondary-color);\n          background: var(--secondary-color);\n          color: white;\n        }\n\n        .theme-preview {\n          width: 100%;\n          height: 40px;\n          border-radius: var(--border-radius-sm);\n          margin-bottom: var(--spacing-sm);\n          display: flex;\n        }\n\n        .theme-light .theme-preview {\n          background: linear-gradient(90deg, #f7fafc 0%, #edf2f7 50%, #e2e8f0 100%);\n        }\n\n        .theme-dark .theme-preview {\n          background: linear-gradient(90deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);\n        }\n\n        .theme-system .theme-preview {\n          background: linear-gradient(90deg, #f7fafc 0%, #2d3748 50%, #f7fafc 100%);\n        }\n\n        .theme-name {\n          font-weight: 500;\n          font-size: 0.875rem;\n        }\n\n        .toggle-switch {\n          position: relative;\n          display: inline-block;\n          width: 50px;\n          height: 24px;\n        }\n\n        .toggle-switch input {\n          opacity: 0;\n          width: 0;\n          height: 0;\n        }\n\n        .toggle-slider {\n          position: absolute;\n          cursor: pointer;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background-color: var(--border-color);\n          transition: var(--transition-base);\n          border-radius: 24px;\n        }\n\n        .toggle-slider:before {\n          position: absolute;\n          content: "";\n          height: 18px;\n          width: 18px;\n          left: 3px;\n          bottom: 3px;\n          background-color: white;\n          transition: var(--transition-base);\n          border-radius: 50%;\n        }\n\n        input:checked + .toggle-slider {\n          background-color: var(--secondary-color);\n        }\n\n        input:checked + .toggle-slider:before {\n          transform: translateX(26px);\n        }\n\n        .range-slider {\n          width: 100%;\n          height: 8px;\n          border-radius: var(--border-radius);\n          background: var(--border-color);\n          outline: none;\n          -webkit-appearance: none;\n          appearance: none;\n        }\n\n        .range-slider::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          appearance: none;\n          width: 20px;\n          height: 20px;\n          border-radius: 50%;\n          background: var(--secondary-color);\n          cursor: pointer;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .range-slider::-moz-range-thumb {\n          width: 20px;\n          height: 20px;\n          border-radius: 50%;\n          background: var(--secondary-color);\n          cursor: pointer;\n          border: none;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .select-control {\n          width: 100%;\n          padding: var(--spacing-sm);\n          border: 1px solid var(--border-color);\n          border-radius: var(--border-radius);\n          background: var(--surface-color);\n          color: var(--text-color);\n          font-size: 0.9rem;\n        }\n\n        .select-control:focus {\n          outline: none;\n          border-color: var(--secondary-color);\n          box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);\n        }\n\n        .range-display {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: var(--spacing-sm);\n          font-size: 0.875rem;\n          color: var(--text-light);\n        }\n\n        .current-value {\n          font-weight: 600;\n          color: var(--secondary-color);\n        }\n\n        .about-content {\n          text-align: center;\n          max-width: 600px;\n          margin: 0 auto;\n        }\n\n        .app-logo {\n          font-size: 4rem;\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .app-version {\n          font-size: 1.2rem;\n          color: var(--text-light);\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .app-description {\n          font-size: 1rem;\n          color: var(--text-color);\n          line-height: 1.6;\n          margin-bottom: var(--spacing-xl);\n        }\n\n        .credits-section {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .credits-title {\n          font-size: 1.1rem;\n          font-weight: 600;\n          color: var(--primary-color);\n          margin-bottom: var(--spacing-md);\n        }\n\n        .stats-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n          gap: var(--spacing-md);\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .stat-item {\n          text-align: center;\n          padding: var(--spacing-md);\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          border: 1px solid var(--border-color);\n        }\n\n        .stat-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          color: var(--secondary-color);\n          display: block;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .stat-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n        }\n\n        @media (max-width: 768px) {\n          .settings-header {\n            flex-direction: column;\n            gap: var(--spacing-lg);\n            text-align: center;\n          }\n\n          .settings-actions {\n            flex-direction: column;\n            width: 100%;\n          }\n\n          .settings-tabs {\n            overflow-x: auto;\n            padding: var(--spacing-xs);\n          }\n\n          .tab-btn {\n            min-width: 100px;\n            padding: var(--spacing-sm);\n          }\n\n          .tab-text {\n            display: none;\n          }\n\n          .settings-grid {\n            grid-template-columns: 1fr;\n          }\n\n          .tab-content {\n            padding: var(--spacing-md);\n          }\n\n          .theme-selector {\n            grid-template-columns: 1fr;\n          }\n\n          .stats-grid {\n            grid-template-columns: repeat(2, 1fr);\n          }\n        }\n      </style>\n    `}renderDisplayTab(){return`\n      <div class="settings-section">\n        <h3 class="section-title">🎨 Appearance</h3>\n        <div class="settings-grid">\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">🌙 Theme</div>\n              <div class="setting-description">Choose your preferred color scheme</div>\n            </div>\n            <div class="setting-control">\n              <div class="theme-selector">\n                <div class="theme-option theme-light ${"light"===this.settings.theme?"active":""}" data-theme="light">\n                  <div class="theme-preview"></div>\n                  <div class="theme-name">Light</div>\n                </div>\n                <div class="theme-option theme-dark ${"dark"===this.settings.theme?"active":""}" data-theme="dark">\n                  <div class="theme-preview"></div>\n                  <div class="theme-name">Dark</div>\n                </div>\n                <div class="theme-option theme-system ${"system"===this.settings.theme?"active":""}" data-theme="system">\n                  <div class="theme-preview"></div>\n                  <div class="theme-name">System</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">⚡ Animation Speed</div>\n              <div class="setting-description">Control the speed of UI animations</div>\n            </div>\n            <div class="setting-control">\n              <select class="select-control" id="animation-speed">\n                <option value="slow" ${"slow"===this.settings.animationSpeed?"selected":""}>Slow</option>\n                <option value="normal" ${"normal"===this.settings.animationSpeed?"selected":""}>Normal</option>\n                <option value="fast" ${"fast"===this.settings.animationSpeed?"selected":""}>Fast</option>\n                <option value="none" ${"none"===this.settings.animationSpeed?"selected":""}>Disabled</option>\n              </select>\n            </div>\n          </div>\n\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">🌐 Language</div>\n              <div class="setting-description">Select your preferred language</div>\n            </div>\n            <div class="setting-control">\n              <select class="select-control" id="language-select">\n                <option value="en" ${"en"===this.settings.language?"selected":""}>English</option>\n                <option value="es" ${"es"===this.settings.language?"selected":""}>Español</option>\n                <option value="fr" ${"fr"===this.settings.language?"selected":""}>Français</option>\n                <option value="de" ${"de"===this.settings.language?"selected":""}>Deutsch</option>\n                <option value="pt" ${"pt"===this.settings.language?"selected":""}>Português</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderGameplayTab(){return`\n      <div class="settings-section">\n        <h3 class="section-title">🎮 Game Mechanics</h3>\n        <div class="settings-grid">\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">⏱️ Game Speed</div>\n              <div class="setting-description">Control how fast the game progresses</div>\n            </div>\n            <div class="setting-control">\n              <div class="range-display">\n                <span>Slow</span>\n                <span class="current-value">${this.settings.gameSpeed}ms</span>\n                <span>Fast</span>\n              </div>\n              <input type="range" class="range-slider" id="game-speed" \n                     min="100" max="5000" step="100" value="${this.settings.gameSpeed}">\n            </div>\n          </div>\n\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">💾 Auto-Save</div>\n              <div class="setting-description">Automatically save game progress every few turns</div>\n            </div>\n            <div class="setting-control">\n              <label class="toggle-switch">\n                <input type="checkbox" id="auto-save" ${this.settings.autoSave?"checked":""}>\n                <span class="toggle-slider"></span>\n              </label>\n            </div>\n          </div>\n\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">🔔 Notifications</div>\n              <div class="setting-description">Show notifications for important events</div>\n            </div>\n            <div class="setting-control">\n              <label class="toggle-switch">\n                <input type="checkbox" id="notifications" ${this.settings.notifications?"checked":""}>\n                <span class="toggle-slider"></span>\n              </label>\n            </div>\n          </div>\n\n          <div class="setting-item">\n            <div class="setting-header">\n              <div class="setting-title">⏸️ Auto-Pause</div>\n              <div class="setting-description">Automatically pause when important events occur</div>\n            </div>\n            <div class="setting-control">\n              <label class="toggle-switch">\n                <input type="checkbox" id="auto-pause" ${this.settings.autoPause?"checked":""}>\n                <span class="toggle-slider"></span>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderAboutTab(){return'\n      <div class="about-content">\n        <div class="app-logo">🏛️</div>\n        <h2>SP_Sim</h2>\n        <div class="app-version">Version 1.0.0</div>\n        <div class="app-description">\n          A single-player web-based political economy simulation game where players take on \n          the role of a political leader managing a nation through complex economic, political, \n          and global challenges.\n        </div>\n\n        <div class="credits-section">\n          <div class="credits-title">Credits</div>\n          <p>Developed by the McPolitics team</p>\n          <p>Built with modern web technologies</p>\n        </div>\n\n        <div class="stats-grid">\n          <div class="stat-item">\n            <span class="stat-value">2024</span>\n            <span class="stat-label">Release Year</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-value">JavaScript</span>\n            <span class="stat-label">Technology</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-value">MIT</span>\n            <span class="stat-label">License</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-value">Open Source</span>\n            <span class="stat-label">Type</span>\n          </div>\n        </div>\n      </div>\n    '}setupEventListeners(){const n=this.element.querySelectorAll(".tab-btn"),e=this.element.querySelectorAll(".tab-content");n.forEach(t=>{t.addEventListener("click",()=>{const i=t.getAttribute("data-tab");n.forEach(n=>n.classList.remove("active")),t.classList.add("active"),e.forEach(n=>n.classList.remove("active"));const a=document.getElementById(`tab-${i}`);a&&a.classList.add("active")})});const t=document.querySelectorAll(".theme-option");t.forEach(n=>{n.addEventListener("click",()=>{const e=n.getAttribute("data-theme");this.settings.theme=e,this.saveSettings(),this.applyTheme(),t.forEach(n=>n.classList.remove("active")),n.classList.add("active")})});const i=document.getElementById("game-speed");i&&i.addEventListener("input",n=>{const e=parseInt(n.target.value,10);this.settings.gameSpeed=e,s.setGameSpeed(e),this.saveSettings();const t=document.querySelector("#tab-gameplay .current-value");t&&(t.textContent=`${e}ms`)}),[{id:"auto-save",setting:"autoSave"},{id:"auto-pause",setting:"autoPause"},{id:"notifications",setting:"notifications"}].forEach(({id:n,setting:e})=>{const t=document.getElementById(n);t&&t.addEventListener("change",n=>{this.settings[e]=n.target.checked,this.saveSettings()})});const a=document.getElementById("animation-speed");a&&a.addEventListener("change",n=>{this.settings.animationSpeed=n.target.value,this.saveSettings(),this.applyAnimationSpeed()});const o=document.getElementById("language-select");o&&o.addEventListener("change",n=>{this.settings.language=n.target.value,this.saveSettings()}),this.setupActionButtons()}setupActionButtons(){const n=document.getElementById("reset-settings");n&&n.addEventListener("click",()=>{window.confirm("Are you sure you want to reset all settings to defaults?")&&this.resetToDefaults()});const e=document.getElementById("export-settings");e&&e.addEventListener("click",()=>this.exportSettings())}applyTheme(){const n=document.documentElement;"dark"===this.settings.theme?(n.classList.add("dark-theme"),n.classList.remove("light-theme")):"light"===this.settings.theme?(n.classList.add("light-theme"),n.classList.remove("dark-theme")):n.classList.remove("dark-theme","light-theme")}applyAnimationSpeed(){const n=document.documentElement,e={slow:"0.4s",normal:"0.2s",fast:"0.1s",none:"0s"},t=e[this.settings.animationSpeed]||e.normal;n.style.setProperty("--transition-base",t),n.style.setProperty("--transition-fast",t),n.style.setProperty("--transition-slow",t)}resetToDefaults(){this.settings={gameSpeed:1e3,theme:"system",autoSave:!0,notifications:!0,autoPause:!1,soundEffects:!0,animationSpeed:"normal",language:"en",autoAdvanceTurn:!1,difficultyAdjustments:!0},this.saveSettings(),this.applyTheme(),this.applyAnimationSpeed(),this.render(),this.setupEventListeners(),this.showNotification("Settings reset to defaults","success")}exportSettings(){const n={version:"1.0.0",timestamp:(new Date).toISOString(),settings:this.settings},e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=`sp_sim_settings_${(new Date).toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(t),this.showNotification("Settings exported successfully","success")}showNotification(n,e="info"){window.spSimApp?window.spSimApp.showNotification(n,e):console.log(`${e.toUpperCase()}: ${n}`)}show(){return this.render(),this.setupEventListeners(),this.element}}class C extends d{constructor(){super(),this.currentTab="overview",this.activeEvents=[],this.politicalStatus=null,this.initializeScreen()}initializeScreen(){this.setupEventListeners()}setupEventListeners(){t.on("political:event_triggered",n=>{this.handlePoliticalEvent(n)}),t.on("political:vote_scheduled",n=>{this.handleVoteScheduled(n)})}handlePoliticalEvent(n){this.activeEvents.push(n.data.event),"events"===this.currentTab&&this.renderEventsTab()}handleVoteScheduled(n){"votes"===this.currentTab&&this.renderVotesTab()}render(){return`\n      <div class="politics-screen">\n        \x3c!-- Header --\x3e\n        <div class="politics-header">\n          <div class="header-content">\n            <h1>🏛️ Political Management</h1>\n            <p>Manage your coalition, respond to political events, and maintain political stability</p>\n          </div>\n          <div class="political-summary">\n            <div class="summary-metric">\n              <span class="metric-label">Current Approval</span>\n              <span class="metric-value" id="pol-approval">--</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Coalition Stability</span>\n              <span class="metric-value" id="pol-stability">--</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Political Pressure</span>\n              <span class="metric-value" id="pol-pressure">--</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Navigation Tabs --\x3e\n        <div class="politics-tabs">\n          <button class="tab-btn active" data-tab="overview">\n            <span class="tab-icon">📊</span>\n            <span class="tab-text">Overview</span>\n          </button>\n          <button class="tab-btn" data-tab="coalition">\n            <span class="tab-icon">🤝</span>\n            <span class="tab-text">Coalition</span>\n          </button>\n          <button class="tab-btn" data-tab="opposition">\n            <span class="tab-icon">⚔️</span>\n            <span class="tab-text">Opposition</span>\n          </button>\n          <button class="tab-btn" data-tab="events">\n            <span class="tab-icon">⚡</span>\n            <span class="tab-text">Events</span>\n            <span class="tab-badge" id="events-badge">0</span>\n          </button>\n          <button class="tab-btn" data-tab="votes">\n            <span class="tab-icon">🗳️</span>\n            <span class="tab-text">Votes</span>\n          </button>\n          <button class="tab-btn" data-tab="elections">\n            <span class="tab-icon">🏆</span>\n            <span class="tab-text">Elections</span>\n          </button>\n        </div>\n\n        \x3c!-- Tab Content --\x3e\n        <div class="politics-content">\n          \x3c!-- Overview Tab --\x3e\n          <div class="tab-content active" id="tab-overview">\n            ${this.renderOverviewTab()}\n          </div>\n\n          \x3c!-- Coalition Tab --\x3e\n          <div class="tab-content" id="tab-coalition">\n            ${this.renderCoalitionTab()}\n          </div>\n\n          \x3c!-- Opposition Tab --\x3e\n          <div class="tab-content" id="tab-opposition">\n            ${this.renderOppositionTab()}\n          </div>\n\n          \x3c!-- Events Tab --\x3e\n          <div class="tab-content" id="tab-events">\n            ${this.renderEventsTab()}\n          </div>\n\n          \x3c!-- Votes Tab --\x3e\n          <div class="tab-content" id="tab-votes">\n            ${this.renderVotesTab()}\n          </div>\n\n          \x3c!-- Elections Tab --\x3e\n          <div class="tab-content" id="tab-elections">\n            ${this.renderElectionsTab()}\n          </div>\n        </div>\n      </div>\n      \n      \x3c!-- Politics Screen Styles --\x3e\n      <style>\n        .politics-screen {\n          max-width: 1200px;\n          margin: 0 auto;\n          padding: var(--spacing-lg);\n        }\n\n        .politics-header {\n          background: linear-gradient(135deg, var(--surface-color) 0%, var(--background-alt) 100%);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xl);\n          margin-bottom: var(--spacing-lg);\n          box-shadow: var(--shadow-md);\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          border: 1px solid var(--border-color);\n        }\n\n        .header-content h1 {\n          margin: 0 0 var(--spacing-sm) 0;\n          color: var(--primary-color);\n          font-size: 2rem;\n          font-weight: 700;\n        }\n\n        .header-content p {\n          margin: 0;\n          color: var(--text-light);\n          font-size: 1rem;\n          line-height: 1.5;\n        }\n\n        .political-summary {\n          display: flex;\n          gap: var(--spacing-lg);\n        }\n\n        .summary-metric {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          text-align: center;\n          min-width: 120px;\n        }\n\n        .metric-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n          margin-bottom: var(--spacing-xs);\n          font-weight: 500;\n        }\n\n        .metric-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          color: var(--secondary-color);\n        }\n\n        .politics-tabs {\n          display: flex;\n          gap: 0;\n          margin-bottom: var(--spacing-lg);\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xs);\n          box-shadow: var(--shadow-sm);\n          border: 1px solid var(--border-color);\n          overflow-x: auto;\n        }\n\n        .tab-btn {\n          flex: 1;\n          min-width: 120px;\n          padding: var(--spacing-md) var(--spacing-lg);\n          border: none;\n          background: none;\n          color: var(--text-light);\n          font-weight: 500;\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: var(--spacing-sm);\n          position: relative;\n          white-space: nowrap;\n        }\n\n        .tab-btn:hover {\n          background: var(--background-alt);\n          color: var(--text-color);\n        }\n\n        .tab-btn.active {\n          background: var(--secondary-color);\n          color: white;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .tab-icon {\n          font-size: 1.2rem;\n        }\n\n        .tab-badge {\n          position: absolute;\n          top: -5px;\n          right: -5px;\n          background: var(--accent-color);\n          color: white;\n          border-radius: 50%;\n          min-width: 20px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 0.75rem;\n          font-weight: bold;\n        }\n\n        .politics-content {\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          box-shadow: var(--shadow-md);\n          border: 1px solid var(--border-color);\n          min-height: 500px;\n        }\n\n        .tab-content {\n          display: none;\n          padding: var(--spacing-xl);\n          animation: fadeInUp 0.3s ease-out;\n        }\n\n        .tab-content.active {\n          display: block;\n        }\n\n        .politics-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          gap: var(--spacing-lg);\n        }\n\n        .politics-panel {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n        }\n\n        .politics-panel h3 {\n          margin: 0 0 var(--spacing-md) 0;\n          color: var(--primary-color);\n          font-size: 1.2rem;\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-sm);\n        }\n\n        .party-list {\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-md);\n        }\n\n        .party-item {\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-md);\n          border: 1px solid var(--border-color);\n          transition: all var(--transition-base);\n        }\n\n        .party-item:hover {\n          transform: translateY(-2px);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .party-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: var(--spacing-sm);\n        }\n\n        .party-name {\n          font-weight: 600;\n          color: var(--text-color);\n          font-size: 1rem;\n        }\n\n        .party-support {\n          font-weight: 700;\n          color: var(--secondary-color);\n        }\n\n        .party-description {\n          color: var(--text-light);\n          font-size: 0.875rem;\n          line-height: 1.4;\n          margin-bottom: var(--spacing-sm);\n        }\n\n        .support-bar {\n          width: 100%;\n          height: 8px;\n          background: var(--border-light);\n          border-radius: var(--border-radius);\n          overflow: hidden;\n          margin-bottom: var(--spacing-sm);\n        }\n\n        .support-fill {\n          height: 100%;\n          background: linear-gradient(90deg, var(--secondary-color), var(--secondary-light));\n          border-radius: var(--border-radius);\n          transition: width 0.8s ease-out;\n        }\n\n        .party-status {\n          display: flex;\n          gap: var(--spacing-sm);\n          flex-wrap: wrap;\n        }\n\n        .status-tag {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius-sm);\n          font-size: 0.75rem;\n          font-weight: 500;\n          text-transform: uppercase;\n          letter-spacing: 0.025em;\n        }\n\n        .status-stable {\n          background: var(--success-color);\n          color: white;\n        }\n\n        .status-unstable {\n          background: var(--warning-color);\n          color: white;\n        }\n\n        .status-hostile {\n          background: var(--accent-color);\n          color: white;\n        }\n\n        .status-loyal {\n          background: var(--info-color);\n          color: white;\n        }\n\n        .event-list {\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-md);\n        }\n\n        .event-item {\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n          transition: all var(--transition-base);\n          cursor: pointer;\n        }\n\n        .event-item:hover {\n          border-color: var(--secondary-color);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .event-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .event-title {\n          font-weight: 600;\n          color: var(--text-color);\n          font-size: 1.1rem;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .event-type {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius-sm);\n          font-size: 0.75rem;\n          font-weight: 500;\n          text-transform: uppercase;\n        }\n\n        .event-policy_vote {\n          background: var(--info-color);\n          color: white;\n        }\n\n        .event-coalition_crisis {\n          background: var(--warning-color);\n          color: white;\n        }\n\n        .event-political_crisis {\n          background: var(--accent-color);\n          color: white;\n        }\n\n        .event-description {\n          color: var(--text-light);\n          line-height: 1.5;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .event-options {\n          display: flex;\n          flex-direction: column;\n          gap: var(--spacing-sm);\n        }\n\n        .event-option {\n          padding: var(--spacing-sm) var(--spacing-md);\n          border: 1px solid var(--border-color);\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          text-align: left;\n        }\n\n        .event-option:hover {\n          background: var(--secondary-color);\n          color: white;\n          border-color: var(--secondary-color);\n        }\n\n        .option-title {\n          font-weight: 500;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .option-description {\n          font-size: 0.875rem;\n          opacity: 0.9;\n        }\n\n        .election-info {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          margin-bottom: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n        }\n\n        .election-countdown {\n          text-align: center;\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .countdown-number {\n          font-size: 3rem;\n          font-weight: 700;\n          color: var(--secondary-color);\n          display: block;\n        }\n\n        .countdown-label {\n          color: var(--text-light);\n          font-size: 1rem;\n          margin-top: var(--spacing-sm);\n        }\n\n        .approval-trends {\n          margin-bottom: var(--spacing-lg);\n        }\n\n        .trends-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n          gap: var(--spacing-md);\n        }\n\n        .trend-item {\n          text-align: center;\n          padding: var(--spacing-md);\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          border: 1px solid var(--border-color);\n        }\n\n        .trend-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .trend-positive {\n          color: var(--success-color);\n        }\n\n        .trend-negative {\n          color: var(--accent-color);\n        }\n\n        .trend-neutral {\n          color: var(--warning-color);\n        }\n\n        .trend-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: var(--spacing-xl);\n          color: var(--text-light);\n        }\n\n        .empty-state-icon {\n          font-size: 3rem;\n          margin-bottom: var(--spacing-md);\n          opacity: 0.5;\n        }\n\n        .empty-state h3 {\n          margin-bottom: var(--spacing-sm);\n          color: var(--text-color);\n        }\n\n        @media (max-width: 768px) {\n          .politics-header {\n            flex-direction: column;\n            gap: var(--spacing-lg);\n            text-align: center;\n          }\n\n          .political-summary {\n            flex-direction: column;\n            gap: var(--spacing-md);\n            width: 100%;\n          }\n\n          .politics-tabs {\n            overflow-x: auto;\n            padding: var(--spacing-xs);\n          }\n\n          .tab-btn {\n            min-width: 100px;\n            padding: var(--spacing-sm);\n          }\n\n          .tab-text {\n            display: none;\n          }\n\n          .politics-grid {\n            grid-template-columns: 1fr;\n          }\n\n          .tab-content {\n            padding: var(--spacing-md);\n          }\n\n          .trends-grid {\n            grid-template-columns: repeat(2, 1fr);\n          }\n        }\n      </style>\n    `}renderOverviewTab(){return'\n      <div class="politics-grid">\n        <div class="politics-panel">\n          <h3>📊 Political Overview</h3>\n          <div class="approval-trends">\n            <div class="trends-grid">\n              <div class="trend-item">\n                <div class="trend-value trend-positive" id="approval-trend">+2.3%</div>\n                <div class="trend-label">This Week</div>\n              </div>\n              <div class="trend-item">\n                <div class="trend-value trend-positive" id="approval-month">+5.1%</div>\n                <div class="trend-label">This Month</div>\n              </div>\n              <div class="trend-item">\n                <div class="trend-value trend-neutral" id="approval-year">-1.2%</div>\n                <div class="trend-label">This Year</div>\n              </div>\n            </div>\n          </div>\n          <div class="politics-stats">\n            <div class="stat-item">\n              <span class="stat-label">Coalition Seats:</span>\n              <span class="stat-value" id="coalition-seats">156/300</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Opposition Seats:</span>\n              <span class="stat-value" id="opposition-seats">144/300</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Majority Needed:</span>\n              <span class="stat-value">151</span>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>⚡ Recent Political Events</h3>\n          <div class="recent-events" id="recent-political-events">\n            <div class="empty-state">\n              <div class="empty-state-icon">📰</div>\n              <h4>No Recent Events</h4>\n              <p>Political events will appear here as they occur</p>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>🎯 Key Challenges</h3>\n          <div class="challenges-list" id="political-challenges">\n            <div class="challenge-item">\n              <h4>Coalition Stability</h4>\n              <p>Maintain support from coalition partners while advancing your agenda</p>\n              <div class="progress-bar">\n                <div class="progress-fill" style="width: 75%"></div>\n              </div>\n            </div>\n            <div class="challenge-item">\n              <h4>Opposition Relations</h4>\n              <p>Navigate opposition challenges and find areas for bipartisan cooperation</p>\n              <div class="progress-bar">\n                <div class="progress-fill" style="width: 45%"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>📅 Upcoming Milestones</h3>\n          <div class="milestones-list" id="political-milestones">\n            <div class="milestone-item">\n              <div class="milestone-date">Week 12</div>\n              <div class="milestone-text">Budget Vote in Parliament</div>\n            </div>\n            <div class="milestone-item">\n              <div class="milestone-date">Week 18</div>\n              <div class="milestone-text">Coalition Review Meeting</div>\n            </div>\n            <div class="milestone-item">\n              <div class="milestone-date">Next Year</div>\n              <div class="milestone-text">General Election</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderCoalitionTab(){return'\n      <div class="politics-grid">\n        <div class="politics-panel">\n          <h3>🤝 Coalition Partners</h3>\n          <div class="party-list" id="coalition-parties">\n            <div class="party-item">\n              <div class="party-header">\n                <div class="party-name">Progressive Alliance</div>\n                <div class="party-support">78%</div>\n              </div>\n              <div class="party-description">\n                Your main coalition partner, focused on social and economic reforms\n              </div>\n              <div class="support-bar">\n                <div class="support-fill" style="width: 78%"></div>\n              </div>\n              <div class="party-status">\n                <span class="status-tag status-stable">Stable</span>\n                <span class="status-tag status-loyal">Loyal</span>\n              </div>\n            </div>\n            \n            <div class="party-item">\n              <div class="party-header">\n                <div class="party-name">Center Coalition</div>\n                <div class="party-support">65%</div>\n              </div>\n              <div class="party-description">\n                Moderate centrist party that provides crucial swing votes\n              </div>\n              <div class="support-bar">\n                <div class="support-fill" style="width: 65%"></div>\n              </div>\n              <div class="party-status">\n                <span class="status-tag status-unstable">Wavering</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>📋 Coalition Management</h3>\n          <div class="management-options">\n            <button class="btn btn--secondary" onclick="handleCoalitionAction(\'meeting\')">\n              📅 Schedule Coalition Meeting\n            </button>\n            <button class="btn btn--secondary" onclick="handleCoalitionAction(\'concessions\')">\n              🤝 Offer Policy Concessions\n            </button>\n            <button class="btn btn--secondary" onclick="handleCoalitionAction(\'reshuffle\')">\n              🔄 Cabinet Reshuffle\n            </button>\n            <button class="btn btn--secondary" onclick="handleCoalitionAction(\'negotiate\')">\n              💬 Private Negotiations\n            </button>\n          </div>\n          \n          <div class="coalition-health">\n            <h4>Coalition Health Indicators</h4>\n            <div class="health-metrics">\n              <div class="health-item">\n                <span>Unity Score:</span>\n                <span class="health-value health-good">87%</span>\n              </div>\n              <div class="health-item">\n                <span>Trust Level:</span>\n                <span class="health-value health-warning">72%</span>\n              </div>\n              <div class="health-item">\n                <span>Policy Alignment:</span>\n                <span class="health-value health-good">81%</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderOppositionTab(){return'\n      <div class="politics-grid">\n        <div class="politics-panel">\n          <h3>⚔️ Opposition Parties</h3>\n          <div class="party-list" id="opposition-parties">\n            <div class="party-item">\n              <div class="party-header">\n                <div class="party-name">Conservative Opposition</div>\n                <div class="party-support">82%</div>\n              </div>\n              <div class="party-description">\n                The main opposition party, strongly critical of your policies\n              </div>\n              <div class="support-bar">\n                <div class="support-fill" style="width: 82%"></div>\n              </div>\n              <div class="party-status">\n                <span class="status-tag status-hostile">Hostile</span>\n                <span class="status-tag status-stable">Unified</span>\n              </div>\n            </div>\n            \n            <div class="party-item">\n              <div class="party-header">\n                <div class="party-name">Independent Block</div>\n                <div class="party-support">45%</div>\n              </div>\n              <div class="party-description">\n                Small independent parties that occasionally support government initiatives\n              </div>\n              <div class="support-bar">\n                <div class="support-fill" style="width: 45%"></div>\n              </div>\n              <div class="party-status">\n                <span class="status-tag status-unstable">Unpredictable</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>🎯 Opposition Strategy</h3>\n          <div class="strategy-options">\n            <button class="btn btn--secondary" onclick="handleOppositionAction(\'dialogue\')">\n              💬 Open Dialogue\n            </button>\n            <button class="btn btn--secondary" onclick="handleOppositionAction(\'compromise\')">\n              🤝 Seek Compromise\n            </button>\n            <button class="btn btn--secondary" onclick="handleOppositionAction(\'counter\')">\n              ⚡ Counter Opposition\n            </button>\n            <button class="btn btn--secondary" onclick="handleOppositionAction(\'ignore\')">\n              🚫 Ignore Criticism\n            </button>\n          </div>\n          \n          <div class="opposition-threats">\n            <h4>Current Opposition Actions</h4>\n            <div class="threat-list">\n              <div class="threat-item threat-medium">\n                <strong>No Confidence Motion Threatened</strong>\n                <p>Opposition may call for no confidence vote if budget fails</p>\n              </div>\n              <div class="threat-item threat-low">\n                <strong>Media Campaign</strong>\n                <p>Ongoing criticism in press about economic policies</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderEventsTab(){return 0===this.activeEvents.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">⚡</div>\n          <h3>No Active Political Events</h3>\n          <p>Political events and decisions will appear here when they arise</p>\n        </div>\n      ':`\n      <div class="event-list">\n        ${this.activeEvents.map(n=>`\n          <div class="event-item" data-event-id="${n.id}">\n            <div class="event-header">\n              <div>\n                <div class="event-title">${n.title}</div>\n                <span class="event-type event-${n.type}">${n.type.replace("_"," ")}</span>\n              </div>\n              <div class="event-deadline">\n                Deadline: Week ${n.deadline.week}\n              </div>\n            </div>\n            <div class="event-description">${n.description}</div>\n            <div class="event-options">\n              ${n.options.map(e=>`\n                <button class="event-option" onclick="handleEventResponse('${n.id}', '${e.id}')">\n                  <div class="option-title">${e.text}</div>\n                  <div class="option-description">${e.description}</div>\n                </button>\n              `).join("")}\n            </div>\n          </div>\n        `).join("")}\n      </div>\n    `}renderVotesTab(){return'\n      <div class="politics-grid">\n        <div class="politics-panel">\n          <h3>🗳️ Upcoming Votes</h3>\n          <div class="vote-list" id="upcoming-votes">\n            <div class="empty-state">\n              <div class="empty-state-icon">🗳️</div>\n              <h4>No Scheduled Votes</h4>\n              <p>Parliamentary votes will be scheduled here</p>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>📊 Voting History</h3>\n          <div class="vote-history" id="vote-history">\n            <div class="vote-record">\n              <div class="vote-title">Healthcare Reform Act</div>\n              <div class="vote-result vote-passed">Passed</div>\n              <div class="vote-details">156-144 (Coalition Unity: 94%)</div>\n            </div>\n            <div class="vote-record">\n              <div class="vote-title">Tax Amendment Bill</div>\n              <div class="vote-result vote-failed">Failed</div>\n              <div class="vote-details">148-152 (Coalition Unity: 78%)</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderElectionsTab(){return'\n      <div class="politics-grid">\n        <div class="politics-panel">\n          <h3>🏆 Next Election</h3>\n          <div class="election-info">\n            <div class="election-countdown">\n              <span class="countdown-number" id="election-weeks">47</span>\n              <div class="countdown-label">weeks until election</div>\n            </div>\n            <div class="election-details">\n              <h4>Election Forecast</h4>\n              <div class="forecast-grid">\n                <div class="forecast-item">\n                  <span class="forecast-label">Current Projection:</span>\n                  <span class="forecast-value forecast-positive">52% - Victory</span>\n                </div>\n                <div class="forecast-item">\n                  <span class="forecast-label">Coalition Seats:</span>\n                  <span class="forecast-value">158-162</span>\n                </div>\n                <div class="forecast-item">\n                  <span class="forecast-label">Margin of Error:</span>\n                  <span class="forecast-value">±4%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>📈 Electoral Strategy</h3>\n          <div class="strategy-recommendations">\n            <div class="recommendation-item">\n              <h4>🎯 Focus on Economy</h4>\n              <p>Economic performance is the top voter concern. Continue growth policies.</p>\n              <div class="rec-priority">High Priority</div>\n            </div>\n            <div class="recommendation-item">\n              <h4>🤝 Strengthen Coalition</h4>\n              <p>Unity within coalition will be crucial for electoral success.</p>\n              <div class="rec-priority">Medium Priority</div>\n            </div>\n            <div class="recommendation-item">\n              <h4>📢 Public Communication</h4>\n              <p>Improve public communication of policy successes.</p>\n              <div class="rec-priority">Medium Priority</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="politics-panel">\n          <h3>📊 Swing Factors</h3>\n          <div class="swing-factors">\n            <div class="factor-item">\n              <div class="factor-name">Economic Growth</div>\n              <div class="factor-impact factor-positive">+3.2%</div>\n            </div>\n            <div class="factor-name">Coalition Stability</div>\n              <div class="factor-impact factor-positive">+1.8%</div>\n            </div>\n            <div class="factor-item">\n              <div class="factor-name">International Relations</div>\n              <div class="factor-impact factor-neutral">±0.5%</div>\n            </div>\n            <div class="factor-item">\n              <div class="factor-name">Crisis Management</div>\n              <div class="factor-impact factor-unknown">TBD</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}setupInteractivity(){const n=document.querySelectorAll(".politics-screen .tab-btn"),e=document.querySelectorAll(".politics-screen .tab-content");n.forEach(t=>{t.addEventListener("click",()=>{const i=t.getAttribute("data-tab");n.forEach(n=>n.classList.remove("active")),t.classList.add("active"),e.forEach(n=>n.classList.remove("active"));const a=document.getElementById(`tab-${i}`);a&&a.classList.add("active"),this.currentTab=i})}),window.handleEventResponse=(n,e)=>{this.handleEventResponse(n,e)},window.handleCoalitionAction=n=>{this.handleCoalitionAction(n)},window.handleOppositionAction=n=>{this.handleOppositionAction(n)}}handleEventResponse(n,e){const i=this.activeEvents.findIndex(e=>e.id===n);if(-1!==i){const a=this.activeEvents[i];this.activeEvents.splice(i,1),t.emit("political:event_response",{eventId:n,optionId:e,gameState:this.gameState}),this.updateEventsTab(),this.showNotification(`Political event resolved: ${a.title}`,"success")}}handleCoalitionAction(n){this.showNotification({meeting:"Scheduled coalition meeting for next week",concessions:"Offered policy concessions to coalition partners",reshuffle:"Initiated cabinet reshuffle discussions",negotiate:"Began private negotiations with coalition leaders"}[n]||"Coalition action taken","info")}handleOppositionAction(n){this.showNotification({dialogue:"Opened dialogue with opposition leaders",compromise:"Proposed compromise on contentious issues",counter:"Launched counter-campaign against opposition",ignore:"Decided to ignore opposition criticism"}[n]||"Opposition strategy implemented","info")}updateEventsTab(){const n=document.getElementById("tab-events");n&&(n.innerHTML=this.renderEventsTab());const e=document.getElementById("events-badge");e&&(e.textContent=this.activeEvents.length,e.style.display=this.activeEvents.length>0?"flex":"none")}update(n){this.gameState=n,this.politicalStatus=c.getPoliticalStatus(n),this.updateElement("#pol-approval",`${n.politics.approval.toFixed(1)}%`),this.updateElement("#pol-stability",`${this.politicalStatus.coalitionStability.toFixed(0)}%`),this.updateElement("#pol-pressure",`${this.politicalStatus.politicalPressure.toFixed(0)}%`);const e=document.getElementById("events-badge");e&&(e.textContent=this.activeEvents.length,e.style.display=this.activeEvents.length>0?"flex":"none")}showNotification(n,e="info"){window.spSimApp&&window.spSimApp.showNotification(n,e)}show(){if(!document.querySelector("#screen-politics .politics-screen")){const n=document.querySelector("#screen-politics");n&&(n.innerHTML=this.render(),this.setupInteractivity())}return this.element}}const E=new class{constructor(){this.eventSystem=t,this.mediaOutlets=this.initializeMediaOutlets(),this.activeStories=[],this.scandals=[],this.publicOpinion={trustInMedia:70,politicalAwareness:60,socialMediaInfluence:40},this.newsCycle={currentWeek:0,trendingTopics:[],mediaAttention:50},this.setupEventListeners()}initializeMediaOutlets(){return{television:[{id:"national_news",name:"National News Network",type:"television",bias:"center",reach:85,credibility:80,influence:90,specialties:["politics","economics","international"]},{id:"conservative_tv",name:"Conservative Broadcasting",type:"television",bias:"right",reach:70,credibility:65,influence:75,specialties:["politics","economics","social"]},{id:"progressive_tv",name:"Progressive Network",type:"television",bias:"left",reach:60,credibility:70,influence:65,specialties:["politics","environment","social"]}],print:[{id:"national_times",name:"The National Times",type:"print",bias:"center-left",reach:40,credibility:90,influence:70,specialties:["politics","investigative","international"]},{id:"business_journal",name:"Business Journal",type:"print",bias:"center-right",reach:30,credibility:85,influence:60,specialties:["economics","business","politics"]}],socialMedia:[{id:"social_platform",name:"SocialConnect",type:"social_media",bias:"varies",reach:95,credibility:40,influence:80,specialties:["viral","opinion","breaking_news"]},{id:"news_aggregator",name:"NewsHub",type:"social_media",bias:"algorithmic",reach:70,credibility:50,influence:60,specialties:["aggregation","trending","personalized"]}]}}setupEventListeners(){this.eventSystem.on("game:turn_processed",n=>{this.processMediaCycle(n.data.gameState)}),this.eventSystem.on("political:event_resolved",n=>{this.coverPoliticalEvent(n.data)}),this.eventSystem.on("economic:major_change",n=>{this.coverEconomicNews(n.data)}),this.eventSystem.on("media:scandal_triggered",n=>{this.handleScandalCoverage(n.data)}),this.eventSystem.on("media:story_response",n=>{this.handleStoryResponse(n.data)})}processMediaCycle(n){this.newsCycle.currentWeek=n.time.week+52*(n.time.year-1),this.updateMediaAttention(n),this.updateActiveStories(n),this.generateNewsStories(n),this.checkForScandals(n),this.updatePublicOpinion(n)}updateMediaAttention(n){let e=this.newsCycle.mediaAttention;n.politics.approval<40&&(e+=5),n.politics.approval>70&&(e+=3),this.activeStories.length>3&&(e+=3),this.scandals.filter(n=>"active"===n.status).length>0&&(e+=10),e+=.1*(50-e),this.newsCycle.mediaAttention=Math.max(0,Math.min(100,e))}updateActiveStories(n){this.activeStories.forEach(n=>{n.age+=1,n.relevance=Math.max(0,n.relevance-10),(n.age>n.maxAge||n.relevance<10)&&(n.status="expired")}),this.activeStories=this.activeStories.filter(n=>"expired"!==n.status)}generateNewsStories(n){const e=this.calculateStoryProbability(n);if(Math.random()<e){const e=this.selectStoryType(n),t=this.createNewsStory(e,n);t&&this.publishStory(t,n)}}calculateStoryProbability(n){let e=.4;return e+=this.newsCycle.mediaAttention/100*.3,this.activeStories.length>2&&(e-=.2),(n.politics.approval<35||n.politics.approval>75)&&(e+=.2),Math.min(.8,e)}selectStoryType(n){const e={political_analysis:30,economic_report:25,policy_critique:20,human_interest:15,investigative:10};n.politics.approval<40&&(e.political_analysis+=20,e.investigative+=15),n.economy.gdpGrowth<1&&(e.economic_report+=20);const t=Object.values(e).reduce((n,e)=>n+e,0);let i=Math.random()*t;const a=Object.entries(e);let s="political_analysis";return a.find(([n,e])=>(i-=e,i<=0&&(s=n,!0))),s}createNewsStory(n,e){const t=this.getStoryTemplates(),i=t[n]||t.political_analysis,a=i[Math.floor(Math.random()*i.length)];return{id:`story_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:n,headline:this.personalizeHeadline(a.headline,e),content:this.personalizeContent(a.content,e),tone:this.calculateStoryTone(n,e),impact:a.impact,maxAge:a.maxAge||3,age:0,relevance:100,coveredBy:this.selectCoveringOutlets(n),status:"active",week:e.time.week,year:e.time.year}}getStoryTemplates(){return{political_analysis:[{headline:"Government Approval Rating Analysis: What the Numbers Mean",content:"Political analysts examine the latest polling data and its implications for upcoming policy decisions.",impact:{approval:[-3,2],mediaAttention:5},maxAge:2},{headline:"Coalition Dynamics Under Scrutiny",content:"Experts weigh in on the stability of the current governing coalition and potential challenges ahead.",impact:{approval:[-2,1],coalitionStability:[-5,2]},maxAge:3}],economic_report:[{headline:"Economic Indicators Show Mixed Signals",content:"Latest GDP and employment figures reveal a complex economic picture with both opportunities and challenges.",impact:{approval:[-1,3],economicConfidence:[-3,5]},maxAge:2},{headline:"Market Responds to Government Economic Policy",content:"Financial markets and business leaders react to recent government economic initiatives.",impact:{approval:[-2,4],economicConfidence:[-2,3]},maxAge:3}],policy_critique:[{headline:"Policy Implementation Under the Microscope",content:"Critics and supporters debate the effectiveness of recent government policy changes.",impact:{approval:[-5,3],politicalPressure:[2,8]},maxAge:3}],human_interest:[{headline:"Citizens Share Their Views on Government Performance",content:"Ordinary citizens discuss how government policies are affecting their daily lives.",impact:{approval:[-1,2],publicEngagement:[1,3]},maxAge:1}],investigative:[{headline:"Investigation Reveals Government Decision-Making Process",content:"In-depth investigation into how key government decisions are made behind closed doors.",impact:{approval:[-8,-2],transparency:[-5,0],mediaAttention:10},maxAge:4}]}}personalizeHeadline(n,e){return n.replace("{approval}",`${e.politics.approval.toFixed(1)}%`).replace("{gdp}",`${e.economy.gdpGrowth.toFixed(1)}%`).replace("{week}",`Week ${e.time.week}`).replace("{year}",`Year ${e.time.year}`)}personalizeContent(n,e){return n.replace("{approval}",`${e.politics.approval.toFixed(1)}%`).replace("{gdp}",`${e.economy.gdpGrowth.toFixed(1)}%`)}calculateStoryTone(n,e){let t="neutral";return"investigative"===n?t=e.politics.approval>60?"critical":"exposing":"political_analysis"===n?t=e.politics.approval>60?"positive":"critical":"economic_report"===n&&(t=e.economy.gdpGrowth>2?"positive":"concerned"),t}selectCoveringOutlets(n){return[...this.mediaOutlets.television,...this.mediaOutlets.print,...this.mediaOutlets.socialMedia].filter(e=>e.specialties.some(e=>this.storyMatchesSpecialty(n,e))||Math.random()<.4)}storyMatchesSpecialty(n,e){return{political_analysis:["politics","opinion"],economic_report:["economics","business"],policy_critique:["politics","investigative"],human_interest:["social","opinion"],investigative:["investigative","politics"]}[n]?.includes(e)||!1}publishStory(n,e){this.activeStories.push(n),this.applyStoryEffects(n,e),this.eventSystem.emit("media:story_published",{story:n,gameState:e,outlets:n.coveredBy}),this.eventSystem.emit("game:add_event",{title:`📰 Media Coverage: ${n.headline}`,description:n.content,type:"media",severity:this.getStorySeverity(n),storyId:n.id})}applyStoryEffects(n,e){const t=n.impact;if(t.approval){const[n,i]=t.approval,a=(n+Math.random()*(i-n))*(.8+.4*Math.random());e.politics.approval=Math.max(0,Math.min(100,e.politics.approval+a))}t.mediaAttention&&(this.newsCycle.mediaAttention=Math.max(0,Math.min(100,this.newsCycle.mediaAttention+t.mediaAttention)))}getStorySeverity(n){return"investigative"===n.type?"high":"policy_critique"===n.type?"medium":"low"}checkForScandals(n){const e=this.calculateScandalProbability(n);if(Math.random()<e){const e=this.generateScandal(n);e&&this.triggerScandal(e,n)}}calculateScandalProbability(n){let e=.05;return n.politics.approval<40&&(e+=.1),e+=this.newsCycle.mediaAttention/100*.1,this.scandals.filter(e=>"active"===e.status||e.resolvedWeek&&n.time.week+52*(n.time.year-1)-e.resolvedWeek<8).length>0&&(e*=.3),Math.min(.3,e)}generateScandal(n){const e=this.getScandalTypes(),t=e[Math.floor(Math.random()*e.length)];return{id:`scandal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:t.id,title:t.title,description:t.description,severity:t.severity,impact:t.impact,status:"brewing",discoveryWeek:n.time.week+Math.floor(3*Math.random())+1,discoveryYear:n.time.year,mediaAttention:0}}getScandalTypes(){return[{id:"policy_leak",title:"Confidential Policy Document Leaked",description:"Sensitive government documents reveal controversial policy discussions",severity:"medium",impact:{approval:[-8,-3],transparency:[-10,-5],mediaAttention:15}},{id:"expense_irregularity",title:"Government Expense Irregularities",description:"Questions raised about government spending on official events",severity:"low",impact:{approval:[-5,-2],trustInGovernment:[-5,-2],mediaAttention:10}},{id:"appointment_controversy",title:"Controversial Political Appointment",description:"Opposition questions qualifications of recent high-profile appointment",severity:"medium",impact:{approval:[-6,-2],coalitionStability:[-8,-3],mediaAttention:12}},{id:"meeting_scandal",title:"Undisclosed Private Meeting",description:"Reports emerge of undisclosed meetings with controversial figures",severity:"high",impact:{approval:[-12,-6],transparency:[-15,-8],mediaAttention:20}}]}triggerScandal(n,e){n.status="active",this.scandals.push(n),this.newsCycle.mediaAttention=Math.min(100,this.newsCycle.mediaAttention+n.impact.mediaAttention);const t={id:`scandal_story_${n.id}`,type:"scandal_breaking",headline:`🚨 BREAKING: ${n.title}`,content:n.description,tone:"breaking",impact:n.impact,maxAge:5,age:0,relevance:100,coveredBy:this.getAllMajorOutlets(),status:"active",scandalId:n.id,week:e.time.week,year:e.time.year};this.publishStory(t,e),this.eventSystem.emit("media:scandal_triggered",{scandal:n,story:t,gameState:e})}getAllMajorOutlets(){return[...this.mediaOutlets.television,...this.mediaOutlets.print.filter(n=>n.reach>35),...this.mediaOutlets.socialMedia]}handleScandalCoverage(n){const{scandal:e}=n;this.showScandalResponseModal(e,n.gameState)}showScandalResponseModal(n,e){this.eventSystem.emit("ui:show_modal",{title:`🚨 Scandal Alert: ${n.title}`,content:`\n        <div class="scandal-response-modal">\n          <div class="scandal-alert">\n            <div class="alert-icon">⚠️</div>\n            <p><strong>Scandal Detected!</strong> The media has uncovered a potential scandal.</p>\n          </div>\n          \n          <div class="scandal-details">\n            <h4>Situation:</h4>\n            <p>${n.description}</p>\n          </div>\n\n          <div class="scandal-impact">\n            <h4>Potential Impact:</h4>\n            <ul>\n              <li>📊 Approval rating could decline significantly</li>\n              <li>📺 Media attention will intensify</li>\n              <li>🏛️ Coalition stability may be affected</li>\n              <li>🗳️ Opposition may capitalize on this issue</li>\n            </ul>\n          </div>\n\n          <div class="response-options">\n            <h4>Response Strategy:</h4>\n            <div class="options-grid">\n              <button class="response-option" data-response="deny">\n                <strong>📢 Deny & Deflect</strong>\n                <span>Strongly deny allegations and redirect attention</span>\n              </button>\n              <button class="response-option" data-response="investigate">\n                <strong>🔍 Launch Investigation</strong>\n                <span>Announce internal investigation to find facts</span>\n              </button>\n              <button class="response-option" data-response="acknowledge">\n                <strong>✋ Acknowledge & Reform</strong>\n                <span>Accept responsibility and announce reforms</span>\n              </button>\n              <button class="response-option" data-response="ignore">\n                <strong>🤐 No Comment</strong>\n                <span>Refuse to comment and weather the storm</span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <style>\n          .scandal-response-modal {\n            max-width: 600px;\n            margin: 0 auto;\n          }\n          \n          .scandal-alert {\n            display: flex;\n            align-items: center;\n            gap: var(--spacing-md);\n            background: rgba(239, 68, 68, 0.1);\n            border: 1px solid rgba(239, 68, 68, 0.3);\n            border-radius: var(--border-radius);\n            padding: var(--spacing-md);\n            margin-bottom: var(--spacing-lg);\n            color: #dc2626;\n          }\n          \n          .alert-icon {\n            font-size: 2rem;\n          }\n          \n          .scandal-details,\n          .scandal-impact {\n            margin-bottom: var(--spacing-lg);\n          }\n          \n          .scandal-details h4,\n          .scandal-impact h4,\n          .response-options h4 {\n            color: var(--primary-color);\n            margin-bottom: var(--spacing-sm);\n          }\n          \n          .scandal-impact ul {\n            list-style: none;\n            padding: 0;\n          }\n          \n          .scandal-impact li {\n            padding: var(--spacing-xs) 0;\n          }\n          \n          .options-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: var(--spacing-md);\n          }\n          \n          .response-option {\n            padding: var(--spacing-md);\n            border: 2px solid var(--border-color);\n            border-radius: var(--border-radius);\n            background: var(--surface-color);\n            cursor: pointer;\n            transition: all var(--transition-base);\n            text-align: left;\n          }\n          \n          .response-option:hover {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.05);\n          }\n          \n          .response-option.selected {\n            border-color: var(--secondary-color);\n            background: rgba(49, 130, 206, 0.1);\n          }\n          \n          .response-option strong {\n            display: block;\n            margin-bottom: var(--spacing-xs);\n            color: var(--text-color);\n          }\n          \n          .response-option span {\n            color: var(--text-light);\n            font-size: 0.875rem;\n          }\n          \n          @media (max-width: 768px) {\n            .options-grid {\n              grid-template-columns: 1fr;\n            }\n          }\n        </style>\n      `,confirmText:"Respond to Scandal",cancelText:"Delay Response",showCancel:!0,onConfirm:()=>{const t=document.querySelector(".response-option.selected");if(!t)return!1;const i=t.getAttribute("data-response");return this.handleScandalResponse(n.id,i,e),!0}}),setTimeout(()=>{const n=document.querySelectorAll(".response-option");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected")})})},100)}handleScandalResponse(n,e,t){const i=this.scandals.find(e=>e.id===n);if(!i)return;const a=this.getScandalResponseEffects(e,i);this.applyScandalResponseEffects(a,t),i.response=e,i.responseWeek=t.time.week,i.responseYear=t.time.year;const s=this.createScandalFollowUpStory(i,e,t);this.publishStory(s,t),this.eventSystem.emit("media:scandal_response",{scandal:i,response:e,effects:a,gameState:t})}getScandalResponseEffects(n,e){const t={deny:{approval:[-3,1],transparency:[-5,-2],mediaAttention:5},investigate:{approval:[-1,2],transparency:[2,5],mediaAttention:-3},acknowledge:{approval:[-2,3],transparency:[5,8],mediaAttention:-5},ignore:{approval:[-5,-1],transparency:[-3,0],mediaAttention:8}},i=t[n]||t.ignore;let a;a="high"===e.severity?1.5:"medium"===e.severity?1:.7;const s={};return Object.keys(i).forEach(n=>{Array.isArray(i[n])?s[n]=i[n].map(n=>n*a):s[n]=i[n]*a}),s}applyScandalResponseEffects(n,e){if(n.approval){const[t,i]=n.approval,a=t+Math.random()*(i-t);e.politics.approval=Math.max(0,Math.min(100,e.politics.approval+a))}n.mediaAttention&&(this.newsCycle.mediaAttention=Math.max(0,Math.min(100,this.newsCycle.mediaAttention+n.mediaAttention)))}createScandalFollowUpStory(n,e,t){return{id:`scandal_followup_${n.id}`,type:"scandal_followup",headline:`📰 ${{deny:"Government Denies Scandal Allegations",investigate:"Investigation Launched into Scandal Claims",acknowledge:"Government Acknowledges Issues, Promises Reform",ignore:"Government Remains Silent on Scandal"}[e]}`,content:`Government responds to recent scandal with ${e} strategy. Public and opposition react to the handling of the situation.`,tone:"acknowledge"===e?"measured":"ongoing",impact:{mediaAttention:-2},maxAge:3,age:0,relevance:80,coveredBy:this.getAllMajorOutlets(),status:"active",scandalId:n.id,week:t.time.week,year:t.time.year}}updatePublicOpinion(n){this.publicOpinion.trustInMedia+=2*(Math.random()-.5),this.publicOpinion.trustInMedia=Math.max(0,Math.min(100,this.publicOpinion.trustInMedia)),this.newsCycle.mediaAttention>70&&(this.publicOpinion.politicalAwareness+=1),this.publicOpinion.politicalAwareness=Math.max(0,Math.min(100,this.publicOpinion.politicalAwareness)),this.publicOpinion.socialMediaInfluence+=1*(Math.random()-.4),this.publicOpinion.socialMediaInfluence=Math.max(0,Math.min(100,this.publicOpinion.socialMediaInfluence))}calculateMediaInfluence(){const n=this.getAllOutlets().reduce((n,e)=>n+e.reach,0),e=this.getAllOutlets().reduce((n,e)=>n+e.credibility,0)/this.getAllOutlets().length;return n/this.getAllOutlets().length*(e/100)}getAllOutlets(){return[...this.mediaOutlets.television,...this.mediaOutlets.print,...this.mediaOutlets.socialMedia]}coverPoliticalEvent(n){const{event:e,option:t,effects:i}=n,a={id:`political_coverage_${e.id}`,type:"political_coverage",headline:`📊 Government ${t.text} on ${e.title}`,content:`The government has decided to ${t.description}. ${this.formatEffects(i)}`,tone:i.approval>0?"positive":"critical",impact:{mediaAttention:3},maxAge:2,age:0,relevance:70,coveredBy:this.selectCoveringOutlets("political_analysis"),status:"active",week:n.gameState.time.week,year:n.gameState.time.year};this.publishStory(a,n.gameState)}formatEffects(n){const e=[];return n.approval&&e.push(`Approval ${n.approval>0?"+":""}${n.approval.toFixed(1)}%`),n.gdp&&e.push(`GDP ${n.gdp>0?"+":""}${n.gdp.toFixed(1)}%`),e.length>0?`Impact: ${e.join(", ")}`:""}getActiveStories(){return this.activeStories.slice()}getActiveScandals(){return this.scandals.filter(n=>"active"===n.status)}getMediaStatus(){return{mediaAttention:this.newsCycle.mediaAttention,activeStories:this.activeStories.length,activeScandals:this.getActiveScandals().length,publicOpinion:{...this.publicOpinion},trendingTopics:this.newsCycle.trendingTopics.slice()}}};class $ extends d{constructor(){super(),this.currentTab="overview",this.activeCrises=[],this.crisisHistory=[],this.responseQueue=[],this.gameState=null,this.initializeScreen()}initializeScreen(){this.setupEventListeners()}setupEventListeners(){t.on("media:scandal_triggered",n=>{this.handleCrisisTriggered(n.data)}),t.on("political:crisis_event",n=>{this.handlePoliticalCrisis(n.data)}),t.on("economic:crisis_event",n=>{this.handleEconomicCrisis(n.data)}),t.on("crisis:response_completed",n=>{this.handleCrisisResponse(n.data)})}handleCrisisTriggered(n){const e={id:n.scandal.id,type:"scandal",title:n.scandal.title,description:n.scandal.description,severity:n.scandal.severity,status:"active",triggeredWeek:n.gameState.time.week,triggeredYear:n.gameState.time.year,mediaAttention:n.scandal.impact.mediaAttention||0,publicConcern:(()=>{let e=0;return e="high"===n.scandal.severity?30:"medium"===n.scandal.severity?15:5,50+e})(),responseDeadline:n.gameState.time.week+2,availableResponses:this.getCrisisResponses(n.scandal)};this.activeCrises.push(e),this.refresh()}handlePoliticalCrisis(n){const e={id:`political_${Date.now()}`,type:"political",title:n.title||"Political Crisis",description:n.description||"A political crisis has emerged requiring immediate attention.",severity:n.severity||"medium",status:"active",triggeredWeek:n.gameState.time.week,triggeredYear:n.gameState.time.year,mediaAttention:n.impact?.mediaAttention||10,publicConcern:n.impact?.publicConcern||40,responseDeadline:n.gameState.time.week+1,availableResponses:this.getPoliticalCrisisResponses(n)};this.activeCrises.push(e),this.refresh()}handleEconomicCrisis(n){const e={id:`economic_${Date.now()}`,type:"economic",title:n.title||"Economic Crisis",description:n.description||"An economic crisis requires government intervention.",severity:n.severity||"medium",status:"active",triggeredWeek:n.gameState.time.week,triggeredYear:n.gameState.time.year,mediaAttention:n.impact?.mediaAttention||15,publicConcern:n.impact?.publicConcern||60,responseDeadline:n.gameState.time.week+3,availableResponses:this.getEconomicCrisisResponses(n)};this.activeCrises.push(e),this.refresh()}render(){return`\n      <div class="crisis-screen">\n        \x3c!-- Header --\x3e\n        <div class="crisis-header">\n          <div class="header-content">\n            <h1>🚨 Crisis Management Center</h1>\n            <p>Monitor and respond to political scandals, media crises, and emergency situations</p>\n          </div>\n          <div class="crisis-summary">\n            <div class="summary-metric">\n              <span class="metric-label">Active Crises</span>\n              <span class="metric-value" id="active-crises-count">${this.activeCrises.length}</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Response Queue</span>\n              <span class="metric-value" id="response-queue-count">${this.responseQueue.length}</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Public Concern</span>\n              <span class="metric-value" id="public-concern">--</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Tab Navigation --\x3e\n        <div class="crisis-tabs">\n          <button class="tab-btn ${"overview"===this.currentTab?"active":""}" data-tab="overview">\n            <span class="tab-icon">📊</span>\n            <span class="tab-text">Overview</span>\n          </button>\n          <button class="tab-btn ${"active"===this.currentTab?"active":""}" data-tab="active">\n            <span class="tab-icon">🚨</span>\n            <span class="tab-text">Active Crises</span>\n            ${this.activeCrises.length>0?`<span class="tab-badge">${this.activeCrises.length}</span>`:""}\n          </button>\n          <button class="tab-btn ${"responses"===this.currentTab?"active":""}" data-tab="responses">\n            <span class="tab-icon">💼</span>\n            <span class="tab-text">Response Center</span>\n          </button>\n          <button class="tab-btn ${"media"===this.currentTab?"active":""}" data-tab="media">\n            <span class="tab-icon">📺</span>\n            <span class="tab-text">Media Relations</span>\n          </button>\n          <button class="tab-btn ${"history"===this.currentTab?"active":""}" data-tab="history">\n            <span class="tab-icon">📋</span>\n            <span class="tab-text">Crisis History</span>\n          </button>\n        </div>\n\n        \x3c!-- Tab Content --\x3e\n        <div class="crisis-content">\n          <div class="tab-content ${"overview"===this.currentTab?"active":""}" id="tab-overview">\n            ${this.renderOverviewTab()}\n          </div>\n          <div class="tab-content ${"active"===this.currentTab?"active":""}" id="tab-active">\n            ${this.renderActiveCrisesTab()}\n          </div>\n          <div class="tab-content ${"responses"===this.currentTab?"active":""}" id="tab-responses">\n            ${this.renderResponseCenterTab()}\n          </div>\n          <div class="tab-content ${"media"===this.currentTab?"active":""}" id="tab-media">\n            ${this.renderMediaRelationsTab()}\n          </div>\n          <div class="tab-content ${"history"===this.currentTab?"active":""}" id="tab-history">\n            ${this.renderHistoryTab()}\n          </div>\n        </div>\n\n        <style>\n        .crisis-screen {\n          padding: var(--spacing-lg);\n          max-width: 1400px;\n          margin: 0 auto;\n        }\n\n        .crisis-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: var(--spacing-xl);\n          padding: var(--spacing-xl);\n          background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n          border-radius: var(--border-radius-lg);\n          color: white;\n          box-shadow: var(--shadow-lg);\n        }\n\n        .header-content h1 {\n          margin: 0 0 var(--spacing-sm) 0;\n          font-size: 2rem;\n          font-weight: 700;\n        }\n\n        .header-content p {\n          margin: 0;\n          opacity: 0.9;\n          font-size: 1rem;\n          line-height: 1.5;\n        }\n\n        .crisis-summary {\n          display: flex;\n          gap: var(--spacing-lg);\n        }\n\n        .summary-metric {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          text-align: center;\n          min-width: 120px;\n        }\n\n        .metric-label {\n          font-size: 0.875rem;\n          opacity: 0.8;\n          margin-bottom: var(--spacing-xs);\n          font-weight: 500;\n        }\n\n        .metric-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n        }\n\n        .crisis-tabs {\n          display: flex;\n          gap: 0;\n          margin-bottom: var(--spacing-lg);\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xs);\n          box-shadow: var(--shadow-sm);\n          border: 1px solid var(--border-color);\n          overflow-x: auto;\n        }\n\n        .tab-btn {\n          flex: 1;\n          min-width: 120px;\n          padding: var(--spacing-md) var(--spacing-lg);\n          border: none;\n          background: none;\n          color: var(--text-light);\n          font-weight: 500;\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: var(--spacing-sm);\n          position: relative;\n          white-space: nowrap;\n        }\n\n        .tab-btn:hover {\n          background: var(--background-alt);\n          color: var(--text-color);\n        }\n\n        .tab-btn.active {\n          background: var(--accent-color);\n          color: white;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .tab-icon {\n          font-size: 1.2rem;\n        }\n\n        .tab-badge {\n          position: absolute;\n          top: -5px;\n          right: -5px;\n          background: var(--warning-color);\n          color: white;\n          border-radius: 50%;\n          min-width: 20px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 0.75rem;\n          font-weight: bold;\n        }\n\n        .crisis-content {\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          box-shadow: var(--shadow-md);\n          border: 1px solid var(--border-color);\n          min-height: 600px;\n        }\n\n        .tab-content {\n          display: none;\n          padding: var(--spacing-xl);\n          animation: fadeInUp 0.3s ease-out;\n        }\n\n        .tab-content.active {\n          display: block;\n        }\n\n        .crisis-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n          gap: var(--spacing-lg);\n        }\n\n        .crisis-panel {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n        }\n\n        .crisis-panel h3 {\n          margin: 0 0 var(--spacing-md) 0;\n          color: var(--primary-color);\n          font-size: 1.2rem;\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-sm);\n        }\n\n        .crisis-item {\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n          margin-bottom: var(--spacing-md);\n          transition: all var(--transition-base);\n        }\n\n        .crisis-item:hover {\n          border-color: var(--accent-color);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .crisis-header-info {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .crisis-title {\n          font-weight: 600;\n          color: var(--text-color);\n          font-size: 1.1rem;\n          margin-bottom: var(--spacing-xs);\n        }\n\n        .crisis-type {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius-sm);\n          font-size: 0.75rem;\n          font-weight: 500;\n          text-transform: uppercase;\n        }\n\n        .crisis-scandal {\n          background: var(--accent-color);\n          color: white;\n        }\n\n        .crisis-political {\n          background: var(--warning-color);\n          color: white;\n        }\n\n        .crisis-economic {\n          background: var(--info-color);\n          color: white;\n        }\n\n        .crisis-description {\n          color: var(--text-light);\n          line-height: 1.5;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .crisis-metrics {\n          display: grid;\n          grid-template-columns: repeat(3, 1fr);\n          gap: var(--spacing-md);\n          margin-bottom: var(--spacing-md);\n        }\n\n        .crisis-metric {\n          text-align: center;\n        }\n\n        .metric-value {\n          font-size: 1.2rem;\n          font-weight: 700;\n          color: var(--secondary-color);\n          display: block;\n        }\n\n        .metric-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n          margin-top: var(--spacing-xs);\n        }\n\n        .response-actions {\n          display: flex;\n          gap: var(--spacing-sm);\n          flex-wrap: wrap;\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: var(--spacing-xxl);\n          color: var(--text-light);\n        }\n\n        .empty-state-icon {\n          font-size: 4rem;\n          margin-bottom: var(--spacing-lg);\n          opacity: 0.5;\n        }\n\n        .empty-state h3 {\n          margin-bottom: var(--spacing-sm);\n          color: var(--text-color);\n        }\n\n        @media (max-width: 768px) {\n          .crisis-header {\n            flex-direction: column;\n            gap: var(--spacing-lg);\n            text-align: center;\n          }\n\n          .crisis-summary {\n            flex-direction: column;\n            gap: var(--spacing-md);\n            width: 100%;\n          }\n\n          .crisis-tabs {\n            overflow-x: auto;\n            padding: var(--spacing-xs);\n          }\n\n          .tab-btn {\n            min-width: 100px;\n            padding: var(--spacing-sm);\n          }\n\n          .tab-text {\n            display: none;\n          }\n\n          .crisis-grid {\n            grid-template-columns: 1fr;\n          }\n        }\n        </style>\n      </div>\n    `}renderOverviewTab(){const n=this.activeCrises.length+this.crisisHistory.length,e=this.activeCrises.filter(n=>"high"===n.severity).length,t=this.calculateAverageResponseTime();return`\n      <div class="crisis-grid">\n        <div class="crisis-panel">\n          <h3>🚨 Crisis Status Overview</h3>\n          <div class="overview-stats">\n            <div class="stat-item">\n              <div class="stat-number">${this.activeCrises.length}</div>\n              <div class="stat-label">Active Crises</div>\n            </div>\n            <div class="stat-item">\n              <div class="stat-number">${e}</div>\n              <div class="stat-label">Urgent (High Severity)</div>\n            </div>\n            <div class="stat-item">\n              <div class="stat-number">${n}</div>\n              <div class="stat-label">Total This Term</div>\n            </div>\n            <div class="stat-item">\n              <div class="stat-number">${t}h</div>\n              <div class="stat-label">Avg Response Time</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="crisis-panel">\n          <h3>📊 Public Opinion Impact</h3>\n          <div class="opinion-chart">\n            <div class="opinion-metric">\n              <span class="opinion-label">Media Pressure</span>\n              <div class="opinion-bar">\n                <div class="opinion-fill" style="width: ${this.calculateMediaPressure()}%"></div>\n              </div>\n              <span class="opinion-value">${this.calculateMediaPressure()}%</span>\n            </div>\n            <div class="opinion-metric">\n              <span class="opinion-label">Public Concern</span>\n              <div class="opinion-bar">\n                <div class="opinion-fill" style="width: ${this.calculatePublicConcern()}%"></div>\n              </div>\n              <span class="opinion-value">${this.calculatePublicConcern()}%</span>\n            </div>\n            <div class="opinion-metric">\n              <span class="opinion-label">Crisis Fatigue</span>\n              <div class="opinion-bar">\n                <div class="opinion-fill" style="width: ${this.calculateCrisisFatigue()}%"></div>\n              </div>\n              <span class="opinion-value">${this.calculateCrisisFatigue()}%</span>\n            </div>\n          </div>\n        </div>\n\n        <div class="crisis-panel">\n          <h3>⚡ Immediate Actions Required</h3>\n          <div class="urgent-actions">\n            ${this.renderUrgentActions()}\n          </div>\n        </div>\n\n        <div class="crisis-panel">\n          <h3>📈 Crisis Trends</h3>\n          <div class="trends-chart">\n            ${this.renderCrisisTrends()}\n          </div>\n        </div>\n      </div>\n    `}renderActiveCrisesTab(){return 0===this.activeCrises.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">✅</div>\n          <h3>No Active Crises</h3>\n          <p>Your government is currently crisis-free. Stay vigilant for potential issues.</p>\n        </div>\n      ':`\n      <div class="active-crises-list">\n        ${this.activeCrises.map(n=>this.renderCrisisCard(n)).join("")}\n      </div>\n    `}renderCrisisCard(n){const e=n.responseDeadline-(this.gameState?.time?.week||0),t=e<=1;return`\n      <div class="crisis-item ${t?"crisis-urgent":""}">\n        <div class="crisis-header-info">\n          <div>\n            <div class="crisis-title">${n.title}</div>\n            <span class="crisis-type crisis-${n.type}">${n.type}</span>\n          </div>\n          <div class="crisis-deadline">\n            <strong>${e} weeks</strong>\n            <span>to respond</span>\n          </div>\n        </div>\n        \n        <div class="crisis-description">${n.description}</div>\n        \n        <div class="crisis-metrics">\n          <div class="crisis-metric">\n            <span class="metric-value">${n.severity}</span>\n            <span class="metric-label">Severity</span>\n          </div>\n          <div class="crisis-metric">\n            <span class="metric-value">${n.mediaAttention}</span>\n            <span class="metric-label">Media Attention</span>\n          </div>\n          <div class="crisis-metric">\n            <span class="metric-value">${n.publicConcern}%</span>\n            <span class="metric-label">Public Concern</span>\n          </div>\n        </div>\n        \n        <div class="response-actions">\n          <button class="btn btn--primary" onclick="handleCrisisResponse('${n.id}')">\n            📋 View Response Options\n          </button>\n          <button class="btn btn--secondary" onclick="showCrisisDetails('${n.id}')">\n            📊 Detailed Analysis\n          </button>\n          ${t?'<button class="btn btn--danger">⚡ Urgent Response</button>':""}\n        </div>\n      </div>\n    `}renderResponseCenterTab(){return'\n      <div class="response-center">\n        <div class="response-grid">\n          <div class="response-panel">\n            <h3>🎯 Response Strategies</h3>\n            <div class="strategy-list">\n              <div class="strategy-item">\n                <div class="strategy-header">\n                  <h4>📢 Public Statement</h4>\n                  <span class="strategy-effectiveness">Effectiveness: 70%</span>\n                </div>\n                <p>Make a direct public statement addressing the crisis and outlining government position.</p>\n                <div class="strategy-effects">\n                  <span class="effect-positive">+Transparency</span>\n                  <span class="effect-negative">-Privacy</span>\n                </div>\n              </div>\n\n              <div class="strategy-item">\n                <div class="strategy-header">\n                  <h4>🔍 Internal Investigation</h4>\n                  <span class="strategy-effectiveness">Effectiveness: 80%</span>\n                </div>\n                <p>Launch internal investigation to gather facts before public response.</p>\n                <div class="strategy-effects">\n                  <span class="effect-positive">+Credibility</span>\n                  <span class="effect-negative">-Response Speed</span>\n                </div>\n              </div>\n\n              <div class="strategy-item">\n                <div class="strategy-header">\n                  <h4>👥 Scapegoating</h4>\n                  <span class="strategy-effectiveness">Effectiveness: 60%</span>\n                </div>\n                <p>Assign responsibility to specific individuals to protect broader government.</p>\n                <div class="strategy-effects">\n                  <span class="effect-positive">+Damage Control</span>\n                  <span class="effect-negative">-Staff Loyalty</span>\n                </div>\n              </div>\n\n              <div class="strategy-item">\n                <div class="strategy-header">\n                  <h4>🤐 Strategic Silence</h4>\n                  <span class="strategy-effectiveness">Effectiveness: 40%</span>\n                </div>\n                <p>Avoid commenting publicly and let the crisis fade naturally.</p>\n                <div class="strategy-effects">\n                  <span class="effect-positive">+Political Capital</span>\n                  <span class="effect-negative">-Media Relations</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="response-panel">\n            <h3>📞 Communication Tools</h3>\n            <div class="communication-tools">\n              <button class="tool-btn">\n                <span class="tool-icon">📺</span>\n                <span class="tool-name">Press Conference</span>\n                <span class="tool-cost">High Impact</span>\n              </button>\n              <button class="tool-btn">\n                <span class="tool-icon">📰</span>\n                <span class="tool-name">Press Release</span>\n                <span class="tool-cost">Medium Impact</span>\n              </button>\n              <button class="tool-btn">\n                <span class="tool-icon">📱</span>\n                <span class="tool-name">Social Media</span>\n                <span class="tool-cost">Quick Response</span>\n              </button>\n              <button class="tool-btn">\n                <span class="tool-icon">📞</span>\n                <span class="tool-name">Private Briefing</span>\n                <span class="tool-cost">Targeted</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderMediaRelationsTab(){const n=E.getMediaStatus();return`\n      <div class="media-relations">\n        <div class="media-grid">\n          <div class="media-panel">\n            <h3>📺 Media Landscape</h3>\n            <div class="media-metrics">\n              <div class="media-metric">\n                <span class="metric-value">${n.mediaAttention}%</span>\n                <span class="metric-label">Media Attention</span>\n              </div>\n              <div class="media-metric">\n                <span class="metric-value">${n.activeStories}</span>\n                <span class="metric-label">Active Stories</span>\n              </div>\n              <div class="media-metric">\n                <span class="metric-value">${n.publicOpinion.trustInMedia}%</span>\n                <span class="metric-label">Trust in Media</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="media-panel">\n            <h3>📰 Active Media Stories</h3>\n            <div class="media-stories">\n              ${this.renderMediaStories(n.activeStories)}\n            </div>\n          </div>\n\n          <div class="media-panel">\n            <h3>🎯 Media Strategy</h3>\n            <div class="media-strategy">\n              <button class="strategy-btn">📝 Craft Narrative</button>\n              <button class="strategy-btn">🤝 Build Relationships</button>\n              <button class="strategy-btn">📊 Monitor Coverage</button>\n              <button class="strategy-btn">⚡ Rapid Response</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderHistoryTab(){return 0===this.crisisHistory.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">📋</div>\n          <h3>No Crisis History</h3>\n          <p>Historical crisis data will appear here as you manage and resolve crises.</p>\n        </div>\n      ':`\n      <div class="crisis-history">\n        <div class="history-stats">\n          <h3>📊 Historical Performance</h3>\n          <div class="performance-metrics">\n            <div class="performance-item">\n              <span class="performance-value">${this.crisisHistory.length}</span>\n              <span class="performance-label">Total Crises Handled</span>\n            </div>\n            <div class="performance-item">\n              <span class="performance-value">${this.calculateSuccessRate()}%</span>\n              <span class="performance-label">Success Rate</span>\n            </div>\n            <div class="performance-item">\n              <span class="performance-value">${this.calculateAverageResponseTime()}</span>\n              <span class="performance-label">Avg Response Time</span>\n            </div>\n          </div>\n        </div>\n\n        <div class="history-list">\n          ${this.crisisHistory.map(n=>this.renderHistoricalCrisis(n)).join("")}\n        </div>\n      </div>\n    `}calculateMediaPressure(){const n=E.getMediaStatus();return Math.min(100,n.mediaAttention+10*this.activeCrises.length)}calculatePublicConcern(){return 0===this.activeCrises.length?20:Math.min(100,this.activeCrises.reduce((n,e)=>n+e.publicConcern,0)/this.activeCrises.length)}calculateCrisisFatigue(){return Math.min(100,2*this.crisisHistory.length+5*this.activeCrises.length)}calculateAverageResponseTime(){if(0===this.crisisHistory.length)return 0;const n=this.crisisHistory.reduce((n,e)=>n+(e.responseTime||24),0);return Math.round(n/this.crisisHistory.length)}calculateSuccessRate(){if(0===this.crisisHistory.length)return 0;const n=this.crisisHistory.filter(n=>"resolved"===n.outcome).length;return Math.round(n/this.crisisHistory.length*100)}renderUrgentActions(){const n=this.activeCrises.filter(n=>n.responseDeadline-(this.gameState?.time?.week||0)<=1||"high"===n.severity);return 0===n.length?'<p class="no-urgent">No urgent actions required at this time.</p>':n.map(n=>`\n      <div class="urgent-action">\n        <div class="urgent-title">${n.title}</div>\n        <div class="urgent-deadline">Deadline: ${n.responseDeadline-(this.gameState?.time?.week||0)} weeks</div>\n        <button class="btn btn--danger btn--sm" onclick="handleCrisisResponse('${n.id}')">\n          Act Now\n        </button>\n      </div>\n    `).join("")}renderCrisisTrends(){return'\n      <div class="trends-placeholder">\n        <p>Crisis trend analysis coming soon...</p>\n      </div>\n    '}renderMediaStories(n){return n&&0!==n.length?n.slice(0,5).map(n=>`\n      <div class="story-item">\n        <div class="story-headline">${n.headline}</div>\n        <div class="story-outlet">${n.outlet||"Various Outlets"}</div>\n      </div>\n    `).join(""):'<p class="no-stories">No active media stories</p>'}renderHistoricalCrisis(n){return`\n      <div class="history-item">\n        <div class="history-header">\n          <span class="history-title">${n.title}</span>\n          <span class="history-outcome ${n.outcome}">${n.outcome}</span>\n        </div>\n        <div class="history-details">\n          <span>Response: ${n.response||"Unknown"}</span>\n          <span>Duration: ${n.duration||"N/A"} weeks</span>\n        </div>\n      </div>\n    `}getCrisisResponses(n){return[{id:"deny",name:"Deny Allegations",effectiveness:40,risk:"high"},{id:"investigate",name:"Launch Investigation",effectiveness:75,risk:"medium"},{id:"acknowledge",name:"Acknowledge & Reform",effectiveness:85,risk:"low"},{id:"ignore",name:"No Comment",effectiveness:30,risk:"high"}]}getPoliticalCrisisResponses(n){return[{id:"negotiate",name:"Negotiate Compromise",effectiveness:70,risk:"medium"},{id:"confront",name:"Direct Confrontation",effectiveness:60,risk:"high"},{id:"concede",name:"Make Concessions",effectiveness:80,risk:"low"},{id:"delay",name:"Delay Decision",effectiveness:40,risk:"medium"}]}getEconomicCrisisResponses(n){return[{id:"stimulus",name:"Economic Stimulus",effectiveness:75,risk:"medium"},{id:"cuts",name:"Budget Cuts",effectiveness:60,risk:"high"},{id:"reform",name:"Structural Reform",effectiveness:85,risk:"low"},{id:"wait",name:"Wait and Monitor",effectiveness:45,risk:"high"}]}setupInteractivity(){const n=document.querySelector(".crisis-screen");n&&(n.querySelectorAll(".tab-btn").forEach(n=>{n.addEventListener("click",()=>{const e=n.getAttribute("data-tab");this.switchTab(e)})}),window.handleCrisisResponse=n=>{this.showCrisisResponseModal(n)},window.showCrisisDetails=n=>{this.showCrisisDetailsModal(n)})}switchTab(n){this.currentTab=n,this.refresh()}showCrisisResponseModal(n){const e=this.activeCrises.find(e=>e.id===n);e&&(new u({title:`🚨 Crisis Response: ${e.title}`,content:`\n        <div class="crisis-response-modal">\n          <div class="crisis-situation">\n            <h4>Current Situation:</h4>\n            <p>${e.description}</p>\n            <div class="situation-metrics">\n              <span>Severity: <strong>${e.severity}</strong></span>\n              <span>Public Concern: <strong>${e.publicConcern}%</strong></span>\n              <span>Time Remaining: <strong>${e.responseDeadline-(this.gameState?.time?.week||0)} weeks</strong></span>\n            </div>\n          </div>\n\n          <div class="response-options">\n            <h4>Available Responses:</h4>\n            <div class="options-list">\n              ${e.availableResponses.map(n=>`\n                <div class="response-option" data-response="${n.id}">\n                  <div class="response-name">${n.name}</div>\n                  <div class="response-stats">\n                    <span class="effectiveness">Effectiveness: ${n.effectiveness}%</span>\n                    <span class="risk risk-${n.risk}">Risk: ${n.risk}</span>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n          </div>\n        </div>\n      `,confirmText:"Execute Response",onConfirm:()=>{const e=document.querySelector(".response-option.selected");if(e){const t=e.getAttribute("data-response");return this.executeCrisisResponse(n,t),!0}return!1}}).show(),setTimeout(()=>{const n=document.querySelectorAll(".response-option");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected")})})},100))}executeCrisisResponse(n,e){const i=this.activeCrises.find(e=>e.id===n);if(!i)return;const a=i.availableResponses.find(n=>n.id===e);a&&(this.activeCrises=this.activeCrises.filter(e=>e.id!==n),i.response=e,i.outcome=Math.random()<a.effectiveness/100?"resolved":"escalated",i.responseTime=48*Math.random()+12,i.duration=Math.ceil(4*Math.random())+1,this.crisisHistory.push(i),t.emit("crisis:response_executed",{crisis:i,response:e,effectiveness:a.effectiveness,gameState:this.gameState}),this.refresh(),this.showNotification(`Crisis response executed: ${a.name}`,"success"))}showNotification(n,e="info"){window.spSimApp&&window.spSimApp.showNotification(n,e)}update(n){this.gameState=n,this.activeCrises.forEach(e=>{e.responseDeadline-n.time.week<=0&&(e.status="escalated",e.publicConcern+=20,e.mediaAttention+=10)}),this.refresh()}refresh(){const n=document.querySelector("#screen-crisis .crisis-screen");n&&(n.innerHTML=this.render().replace(/<div class="crisis-screen">|<\/div>$/g,""),this.setupInteractivity())}show(){const n=document.querySelector("#screen-crisis");return n&&!n.querySelector(".crisis-screen")&&(n.innerHTML=this.render(),this.setupInteractivity()),this.element}}class T extends d{constructor(){super(),this.currentTab="overview",this.diplomaticRelations=this.initializeDiplomaticRelations(),this.tradeAgreements=[],this.internationalEvents=[],this.gameState=null,this.initializeScreen()}initializeScreen(){this.setupEventListeners()}setupEventListeners(){t.on("international:event_triggered",n=>{this.handleInternationalEvent(n.data)}),t.on("diplomacy:relation_changed",n=>{this.updateDiplomaticRelation(n.data)}),t.on("trade:agreement_signed",n=>{this.handleTradeAgreement(n.data)})}initializeDiplomaticRelations(){return[{country:"United States",flag:"🇺🇸",relation:75,status:"Friendly",tradeVolume:45e9,lastInteraction:"Trade summit",interests:["Trade","Security","Technology"],diplomaticEvents:[]},{country:"European Union",flag:"🇪🇺",relation:82,status:"Allied",tradeVolume:52e9,lastInteraction:"Climate agreement",interests:["Environment","Trade","Human Rights"],diplomaticEvents:[]},{country:"China",flag:"🇨🇳",relation:45,status:"Neutral",tradeVolume:38e9,lastInteraction:"Border dispute",interests:["Trade","Resources","Technology"],diplomaticEvents:[]},{country:"Russia",flag:"🇷🇺",relation:35,status:"Tense",tradeVolume:15e9,lastInteraction:"Sanctions discussion",interests:["Energy","Security","Territory"],diplomaticEvents:[]},{country:"United Kingdom",flag:"🇬🇧",relation:88,status:"Allied",tradeVolume:28e9,lastInteraction:"Defense cooperation",interests:["Trade","Security","History"],diplomaticEvents:[]},{country:"Japan",flag:"🇯🇵",relation:78,status:"Friendly",tradeVolume:22e9,lastInteraction:"Technology partnership",interests:["Technology","Trade","Security"],diplomaticEvents:[]}]}render(){return`\n      <div class="global-screen">\n        \x3c!-- Header --\x3e\n        <div class="global-header">\n          <div class="header-content">\n            <h1>🌍 Global Relations</h1>\n            <p>Manage international diplomacy, trade relations, and global partnerships</p>\n          </div>\n          <div class="global-summary">\n            <div class="summary-metric">\n              <span class="metric-label">Diplomatic Score</span>\n              <span class="metric-value" id="diplomatic-score">${this.calculateDiplomaticScore()}</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Trade Volume</span>\n              <span class="metric-value" id="trade-volume">$${this.calculateTotalTrade()}B</span>\n            </div>\n            <div class="summary-metric">\n              <span class="metric-label">Active Agreements</span>\n              <span class="metric-value" id="active-agreements">${this.tradeAgreements.length}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Tab Navigation --\x3e\n        <div class="global-tabs">\n          <button class="tab-btn ${"overview"===this.currentTab?"active":""}" data-tab="overview">\n            <span class="tab-icon">🌍</span>\n            <span class="tab-text">Overview</span>\n          </button>\n          <button class="tab-btn ${"diplomacy"===this.currentTab?"active":""}" data-tab="diplomacy">\n            <span class="tab-icon">🤝</span>\n            <span class="tab-text">Diplomacy</span>\n          </button>\n          <button class="tab-btn ${"trade"===this.currentTab?"active":""}" data-tab="trade">\n            <span class="tab-icon">📊</span>\n            <span class="tab-text">Trade</span>\n          </button>\n          <button class="tab-btn ${"events"===this.currentTab?"active":""}" data-tab="events">\n            <span class="tab-icon">📰</span>\n            <span class="tab-text">Global Events</span>\n            ${this.internationalEvents.length>0?`<span class="tab-badge">${this.internationalEvents.length}</span>`:""}\n          </button>\n          <button class="tab-btn ${"intelligence"===this.currentTab?"active":""}" data-tab="intelligence">\n            <span class="tab-icon">🔍</span>\n            <span class="tab-text">Intelligence</span>\n          </button>\n        </div>\n\n        \x3c!-- Tab Content --\x3e\n        <div class="global-content">\n          <div class="tab-content ${"overview"===this.currentTab?"active":""}" id="tab-overview">\n            ${this.renderOverviewTab()}\n          </div>\n          <div class="tab-content ${"diplomacy"===this.currentTab?"active":""}" id="tab-diplomacy">\n            ${this.renderDiplomacyTab()}\n          </div>\n          <div class="tab-content ${"trade"===this.currentTab?"active":""}" id="tab-trade">\n            ${this.renderTradeTab()}\n          </div>\n          <div class="tab-content ${"events"===this.currentTab?"active":""}" id="tab-events">\n            ${this.renderEventsTab()}\n          </div>\n          <div class="tab-content ${"intelligence"===this.currentTab?"active":""}" id="tab-intelligence">\n            ${this.renderIntelligenceTab()}\n          </div>\n        </div>\n\n        <style>\n        .global-screen {\n          padding: var(--spacing-lg);\n          max-width: 1400px;\n          margin: 0 auto;\n        }\n\n        .global-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: var(--spacing-xl);\n          padding: var(--spacing-xl);\n          background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);\n          border-radius: var(--border-radius-lg);\n          color: white;\n          box-shadow: var(--shadow-lg);\n        }\n\n        .header-content h1 {\n          margin: 0 0 var(--spacing-sm) 0;\n          font-size: 2rem;\n          font-weight: 700;\n        }\n\n        .header-content p {\n          margin: 0;\n          opacity: 0.9;\n          font-size: 1rem;\n          line-height: 1.5;\n        }\n\n        .global-summary {\n          display: flex;\n          gap: var(--spacing-lg);\n        }\n\n        .summary-metric {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          text-align: center;\n          min-width: 120px;\n        }\n\n        .metric-label {\n          font-size: 0.875rem;\n          opacity: 0.8;\n          margin-bottom: var(--spacing-xs);\n          font-weight: 500;\n        }\n\n        .metric-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n        }\n\n        .global-tabs {\n          display: flex;\n          gap: 0;\n          margin-bottom: var(--spacing-lg);\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          padding: var(--spacing-xs);\n          box-shadow: var(--shadow-sm);\n          border: 1px solid var(--border-color);\n          overflow-x: auto;\n        }\n\n        .tab-btn {\n          flex: 1;\n          min-width: 120px;\n          padding: var(--spacing-md) var(--spacing-lg);\n          border: none;\n          background: none;\n          color: var(--text-light);\n          font-weight: 500;\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: var(--spacing-sm);\n          position: relative;\n          white-space: nowrap;\n        }\n\n        .tab-btn:hover {\n          background: var(--background-alt);\n          color: var(--text-color);\n        }\n\n        .tab-btn.active {\n          background: var(--secondary-color);\n          color: white;\n          box-shadow: var(--shadow-sm);\n        }\n\n        .tab-icon {\n          font-size: 1.2rem;\n        }\n\n        .tab-badge {\n          position: absolute;\n          top: -5px;\n          right: -5px;\n          background: var(--accent-color);\n          color: white;\n          border-radius: 50%;\n          min-width: 20px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 0.75rem;\n          font-weight: bold;\n        }\n\n        .global-content {\n          background: var(--surface-color);\n          border-radius: var(--border-radius-lg);\n          box-shadow: var(--shadow-md);\n          border: 1px solid var(--border-color);\n          min-height: 600px;\n        }\n\n        .tab-content {\n          display: none;\n          padding: var(--spacing-xl);\n          animation: fadeInUp 0.3s ease-out;\n        }\n\n        .tab-content.active {\n          display: block;\n        }\n\n        .global-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n          gap: var(--spacing-lg);\n        }\n\n        .global-panel {\n          background: var(--background-alt);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n        }\n\n        .global-panel h3 {\n          margin: 0 0 var(--spacing-md) 0;\n          color: var(--primary-color);\n          font-size: 1.2rem;\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-sm);\n        }\n\n        .country-card {\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n          margin-bottom: var(--spacing-md);\n          transition: all var(--transition-base);\n          cursor: pointer;\n        }\n\n        .country-card:hover {\n          border-color: var(--secondary-color);\n          box-shadow: var(--shadow-sm);\n        }\n\n        .country-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .country-info {\n          display: flex;\n          align-items: center;\n          gap: var(--spacing-md);\n        }\n\n        .country-flag {\n          font-size: 2rem;\n        }\n\n        .country-name {\n          font-weight: 600;\n          font-size: 1.1rem;\n          color: var(--text-color);\n        }\n\n        .relation-score {\n          font-size: 1.2rem;\n          font-weight: 700;\n          padding: var(--spacing-sm) var(--spacing-md);\n          border-radius: var(--border-radius);\n          color: white;\n        }\n\n        .relation-excellent { background: var(--success-color); }\n        .relation-good { background: var(--info-color); }\n        .relation-neutral { background: var(--warning-color); }\n        .relation-poor { background: var(--accent-color); }\n\n        .country-details {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: var(--spacing-md);\n          margin-bottom: var(--spacing-md);\n        }\n\n        .detail-item {\n          text-align: center;\n        }\n\n        .detail-value {\n          font-weight: 600;\n          color: var(--secondary-color);\n          display: block;\n          font-size: 1.1rem;\n        }\n\n        .detail-label {\n          font-size: 0.875rem;\n          color: var(--text-light);\n          margin-top: var(--spacing-xs);\n        }\n\n        .country-interests {\n          display: flex;\n          gap: var(--spacing-sm);\n          flex-wrap: wrap;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .interest-tag {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          background: var(--border-light);\n          border-radius: var(--border-radius-sm);\n          font-size: 0.875rem;\n          color: var(--text-color);\n        }\n\n        .country-actions {\n          display: flex;\n          gap: var(--spacing-sm);\n          flex-wrap: wrap;\n        }\n\n        .diplomatic-action {\n          padding: var(--spacing-sm) var(--spacing-md);\n          border: 1px solid var(--border-color);\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          cursor: pointer;\n          transition: all var(--transition-base);\n          font-size: 0.875rem;\n        }\n\n        .diplomatic-action:hover {\n          background: var(--secondary-color);\n          color: white;\n          border-color: var(--secondary-color);\n        }\n\n        .trade-agreement {\n          background: var(--surface-color);\n          border-radius: var(--border-radius);\n          padding: var(--spacing-lg);\n          border: 1px solid var(--border-color);\n          margin-bottom: var(--spacing-md);\n        }\n\n        .agreement-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: var(--spacing-md);\n        }\n\n        .agreement-title {\n          font-weight: 600;\n          color: var(--text-color);\n        }\n\n        .agreement-status {\n          padding: var(--spacing-xs) var(--spacing-sm);\n          border-radius: var(--border-radius-sm);\n          font-size: 0.75rem;\n          font-weight: 500;\n          text-transform: uppercase;\n        }\n\n        .status-active { background: var(--success-color); color: white; }\n        .status-pending { background: var(--warning-color); color: white; }\n        .status-expired { background: var(--text-light); color: white; }\n\n        .empty-state {\n          text-align: center;\n          padding: var(--spacing-xxl);\n          color: var(--text-light);\n        }\n\n        .empty-state-icon {\n          font-size: 4rem;\n          margin-bottom: var(--spacing-lg);\n          opacity: 0.5;\n        }\n\n        .empty-state h3 {\n          margin-bottom: var(--spacing-sm);\n          color: var(--text-color);\n        }\n\n        @media (max-width: 768px) {\n          .global-header {\n            flex-direction: column;\n            gap: var(--spacing-lg);\n            text-align: center;\n          }\n\n          .global-summary {\n            flex-direction: column;\n            gap: var(--spacing-md);\n            width: 100%;\n          }\n\n          .global-tabs {\n            overflow-x: auto;\n            padding: var(--spacing-xs);\n          }\n\n          .tab-btn {\n            min-width: 100px;\n            padding: var(--spacing-sm);\n          }\n\n          .tab-text {\n            display: none;\n          }\n\n          .global-grid {\n            grid-template-columns: 1fr;\n          }\n\n          .country-details {\n            grid-template-columns: 1fr;\n          }\n        }\n        </style>\n      </div>\n    `}renderOverviewTab(){const n=this.calculateRelationshipStatus(),e=this.calculateTradeBalance();return`\n      <div class="global-grid">\n        <div class="global-panel">\n          <h3>🌐 Global Standing</h3>\n          <div class="standing-metrics">\n            <div class="standing-item">\n              <div class="standing-value">${this.calculateDiplomaticScore()}</div>\n              <div class="standing-label">Diplomatic Score</div>\n            </div>\n            <div class="standing-item">\n              <div class="standing-value">${n.positive}</div>\n              <div class="standing-label">Positive Relations</div>\n            </div>\n            <div class="standing-item">\n              <div class="standing-value">${n.neutral}</div>\n              <div class="standing-label">Neutral Relations</div>\n            </div>\n            <div class="standing-item">\n              <div class="standing-value">${n.negative}</div>\n              <div class="standing-label">Tense Relations</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="global-panel">\n          <h3>💰 Economic Relations</h3>\n          <div class="economic-overview">\n            <div class="economic-metric">\n              <span class="metric-label">Total Trade Volume</span>\n              <span class="metric-value">$${this.calculateTotalTrade()}B</span>\n            </div>\n            <div class="economic-metric">\n              <span class="metric-label">Trade Balance</span>\n              <span class="metric-value ${e>=0?"positive":"negative"}">\n                ${e>=0?"+":""}$${e.toFixed(1)}B\n              </span>\n            </div>\n            <div class="economic-metric">\n              <span class="metric-label">Active Agreements</span>\n              <span class="metric-value">${this.tradeAgreements.length}</span>\n            </div>\n          </div>\n        </div>\n\n        <div class="global-panel">\n          <h3>🎯 Priority Actions</h3>\n          <div class="priority-actions">\n            ${this.renderPriorityActions()}\n          </div>\n        </div>\n\n        <div class="global-panel">\n          <h3>📈 Recent Developments</h3>\n          <div class="recent-developments">\n            ${this.renderRecentDevelopments()}\n          </div>\n        </div>\n      </div>\n    `}renderDiplomacyTab(){return`\n      <div class="diplomacy-section">\n        <div class="countries-list">\n          ${this.diplomaticRelations.map(n=>this.renderCountryCard(n)).join("")}\n        </div>\n      </div>\n    `}renderCountryCard(n){const e=this.getRelationClass(n.relation);return`\n      <div class="country-card" onclick="showDiplomaticOptions('${n.country}')">\n        <div class="country-header">\n          <div class="country-info">\n            <span class="country-flag">${n.flag}</span>\n            <div>\n              <div class="country-name">${n.country}</div>\n              <div class="country-status">${n.status}</div>\n            </div>\n          </div>\n          <div class="relation-score ${e}">${n.relation}</div>\n        </div>\n\n        <div class="country-details">\n          <div class="detail-item">\n            <span class="detail-value">$${(n.tradeVolume/1e9).toFixed(1)}B</span>\n            <span class="detail-label">Trade Volume</span>\n          </div>\n          <div class="detail-item">\n            <span class="detail-value">${n.lastInteraction}</span>\n            <span class="detail-label">Last Interaction</span>\n          </div>\n        </div>\n\n        <div class="country-interests">\n          ${n.interests.map(n=>`<span class="interest-tag">${n}</span>`).join("")}\n        </div>\n\n        <div class="country-actions">\n          <div class="diplomatic-action" onclick="event.stopPropagation(); initiateDiplomacy('${n.country}', 'summit')">\n            🤝 Summit\n          </div>\n          <div class="diplomatic-action" onclick="event.stopPropagation(); initiateDiplomacy('${n.country}', 'trade')">\n            📊 Trade Deal\n          </div>\n          <div class="diplomatic-action" onclick="event.stopPropagation(); initiateDiplomacy('${n.country}', 'cooperation')">\n            🌟 Cooperation\n          </div>\n        </div>\n      </div>\n    `}renderTradeTab(){return`\n      <div class="trade-section">\n      <div class="trade-overview">\n        <div class="global-panel">\n        <h3>📊 Trade Overview</h3>\n        <div class="trade-stats">\n          <div class="trade-stat">\n          <span class="stat-value">$${this.calculateTotalTrade()}B</span>\n          <span class="stat-label">Total Trade Volume</span>\n          </div>\n          <div class="trade-stat">\n          <span class="stat-value">${this.tradeAgreements.length}</span>\n          <span class="stat-label">Active Agreements</span>\n          </div>\n          <div class="trade-stat">\n          <span class="stat-value">${this.calculateTradePartners()}</span>\n          <span class="stat-label">Trading Partners</span>\n          </div>\n        </div>\n        </div>\n      </div>\n\n      <div class="trade-agreements">\n        <h3>📋 Trade Agreements</h3>\n        ${this.tradeAgreements.length>0?this.tradeAgreements.map(n=>this.renderTradeAgreement(n)).join(""):'<div class="empty-state"><div class="empty-state-icon">📋</div><h3>No Trade Agreements</h3><p>No active trade agreements. Consider negotiating new deals to boost economic growth.</p></div>'}\n      </div>\n\n      <div class="trade-opportunities">\n        <h3>🌟 Trade Opportunities</h3>\n        ${this.renderTradeOpportunities()}\n      </div>\n      </div>\n      `}renderTradeAgreement(n){return`\n      <div class="trade-agreement">\n        <div class="agreement-header">\n          <div class="agreement-title">${n.name}</div>\n          <div class="agreement-status status-${n.status}">${n.status}</div>\n        </div>\n        <div class="agreement-details">\n          <p>Partners: ${n.partners.join(", ")}</p>\n          <p>Value: $${n.value}B annually</p>\n          <p>Expires: ${n.expiry}</p>\n        </div>\n      </div>\n    `}renderEventsTab(){return 0===this.internationalEvents.length?'\n        <div class="empty-state">\n          <div class="empty-state-icon">🌍</div>\n          <h3>No International Events</h3>\n          <p>The global situation is currently stable. Keep monitoring for developments.</p>\n        </div>\n      ':`\n      <div class="events-list">\n        ${this.internationalEvents.map(n=>this.renderInternationalEvent(n)).join("")}\n      </div>\n    `}renderIntelligenceTab(){return'\n      <div class="intelligence-section">\n        <div class="global-grid">\n          <div class="global-panel">\n            <h3>🔍 Intelligence Overview</h3>\n            <div class="intelligence-metrics">\n              <div class="intel-metric">\n                <span class="metric-value">Classified</span>\n                <span class="metric-label">Security Level</span>\n              </div>\n              <div class="intel-metric">\n                <span class="metric-value">12</span>\n                <span class="metric-label">Active Operations</span>\n              </div>\n              <div class="intel-metric">\n                <span class="metric-value">High</span>\n                <span class="metric-label">Threat Level</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="global-panel">\n            <h3>🎯 Priority Threats</h3>\n            <div class="threat-list">\n              <div class="threat-item threat-high">\n                <div class="threat-title">Cyber Security Concerns</div>\n                <div class="threat-description">Increased cyber activity from state actors</div>\n              </div>\n              <div class="threat-item threat-medium">\n                <div class="threat-title">Trade Tensions</div>\n                <div class="threat-description">Potential escalation in trade disputes</div>\n              </div>\n              <div class="threat-item threat-low">\n                <div class="threat-title">Regional Instability</div>\n                <div class="threat-description">Monitoring situation in key regions</div>\n              </div>\n            </div>\n          </div>\n\n          <div class="global-panel">\n            <h3>📡 Intelligence Assets</h3>\n            <div class="asset-list">\n              <div class="asset-item">\n                <span class="asset-name">Diplomatic Network</span>\n                <span class="asset-status asset-active">Active</span>\n              </div>\n              <div class="asset-item">\n                <span class="asset-name">Economic Intelligence</span>\n                <span class="asset-status asset-active">Active</span>\n              </div>\n              <div class="asset-item">\n                <span class="asset-name">Security Monitoring</span>\n                <span class="asset-status asset-limited">Limited</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="global-panel">\n            <h3>⚡ Recent Intelligence</h3>\n            <div class="recent-intel">\n              <div class="intel-item">\n                <div class="intel-title">Economic Data Gathering</div>\n                <div class="intel-summary">Key economic indicators collected from major partners</div>\n                <div class="intel-time">2 hours ago</div>\n              </div>\n              <div class="intel-item">\n                <div class="intel-title">Diplomatic Communication</div>\n                <div class="intel-summary">Intercepted communications regarding trade negotiations</div>\n                <div class="intel-time">6 hours ago</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}calculateDiplomaticScore(){const n=this.diplomaticRelations.reduce((n,e)=>n+e.relation,0);return Math.round(n/this.diplomaticRelations.length)}calculateTotalTrade(){const n=this.diplomaticRelations.reduce((n,e)=>n+e.tradeVolume,0);return Math.round(n/1e9)}calculateRelationshipStatus(){return{positive:this.diplomaticRelations.filter(n=>n.relation>=70).length,neutral:this.diplomaticRelations.filter(n=>n.relation>=40&&n.relation<70).length,negative:this.diplomaticRelations.filter(n=>n.relation<40).length}}calculateTradeBalance(){const n=this.calculateTotalTrade();return(Math.random()-.4)*n}calculateTradePartners(){return this.diplomaticRelations.filter(n=>n.tradeVolume>5e9).length}getRelationClass(n){return n>=80?"relation-excellent":n>=60?"relation-good":n>=40?"relation-neutral":"relation-poor"}renderPriorityActions(){return["Strengthen trade ties with major partners","Address diplomatic tensions in key regions","Negotiate new cooperation agreements","Review and update existing treaties"].map(n=>`\n      <div class="priority-action">\n        <span class="action-icon">⭐</span>\n        <span class="action-text">${n}</span>\n      </div>\n    `).join("")}renderRecentDevelopments(){return[{text:"Successful climate summit with EU partners",type:"positive"},{text:"Trade tensions with major partner escalating",type:"negative"},{text:"New technology cooperation agreement signed",type:"positive"},{text:"Border dispute requires diplomatic attention",type:"neutral"}].map(n=>`\n      <div class="development-item development-${n.type}">\n        <div class="development-text">${n.text}</div>\n      </div>\n    `).join("")}renderTradeOpportunities(){return[{country:"India",sector:"Technology",potential:"High"},{country:"Brazil",sector:"Agriculture",potential:"Medium"},{country:"South Korea",sector:"Manufacturing",potential:"High"}].map(n=>`\n      <div class="trade-opportunity">\n        <div class="opportunity-header">\n          <span class="opportunity-country">${n.country}</span>\n          <span class="opportunity-potential potential-${n.potential.toLowerCase()}">${n.potential}</span>\n        </div>\n        <div class="opportunity-sector">Sector: ${n.sector}</div>\n        <button class="btn btn--primary btn--sm" onclick="initiateTradeNegotiation('${n.country}', '${n.sector}')">\n          Start Negotiations\n        </button>\n      </div>\n    `).join("")}renderInternationalEvent(n){return`\n      <div class="international-event event-${n.severity}">\n        <div class="event-header">\n          <div class="event-title">${n.title}</div>\n          <div class="event-severity">${n.severity}</div>\n        </div>\n        <div class="event-description">${n.description}</div>\n        <div class="event-actions">\n          <button class="btn btn--primary" onclick="respondToEvent('${n.id}')">\n            Respond\n          </button>\n          <button class="btn btn--secondary" onclick="monitorEvent('${n.id}')">\n            Monitor\n          </button>\n        </div>\n      </div>\n    `}setupInteractivity(){const n=document.querySelector(".global-screen");n&&(n.querySelectorAll(".tab-btn").forEach(n=>{n.addEventListener("click",()=>{const e=n.getAttribute("data-tab");this.switchTab(e)})}),window.showDiplomaticOptions=n=>{this.showDiplomaticOptionsModal(n)},window.initiateDiplomacy=(n,e)=>{this.initiateDiplomaticAction(n,e)},window.initiateTradeNegotiation=(n,e)=>{this.initiateTradeNegotiation(n,e)},window.respondToEvent=n=>{this.respondToInternationalEvent(n)},window.monitorEvent=n=>{this.monitorInternationalEvent(n)})}switchTab(n){this.currentTab=n,this.refresh()}showDiplomaticOptionsModal(n){const e=this.diplomaticRelations.find(e=>e.country===n);e&&(new u({title:`${e.flag} Diplomatic Relations with ${e.country}`,content:`\n        <div class="diplomatic-modal">\n          <div class="country-overview">\n            <h4>Current Status</h4>\n            <div class="status-grid">\n              <div class="status-item">\n                <span class="status-label">Relationship Score</span>\n                <span class="status-value">${e.relation}/100</span>\n              </div>\n              <div class="status-item">\n                <span class="status-label">Trade Volume</span>\n                <span class="status-value">$${(e.tradeVolume/1e9).toFixed(1)}B</span>\n              </div>\n              <div class="status-item">\n                <span class="status-label">Status</span>\n                <span class="status-value">${e.status}</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="diplomatic-actions">\n            <h4>Available Actions</h4>\n            <div class="action-grid">\n              <button class="diplomatic-option" data-action="summit">\n                <div class="option-icon">🤝</div>\n                <div class="option-name">Diplomatic Summit</div>\n                <div class="option-description">Improve relations through high-level talks</div>\n              </button>\n              <button class="diplomatic-option" data-action="trade">\n                <div class="option-icon">📊</div>\n                <div class="option-name">Trade Agreement</div>\n                <div class="option-description">Negotiate new trade terms</div>\n              </button>\n              <button class="diplomatic-option" data-action="cooperation">\n                <div class="option-icon">🌟</div>\n                <div class="option-name">Cooperation Pact</div>\n                <div class="option-description">Establish joint cooperation framework</div>\n              </button>\n              <button class="diplomatic-option" data-action="sanctions">\n                <div class="option-icon">⚠️</div>\n                <div class="option-name">Economic Sanctions</div>\n                <div class="option-description">Apply economic pressure</div>\n              </button>\n            </div>\n          </div>\n        </div>\n      `,confirmText:"Execute Action",onConfirm:()=>{const e=document.querySelector(".diplomatic-option.selected");if(e){const t=e.getAttribute("data-action");return this.executeDiplomaticAction(n,t),!0}return!1}}).show(),setTimeout(()=>{const n=document.querySelectorAll(".diplomatic-option");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected")})})},100))}executeDiplomaticAction(n,e){const i=this.diplomaticRelations.find(e=>e.country===n);if(!i)return;const a={summit:{relation:5,description:"Diplomatic summit strengthened relations"},trade:{relation:3,tradeVolume:2e9,description:"Trade agreement increased cooperation"},cooperation:{relation:7,description:"Cooperation pact established mutual trust"},sanctions:{relation:-15,tradeVolume:-5e9,description:"Economic sanctions damaged relations"}}[e];a&&(i.relation=Math.max(0,Math.min(100,i.relation+a.relation)),a.tradeVolume&&(i.tradeVolume=Math.max(0,i.tradeVolume+a.tradeVolume)),i.lastInteraction=a.description,t.emit("diplomacy:action_taken",{country:n,action:e,effects:a,gameState:this.gameState}),this.refresh(),this.showNotification(`Diplomatic action executed: ${a.description}`,"success"))}initiateDiplomaticAction(n,e){this.showNotification(`Initiating ${e} with ${n}`,"info")}initiateTradeNegotiation(n,e){this.showNotification(`Starting trade negotiations with ${n} in ${e}`,"info")}respondToInternationalEvent(n){this.showNotification(`Responding to international event: ${n}`,"info")}monitorInternationalEvent(n){this.showNotification(`Monitoring international event: ${n}`,"info")}showNotification(n,e="info"){window.spSimApp&&window.spSimApp.showNotification(n,e)}handleInternationalEvent(n){this.internationalEvents.push(n.event),this.refresh()}updateDiplomaticRelation(n){const e=this.diplomaticRelations.find(e=>e.country===n.country);e&&(e.relation=Math.max(0,Math.min(100,e.relation+n.change)),this.refresh())}handleTradeAgreement(n){this.tradeAgreements.push(n.agreement),this.refresh()}update(n){this.gameState=n,this.refresh()}refresh(){const n=document.querySelector("#screen-global .global-screen");n&&(n.innerHTML=this.render().replace(/<div class="global-screen">|<\/div>$/g,""),this.setupInteractivity())}show(){const n=document.querySelector("#screen-global");return n&&!n.querySelector(".global-screen")&&(n.innerHTML=this.render(),this.setupInteractivity()),this.element}}class P{constructor(){this.gameEngine=s,this.eventSystem=t,this.aiOpposition=l,this.playerAnalytics=e,this.monetizationFramework=a,this.policyImplementationEngine=o,this.dashboard=null,this.navigation=null,this.economicsScreen=null,this.policyScreen=null,this.analyticsScreen=null,this.debugPanel=null,this.timeline=null,this.playerGuide=null,this.startingScreen=null,this.politicalEventsPanel=null,this.settingsScreen=null,this.politicsScreen=null,this.crisisManagementScreen=null,this.globalRelationsScreen=null,this.currentScreen="dashboard",this.isInitialized=!1}async initialize(){try{console.log("🎮 Starting SP_Sim - Political Economy Simulation"),this.startingScreen=new w,this.initializeUI(),this.startingScreen.show()?(this.gameEngine.initialize(),this.setupEventListeners(),this.setupErrorHandling(),this.isInitialized=!0,console.log("✅ SP_Sim initialized successfully (with starting screen)")):this.initializeGameForExistingPlayer()}catch(n){console.error("❌ Failed to initialize SP_Sim:",n),this.showError("Failed to initialize game. Please refresh the page.")}}initializeGameForExistingPlayer(){this.gameEngine.initialize(),this.initializeUI(),this.setupEventListeners(),this.setupErrorHandling(),this.gameEngine.start(),this.isInitialized=!0,console.log("✅ SP_Sim initialized successfully"),this.updateUI(),setTimeout(()=>{this.updateUI()},100)}initializeUI(){this.navigation=new v,this.dashboard=new m,this.economicsScreen=new g,this.policyScreen=new b,this.timeline=new f,this.playerGuide=new x,this.politicalEventsPanel=new S,this.analyticsScreen=new y,this.settingsScreen=new k,this.politicsScreen=new C,this.crisisManagementScreen=new $,this.globalRelationsScreen=new T,this.setupScreenManagement(),this.addTimelineToDashboard(),console.log("✅ UI components initialized")}addTimelineToDashboard(){const n=document.querySelector("#screen-dashboard");if(n&&this.timeline){const e=n.querySelector(".dashboard");e&&e.appendChild(this.timeline.show())}}setupScreenManagement(){this.eventSystem.on(i.UI_UPDATE,n=>{"navigation"===n.data.type&&this.switchToScreen(n.data.to)}),window.addEventListener("popstate",n=>{const e=n.state?.screen||"dashboard";this.switchToScreen(e,!1)});const n=window.location.hash.replace("#","");n&&this.navigation.screens[n]&&this.switchToScreen(n,!1)}switchToScreen(n,e=!0){if(this.currentScreen!==n)if("help"!==n){if(document.querySelectorAll(".screen").forEach(n=>{n.classList.remove("screen--active")}),"policies"===n&&this.policyScreen)this.showPolicyScreen();else if("politics"===n&&this.politicsScreen){const e=document.querySelector(`#screen-${n}`);e?(e.classList.add("screen--active"),this.politicsScreen.show(),this.gameEngine&&this.gameEngine.getGameState&&this.politicsScreen.update(this.gameEngine.getGameState())):this.createScreenPlaceholder(n)}else if("economy"===n&&this.economicsScreen){const e=document.querySelector(`#screen-${n}`);e?(e.classList.add("screen--active"),this.economicsScreen.show()):this.createScreenPlaceholder(n)}else if("analytics"===n&&this.analyticsScreen){const e=document.querySelector(`#screen-${n}`);e?(e.classList.add("screen--active"),this.playerAnalytics.trackFeatureUsage("analytics")):this.createScreenPlaceholder(n)}else if("crisis"===n&&this.crisisManagementScreen){const e=document.querySelector(`#screen-${n}`);e?(e.classList.add("screen--active"),this.crisisManagementScreen.show(),this.gameEngine&&this.gameEngine.getGameState&&this.crisisManagementScreen.update(this.gameEngine.getGameState())):this.createScreenPlaceholder(n)}else if("global"===n&&this.globalRelationsScreen){const e=document.querySelector(`#screen-${n}`);e?(e.classList.add("screen--active"),this.globalRelationsScreen.show(),this.gameEngine&&this.gameEngine.getGameState&&this.globalRelationsScreen.update(this.gameEngine.getGameState())):this.createScreenPlaceholder(n)}else{const e=document.querySelector(`#screen-${n}`);e?e.classList.add("screen--active"):this.createScreenPlaceholder(n)}this.currentScreen=n,this.navigation&&(this.navigation.currentScreen=n),console.log(`Switched to screen: ${n}`)}else this.showPlayerGuide()}showPlayerGuide(){this.playerGuide&&this.playerGuide.showModal()}showPolicyScreen(){if(this.policyScreen){const n=document.querySelector("#screen-policies");if(n){n.classList.add("screen--active");let e=n.querySelector(".policy-screen");e||(e=document.createElement("div"),e.className="policy-screen",n.appendChild(e)),e.innerHTML=this.policyScreen.render(),this.policyScreen.setupInteractivity(),this.gameEngine&&this.gameEngine.getGameState&&this.policyScreen.update(this.gameEngine.getGameState())}}}createScreenPlaceholder(n){const e=this.navigation?.screens[n]||n,t=document.createElement("div");t.id=`screen-${n}`,t.className="screen screen--active",t.innerHTML=`\n      <div class="panel">\n        <h2 class="panel__title">${e}</h2>\n        <div class="panel__content">\n          <p>This screen is under development and will be available in a future update.</p>\n          <p>Screen: <strong>${e}</strong></p>\n        </div>\n      </div>\n    `;const i=document.querySelector(".main-content");i&&i.appendChild(t)}setupEventListeners(){this.eventSystem.on(i.GAME_START,()=>{this.updateUI()}),this.eventSystem.on(i.TURN_END,()=>{this.updateUI()}),this.eventSystem.on("game:pause_toggle",()=>{this.handlePauseToggle()}),this.eventSystem.on(i.GAME_SAVE,n=>{this.handleSaveGame(n.data.saveName)}),this.eventSystem.on("ui:load_game_dialog",()=>{this.showLoadGameDialog()}),this.eventSystem.on("ui:decision_dialog",n=>{this.showDecisionDialog(n.data.decision)}),this.eventSystem.on(i.UI_ERROR,n=>{this.showError(n.data.message)}),this.eventSystem.on(i.UI_NOTIFICATION,n=>{this.showNotification(n.data.message,n.data.type)}),this.eventSystem.on("achievement:unlocked",n=>{const{achievement:e}=n.data;this.showNotification(`🏆 Achievement Unlocked: ${e.title}`,"success")}),this.eventSystem.on("ui:game_end",n=>{this.showGameEndDialog(n.data.endCondition)}),this.eventSystem.on("political:vote_scheduled",n=>{this.showNotification("New political vote scheduled!","info")}),this.eventSystem.on("political:crisis_triggered",n=>{this.showNotification(`Political Crisis: ${n.data.crisis.title}`,"warning")}),this.eventSystem.on("ui:show_modal",n=>{this.showCustomModal(n.data)}),this.eventSystem.on("game:reset",n=>{this.handleNewGameFromStartingScreen(n.data)}),document.addEventListener("keydown",n=>{this.handleKeyboard(n)}),window.addEventListener("beforeunload",()=>{this.gameEngine.autoSave()}),window.addEventListener("focus",()=>{this.isInitialized&&this.gameEngine.isPaused}),window.addEventListener("blur",()=>{this.isInitialized&&this.gameEngine.isRunning}),this.setupGameControlButtons()}setupGameControlButtons(){const n=document.getElementById("pause-btn");n&&n.addEventListener("click",()=>{this.handlePauseToggle()});const e=document.getElementById("next-turn-btn");e&&e.addEventListener("click",()=>{this.gameEngine.nextTurn()});const t=document.getElementById("save-btn");t&&t.addEventListener("click",()=>{this.handleSaveGame()});const i=document.getElementById("load-btn");i&&i.addEventListener("click",()=>{this.showLoadGameDialog()});const a=document.getElementById("reset-btn");a&&a.addEventListener("click",()=>{this.gameEngine.requestReset("confirm")})}setupErrorHandling(){window.addEventListener("error",n=>{console.error("Unhandled error:",n.error),this.showError("An unexpected error occurred. The game has been auto-saved."),this.gameEngine.autoSave()}),window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection:",n.reason),this.showError("An unexpected error occurred. The game has been auto-saved."),this.gameEngine.autoSave()})}handleKeyboard(n){if("INPUT"!==n.target.tagName&&"TEXTAREA"!==n.target.tagName)switch(n.key){case" ":n.preventDefault(),this.handlePauseToggle();break;case"n":n.preventDefault(),this.gameEngine.isPaused&&this.gameEngine.nextTurn();break;case"s":(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.handleSaveGame());break;case"l":(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.showLoadGameDialog())}}updateUI(){const n=this.gameEngine.getGameState(),e=this.gameEngine.politicalEvents.getPoliticalStatus(n);this.dashboard&&this.dashboard.update(n),this.politicalEventsPanel&&this.politicalEventsPanel.update(n,e),this.policyScreen&&"policies"===this.currentScreen&&this.policyScreen.update(n);const t=`SP_Sim - Week ${n.time.week}, Year ${n.time.year}`,i=`(${n.politics.approval.toFixed(1)}% approval)`;document.title=`${t} ${i}`}handlePauseToggle(){this.gameEngine.isPaused?(this.gameEngine.resume(),this.updatePauseButton("Pause")):(this.gameEngine.pause(),this.updatePauseButton("Resume"))}updatePauseButton(n){const e=document.getElementById("pause-btn");e&&(e.textContent=n)}handleSaveGame(n=null){let e=n;if(!e)return new u({title:"Save Game",content:`\n          <div class="save-game-form">\n            <p>Enter a name for your save:</p>\n            <div class="form-group">\n              <label for="save-name-input">Save Name:</label>\n              <input type="text" id="save-name-input" class="form-input" \n                     placeholder="e.g., Pre-Election 2024" \n                     value="Save ${(new Date).toLocaleDateString()}" />\n            </div>\n            <div class="save-suggestions">\n              <p>Suggestions:</p>\n              <div class="suggestion-buttons">\n                <button type="button" class="suggestion-btn" data-name="Pre-Election Save">Pre-Election</button>\n                <button type="button" class="suggestion-btn" data-name="Economic Crisis Start">Economic Crisis</button>\n                <button type="button" class="suggestion-btn" data-name="Policy Reform Checkpoint">Policy Reform</button>\n                <button type="button" class="suggestion-btn" data-name="Coalition Change">Coalition Change</button>\n              </div>\n            </div>\n          </div>\n          <style>\n            .save-game-form {\n              min-width: 300px;\n            }\n            .form-group {\n              margin-bottom: var(--spacing-md);\n            }\n            .form-group label {\n              display: block;\n              margin-bottom: var(--spacing-xs);\n              font-weight: 500;\n              color: var(--text-color);\n            }\n            .form-input {\n              width: 100%;\n              padding: var(--spacing-sm);\n              border: 1px solid var(--border-color);\n              border-radius: var(--border-radius);\n              font-size: 1rem;\n              transition: border-color var(--transition-base);\n            }\n            .form-input:focus {\n              outline: none;\n              border-color: var(--secondary-color);\n              box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.2);\n            }\n            .save-suggestions {\n              margin-top: var(--spacing-md);\n            }\n            .save-suggestions p {\n              margin-bottom: var(--spacing-sm);\n              font-size: 0.875rem;\n              color: var(--text-light);\n            }\n            .suggestion-buttons {\n              display: flex;\n              flex-wrap: wrap;\n              gap: var(--spacing-xs);\n            }\n            .suggestion-btn {\n              padding: var(--spacing-xs) var(--spacing-sm);\n              border: 1px solid var(--border-color);\n              background: var(--surface-color);\n              color: var(--text-color);\n              border-radius: var(--border-radius);\n              cursor: pointer;\n              font-size: 0.8rem;\n              transition: all var(--transition-fast);\n            }\n            .suggestion-btn:hover {\n              background: var(--secondary-color);\n              color: white;\n              border-color: var(--secondary-color);\n            }\n          </style>\n        `,confirmText:"Save Game",cancelText:"Cancel",showCancel:!0,onConfirm:()=>{const n=document.getElementById("save-name-input");return e=n.value.trim(),e?(this.gameEngine.saveGame(e)?this.showNotification("Game saved successfully!","success"):this.showError("Failed to save game."),!0):(this.showNotification("Please enter a save name.","warning"),!1)}}).show(),void setTimeout(()=>{const n=document.getElementById("save-name-input"),e=document.querySelectorAll(".suggestion-btn");n&&(n.focus(),n.select()),e.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-name"),i=this.gameEngine.getGameState(),a=`${t} - Week ${i.time.week}, Year ${i.time.year}`;n.value=a,n.focus()})})},100);this.gameEngine.saveGame(e)?this.showNotification("Game saved successfully!","success"):this.showError("Failed to save game.")}showLoadGameDialog(){const n=this.gameEngine.saveSystem.getAllSaves(),e=this.gameEngine.saveSystem.getStorageStats();if(0===n.length)return void u.alert("No Saves Found","No saved games were found.",()=>{this.showNotification("No saved games found.","info")});let t='<div class="save-list">';n.forEach((n,e)=>{const i=new Date(n.timestamp).toLocaleString(),a=n.gameTime?`Week ${n.gameTime.week}, Year ${n.gameTime.year}`:"Unknown",s=n.imported?'<span class="save-badge imported">Imported</span>':"";t+=`\n        <div class="save-item" data-save-id="${n.id}">\n          <div class="save-header">\n            <div class="save-name">${n.name} ${s}</div>\n            <div class="save-time">${a}</div>\n          </div>\n          <div class="save-meta">\n            <span class="save-date">${i}</span>\n            <span class="save-version">v${n.version}</span>\n          </div>\n          <div class="save-actions">\n            <button class="save-action-btn export-btn" data-save-id="${n.id}" type="button">Export</button>\n            <button class="save-action-btn delete-btn" data-save-id="${n.id}" type="button">Delete</button>\n          </div>\n        </div>\n      `}),t+="</div>";const i=`\n      <div class="save-management">\n        <div class="storage-stats">\n          <div class="stats-item">\n            <strong>Save Count:</strong> ${e.saveCount}/${e.maxSaves}\n          </div>\n          <div class="stats-item">\n            <strong>Storage Used:</strong> ${e.totalSizeKB} KB\n          </div>\n          <div class="stats-item">\n            <strong>Auto-save:</strong> ${e.hasAutoSave?"Available":"None"}\n          </div>\n        </div>\n        <div class="import-section">\n          <input type="file" id="import-save-file" accept=".json" style="display: none;">\n          <button class="btn btn--secondary" \n          type="button" onclick="document.getElementById('import-save-file').click()">\n            Import Save File\n          </button>\n        </div>\n      </div>\n    `,a=new u({title:"Load Game",content:`\n        <div class="load-game-dialog">\n          <p>Select a save to load:</p>\n          ${t}\n          ${i}\n        </div>\n        <style>\n          .load-game-dialog {\n            max-width: 100%;\n          }\n          .save-list { \n            max-height: 400px; \n            overflow-y: auto; \n            margin: var(--spacing-md) 0;\n          }\n          .save-item { \n            padding: var(--spacing-md); \n            border: 1px solid var(--border-color); \n            margin-bottom: var(--spacing-sm); \n            cursor: pointer; \n            border-radius: var(--border-radius);\n            transition: all var(--transition-base);\n            background: var(--surface-color);\n          }\n          .save-item:hover { \n            background: var(--background-alt); \n            border-color: var(--secondary-color);\n            transform: translateY(-1px);\n            box-shadow: var(--shadow-sm);\n          }\n          .save-item.selected { \n            background: var(--secondary-color); \n            color: white; \n            border-color: var(--secondary-color);\n          }\n          .save-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: var(--spacing-xs);\n          }\n          .save-name { \n            font-weight: bold; \n            font-size: 1rem;\n            display: flex;\n            align-items: center;\n            gap: var(--spacing-xs);\n          }\n          .save-time {\n            font-size: 0.875rem;\n            opacity: 0.8;\n          }\n          .save-meta {\n            display: flex;\n            justify-content: space-between;\n            font-size: 0.8rem;\n            opacity: 0.7;\n            margin-bottom: var(--spacing-sm);\n          }\n          .save-actions {\n            display: flex;\n            gap: var(--spacing-xs);\n            opacity: 0.8;\n            transition: opacity var(--transition-base);\n          }\n          .save-item:hover .save-actions {\n            opacity: 1;\n          }\n          .save-action-btn {\n            padding: var(--spacing-xs) var(--spacing-sm);\n            border: 1px solid currentColor;\n            background: transparent;\n            color: inherit;\n            border-radius: var(--border-radius);\n            cursor: pointer;\n            font-size: 0.75rem;\n            transition: all var(--transition-fast);\n          }\n          .save-action-btn:hover {\n            background: currentColor;\n            color: var(--surface-color);\n          }\n          .save-badge {\n            background: var(--warning-color);\n            color: white;\n            padding: 2px 6px;\n            border-radius: var(--border-radius);\n            font-size: 0.7rem;\n            font-weight: normal;\n          }\n          .save-management {\n            border-top: 1px solid var(--border-color);\n            padding-top: var(--spacing-md);\n            margin-top: var(--spacing-md);\n          }\n          .storage-stats {\n            display: flex;\n            flex-wrap: wrap;\n            gap: var(--spacing-md);\n            margin-bottom: var(--spacing-md);\n            font-size: 0.875rem;\n          }\n          .stats-item {\n            color: var(--text-light);\n          }\n          .import-section {\n            text-align: center;\n          }\n          \n          @media (max-width: 768px) {\n            .save-header {\n              flex-direction: column;\n              gap: var(--spacing-xs);\n            }\n            .save-meta {\n              flex-direction: column;\n              gap: var(--spacing-xs);\n            }\n            .storage-stats {\n              flex-direction: column;\n              gap: var(--spacing-xs);\n            }\n          }\n        </style>\n      `,confirmText:"Load",cancelText:"Cancel",showCancel:!0,onConfirm:()=>{const n=document.querySelector(".save-item.selected");if(!n)return this.showNotification("Please select a save to load.","warning"),!1;const e=n.getAttribute("data-save-id");return this.gameEngine.loadGame(e)?(this.showNotification("Game loaded successfully!","success"),this.updateUI()):this.showError("Failed to load game."),!0}});a.show(),setTimeout(()=>{const n=document.querySelectorAll(".save-item");n.forEach(e=>{e.addEventListener("click",t=>{t.target.classList.contains("save-action-btn")||(n.forEach(n=>n.classList.remove("selected")),e.classList.add("selected"))})}),document.querySelectorAll(".export-btn").forEach(n=>{n.addEventListener("click",e=>{e.stopPropagation();const t=n.getAttribute("data-save-id");this.gameEngine.saveSystem.exportSave(t)?this.showNotification("Save exported successfully!","success"):this.showError("Failed to export save.")})}),document.querySelectorAll(".delete-btn").forEach(n=>{n.addEventListener("click",e=>{e.stopPropagation();const t=n.getAttribute("data-save-id"),i=n.closest(".save-item").querySelector(".save-name").textContent;window.confirm(`Are you sure you want to delete "${i}"?`)&&(this.gameEngine.saveSystem.deleteSave(t)?(n.closest(".save-item").remove(),this.showNotification("Save deleted successfully!","success")):this.showError("Failed to delete save."))})});const e=document.getElementById("import-save-file");e&&e.addEventListener("change",async n=>{const e=n.target.files[0];e&&(await this.gameEngine.saveSystem.importSave(e)?(this.showNotification("Save imported successfully!","success"),a.hide(),setTimeout(()=>this.showLoadGameDialog(),100)):this.showError("Failed to import save. Please check the file format."))})},100)}showDecisionDialog(n){new u({title:"Political Decision",content:`\n        <div class="decision-content">\n          <p><strong>Decision:</strong> ${n.description||n}</p>\n          <div class="decision-options">\n            <p>How would you like to respond?</p>\n          </div>\n        </div>\n      `,confirmText:"Approve",cancelText:"Reject",showCancel:!0,onConfirm:()=>(this.eventSystem.emit("decision:response",{decision:n,response:"approve"}),this.showNotification("Decision approved.","success"),!0),onCancel:()=>{this.eventSystem.emit("decision:response",{decision:n,response:"reject"}),this.showNotification("Decision rejected.","info")}}).show()}showError(n){console.error(n),window.alert(`Error: ${n}`)}showNotification(n,e="info"){console.log(`${e.toUpperCase()}: ${n}`);const t=document.querySelectorAll(".notification");if(Array.from(t).some(e=>e.textContent===n))return;const i=document.createElement("div");let a;i.className=`notification notification--${e}`,i.textContent=n,a="error"===e?"#e74c3c":"success"===e?"#27ae60":"warning"===e?"#f39c12":"#3498db";const s=20+60*document.querySelectorAll(".notification").length;i.style.cssText=`\n      position: fixed;\n      top: ${s}px;\n      right: 20px;\n      padding: 12px 16px;\n      background: ${a};\n      color: white;\n      border-radius: 4px;\n      z-index: 10000;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n      animation: slideInRight 0.3s ease-out;\n      max-width: 300px;\n      word-wrap: break-word;\n    `,document.body.appendChild(i),setTimeout(()=>{i.parentNode&&(i.style.animation="slideOutRight 0.3s ease-in forwards",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300))},3e3)}showGameEndDialog(n){const e="victory"===n.type;new u({title:n.title,content:`\n        <div class="game-end-dialog ${e?"victory":"defeat"}">\n          <div class="end-icon">\n            ${e?"🏆":"💔"}\n          </div>\n          <div class="end-description">\n            <p>${n.description}</p>\n          </div>\n          <div class="final-stats">\n            <h4>Final Statistics:</h4>\n            <div class="stats-grid">\n              <div class="stat">\n                <span>Time in Office:</span>\n                <span>${n.finalStats.timeInOffice}</span>\n              </div>\n              <div class="stat">\n                <span>Final Approval:</span>\n                <span>${n.finalStats.finalApproval.toFixed(1)}%</span>\n              </div>\n              <div class="stat">\n                <span>GDP Growth:</span>\n                <span>${n.finalStats.finalGDPGrowth.toFixed(1)}%</span>\n              </div>\n              <div class="stat">\n                <span>Achievements:</span>\n                <span>${n.finalStats.achievementsUnlocked}</span>\n              </div>\n            </div>\n          </div>\n          <div class="next-actions">\n            <p>What would you like to do next?</p>\n          </div>\n        </div>\n        <style>\n          .game-end-dialog {\n            text-align: center;\n            max-width: 400px;\n            margin: 0 auto;\n          }\n          .end-icon {\n            font-size: 4rem;\n            margin-bottom: var(--spacing-md);\n          }\n          .victory .end-icon {\n            color: #27ae60;\n          }\n          .defeat .end-icon {\n            color: #e74c3c;\n          }\n          .end-description {\n            margin-bottom: var(--spacing-lg);\n          }\n          .final-stats h4 {\n            margin-bottom: var(--spacing-md);\n            color: var(--primary-color);\n          }\n          .stats-grid {\n            display: flex;\n            flex-direction: column;\n            gap: var(--spacing-sm);\n            margin-bottom: var(--spacing-lg);\n          }\n          .stat {\n            display: flex;\n            justify-content: space-between;\n            padding: var(--spacing-xs) 0;\n            border-bottom: 1px solid var(--border-light);\n          }\n          .stat:last-child {\n            border-bottom: none;\n          }\n        </style>\n      `,confirmText:"New Game",cancelText:"Continue",showCancel:!0,onConfirm:()=>(this.gameEngine.requestReset("new_game"),!0)}).show()}showCustomModal(n){new u(n).show()}handleNewGameFromStartingScreen(n){this.isInitialized||this.initializeGameForExistingPlayer(),this.startingScreen&&this.startingScreen.hide(),document.querySelectorAll("#starting-screen, .starting-screen").forEach(n=>n.remove()),n.newGameState&&this.gameEngine.resetGameState(n.newGameState),this.gameEngine.start(),this.updateUI(),setTimeout(()=>{this.updateUI()},100)}}document.addEventListener("DOMContentLoaded",()=>{const n=new P;n.initialize(),window.spSimApp=n})}}});
